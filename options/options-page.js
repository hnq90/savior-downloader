!function(){var a={EXTENSION_RE:/\.([^/.]*)$/i,FILENAME_RE:/([^/]+)$/i,SIZES:["","K","M","G","T","P"],xmlParser:new DOMParser,urlParser:document.createElement("a"),fileDownloader:document.createElement("a"),strip:function(a){return a.replace(/(^\s+)|(\s+$)/m,"")},endsWith:function(a,b){var c=a.length-b.length;return a.indexOf(b,c)===c},hash:function(a,b){if(b=0|b,0===a.length)return b;var c,d;for(c=0,d=a.length;d>c;c++)b=(b<<5)-b+a.charCodeAt(c),b|=0;return b},query:function(a,b){return b=b||document,b.querySelector(a)},queryAll:function(b,c){return c=c||document,a.toArray(c.querySelectorAll(b))},findParent:function(a,b){for(;null!==a&&!a.classList.contains(b);)a=a.parentNode;return a},toArray:function(a){return Array.prototype.slice.call(a)},unique:function(a){var b=[];return Array.isArray(a)?(a.forEach(function(a){-1===b.indexOf(a)&&b.push(a)}),b):a},extend:function(a,b){var c=function(){};c.prototype=a.prototype,b.prototype=new c,b.prototype.constructor=b,b._super=a.prototype},parseUrl:function(b){var c=a.urlParser;c.setAttribute("href",b);var d=(c.pathname.match(a.FILENAME_RE)||[])[1]||"",e=d.split(".").map(function(a){return a.toLowerCase()});d=decodeURIComponent(d.replace(a.EXTENSION_RE,"")),e.shift();var f=e[e.length-1]||"";return{url:b,protocol:c.protocol,host:c.host,port:c.port,pathname:c.pathname,filename:d,ext:f,exts:e,search:c.search}},isMatches:function(b,c){var d,e,f;if(Array.isArray(b)){for(d=0;d<b.length;++d)if(a.isMatches(b[d],c))return!0;return!1}for(c=Array.isArray(c)?c:[c],d=0,e=c.length,f;e>d;++d)if(f=c[d],"string"==typeof f&&-1!==b.indexOf(f)||f instanceof RegExp&&b.match(f))return!0;return!1},_sendBackgroundRequest:function(a,b,c,e){var f=new d;return chrome.runtime.sendMessage({requestType:"make_http_request",method:a,url:b,params:c,headers:e},function(a){f[a.success?"resolve":"reject"](a.data)}),f},send:function(b,c,e,f){var g=new d,h=null;if(a.IS_CONTENT_SCRIPT)return a._sendBackgroundRequest(b,c,e,f);try{var i=new XMLHttpRequest;if(i.open(b,c,!0),i.setRequestHeader("Cache-Control","no-cache"),"object"==typeof e&&(h=Object.keys(e).map(function(a){return a+"="+e[a]}).join("&")),"object"==typeof f)for(var j in f)i.setRequestHeader(j,f[j]);"POST"===b&&i.setRequestHeader("Content-type","application/x-www-form-urlencoded"),i.onload=function(){g.resolve(this.responseText)},i.onerror=function(){g.reject()},i.send(h)}catch(k){g.reject()}return g},get:function(b,c){return a.send("GET",b,{},c)},post:function(b,c,d){return a.send("POST",b,c,d)},_getSize:function(a){function b(a){e&&e[a?"resolve":"reject"](a),e=null,c.abort(),clearTimeout(f),f=null}var c=new XMLHttpRequest,e=new d,f=null,g=1e4;return c.open("GET",a),c.setRequestHeader("Cache-Control","no-cache"),c.url=a,c.onreadystatechange=function(){if(!(this.readyState<2)){var a=null;try{a=+this.getResponseHeader("Content-Length")}catch(c){}(null!==a||200===this.status)&&(200!==this.status&&(a=null),b(a))}},c.send(null),f=setTimeout(b,g),e},getSize:function(b){var c=new d,e=window.cache;return e.get(b).success(function(d){d?(c.resolve(d),e.put(b,d)):c.bind(a._getSize(b)).success(e.put.bind(e,b))}).fail(function(){c.bind(a._getSize(b)).success(e.put.bind(e,b))}),c},beautifyFileSize:function(b){if(null===b||"undefined"==typeof b)return"???";for(var c=0;c<a.SIZES.length&&b>=1024;++c,b/=1024);return Math.round(10*b)/10+a.SIZES[c]+"b"},detectMediaTypeAndExt:function(b,c){c=c||"","string"==typeof b&&(b=a.parseUrl(b));var d=a.getMediaType(c,b.exts);return d&&MEDIA_TYPES[d]&&(b.type=d,b.ext=this._findIntersection(b.exts,MEDIA_TYPES[d].extensions)||a.extByContentType(c,d)||b.ext),b},getMediaType:function(b,c){var d;for(var e in MEDIA_TYPES){d=MEDIA_TYPES[e];for(var f=0;f<d.contentTypes.length;++f)if(b.match(d.contentTypes[f]))return e;if(Array.isArray(c)&&a._findIntersection(c,d.extensions)||-1!==d.extensions.indexOf(c))return e}return null},_findIntersection:function(a,b){for(var c=a.concat(b),d={},e=0;e<c.length;++e){var f=c[e];if(d[f])return f;d[f]=!0}return null},extByContentType:function(a,b){var c=MEDIA_TYPES[b].ctype2extension;for(var d in c)if(-1!==a.indexOf(d))return c[d];return null},isTrue:function(a){return!!a},noop:function(){},defined:function(a){return"undefined"!=typeof a},notNull:function(a){return null!==a}},b=chrome.i18n.getMessage;try{chrome.extension.getBackgroundPage(),a.IS_CONTENT_SCRIPT=!1}catch(c){a.IS_CONTENT_SCRIPT=!0}var d=function(a){if(0===arguments.length)return this._init(),this;if(a instanceof d)return a;var b=new d;return b.resolve(a),b};d.RUNNING=0,d.RESOLVED=1,d.FAILED=2,d.prototype={constructor:d,_init:function(){this._results=[],this._subscribers=[],this.state=d.RUNNING},_notify:function(){var a=this;this._subscribers.forEach(function(b){b.apply(a,a._results)}),this._subscribers=[]},resolve:function(){return this.state=d.RESOLVED,this._results=arguments,this._notify(),this},reject:function(){return this.state=d.FAILED,this._results=arguments,this._notify(),this},subscribe:function(a){this.state!==d.RUNNING?a.apply(this,this._results):this._subscribers.push(a)},done:function(a){return this.subscribe(a),this},success:function(a){var b=this;return this.subscribe(function(){b.state===d.RESOLVED&&a.apply(b,b._results)}),this},fail:function(a){var b=this;return this.subscribe(function(){b.state===d.FAILED&&a.apply(b,b._results)}),this},bind:function(a){return a=new d(a),a.success(this.resolve.bind(this)).fail(this.reject.bind(this)),this}},d.when=function(){var b=[];return b=Array.isArray(arguments[0])?arguments[0]:a.toArray(arguments),new d.When(b)},d.When=function(a){this._doneCallbacks=[],this._successCallbacks=[],this._failCallbacks=[],this._state=d.RUNNING,this._thingsToDo=a.length,this._results=Array(this._thingsToDo),this._init(a)},d.When.prototype={constructor:d.When,_init:function(b){var c=this;b.forEach(function(b,e){b=new d(b),b.subscribe(function(){b.state===d.FAILED&&(c._state=d.FAILED),c._results[e]=a.toArray(arguments),c._thingsToDo--,c._checkIsDone()})}),this._checkIsDone()},_checkIsDone:function(){if(0!==this._thingsToDo)return!1;var a=[];this._results.forEach(function(b){a=a.concat(b)}),this._state===d.FAILED?this._runCallbacks(this._failCallbacks,a):this._runCallbacks(this._successCallbacks,a),this._runCallbacks(this._doneCallbacks,a),this._doneCallbacks=[],this._successCallbacks=[],this._failCallbacks=[]},_runCallbacks:function(a,b){a.forEach(function(a){a.apply(this,b)})},done:function(a){return this._doneCallbacks.push(a),this._checkIsDone(),this},success:function(a){return this._successCallbacks.push(a),this._checkIsDone(),this},fail:function(a){return this._failCallbacks.push(a),this._checkIsDone(),this}},d.chain=function(){function b(a){if(!a.length)return e.resolve.apply(e,f);var c,g=a.shift();"function"==typeof g?(c=d(g()),c.done(function(c){f.push(c),b(a)})):(f.push(g),b(a))}var c,e=new d,f=[];return c=Array.isArray(arguments[0])?arguments[0]:a.toArray(arguments),b(c),e};var e=function(){this._storage=chrome.storage.local,this._options={},this._default={on_page_buttons:!0};var a=this;chrome.storage.onChanged.addListener(function(b,c){if("local"===c)for(var d in b)a._options[d]=b[d].newValue})};e.prototype={load:function(){var a=new d,b=this;return this._storage.get(null,function(c){b._options=c,a.resolve(c)}),a},set:function(a,b){var c={};("string"==typeof a||"number"==typeof a&&"undefined"!=typeof b)&&(c[a]=b,this._options[a]=b,this._storage.set(c))},get:function(a){return a in this._options?this._options[a]:this._default[a]}};var f=function(){};f.QL_HIGH="High",f.QL_MEDIUM="Medium",f.QL_LOW="Low",f.QL_VIDEO_ULTRAHD="Ultra HD",f.QL_VIDEO_FULLHD="Full HD",f.QL_VIDEO_HD="HD",f.QL_VIDEO_STANDARD="Standard",f.QL_VIDEO_MEDIUM="Medium",f.QL_VIDEO_SMALL="Small",f.QL_VIDEO_MOBILE="Mobile";var g={};g[f.QL_VIDEO_ULTRAHD]={quality:f.QL_HIGH,qualityIndex:6,size:3072,videoTitle:"Ultra HD",itag:[38,138]},g[f.QL_VIDEO_FULLHD]={quality:f.QL_HIGH,qualityIndex:5,size:1080,videoTitle:"Full HD",audioTitle:"High",itag:[37,46,137],vimeoQuality:"",zingTag:"f1080",dailymotionQuality:"hd1080",clipvnQuality:"5"},g[f.QL_VIDEO_HD]={quality:f.QL_HIGH,qualityIndex:4,size:720,videoTitle:"HD",audioTitle:"High",itag:[22,45,120,136,247],zingTag:["f720","hq"],vimeoQuality:"hd",dailymotionQuality:["hd","hd720"],facebookQuality:"hd_src",clipvnQuality:"4"},g[f.QL_VIDEO_STANDARD]={quality:f.QL_MEDIUM,qualityIndex:3,size:480,videoTitle:"Standard",audioTitle:"Normal",itag:[44,35,135,244],zingTag:["f480"],dailymotionQuality:"hq",vimeoQuality:"sd",facebookQuality:"sd_src",clipvnQuality:"3"},g[f.QL_VIDEO_MEDIUM]={quality:f.QL_MEDIUM,qualityIndex:2,size:360,videoTitle:"Medium",audioTitle:"Normal",itag:[18,43,34,134,243],vimeoQuality:"",dailymotionQuality:"sd",zingTag:["source","f360"],clipvnQuality:"2"},g[f.QL_VIDEO_SMALL]={quality:f.QL_LOW,qualityIndex:1,size:240,videoTitle:"Small",audioTitle:"Low",itag:[36,5,133,242],dailymotionQuality:"ld",vimeoQuality:"mobile",zingTag:["f","f240"],clipvnQuality:"1"},g[f.QL_VIDEO_MOBILE]={quality:f.QL_LOW,qualityIndex:0,size:144,videoTitle:"Mobile",audioTitle:"Low",itag:[17,6,160],vimeoQuality:"",clipvnQuality:"0"};var h={};h[f.QL_HIGH]=g[f.QL_VIDEO_ULTRAHD].qualityIndex,h[f.QL_MEDIUM]=g[f.QL_VIDEO_STANDARD].qualityIndex,h[f.QL_LOW]=g[f.QL_VIDEO_SMALL].qualityIndex,f.prototype={constructor:f,DEFAULT_QUALITY_LEVEL:f.QL_HIGH,QUALITY_LEVELS:[f.QL_HIGH,f.QL_MEDIUM,f.QL_LOW],VIDEO_QUALITY_LEVELS:[f.QL_VIDEO_FULLHD,f.QL_VIDEO_HD,f.QL_VIDEO_STANDARD,f.QL_VIDEO_MEDIUM,f.QL_VIDEO_SMALL,f.QL_VIDEO_MOBILE],DEFAULT_QUALITY_TYPE:f.QL_VIDEO_STANDARD,QUALITY_TYPES:g,getFacebookQuality:function(a){return this._getVideoQuality("facebookQuality",a).videoTitle},getDailymotionQuality:function(a){return this._getVideoQuality("dailymotionQuality",a).videoTitle},getZingVideoQuality:function(a){return this._getVideoQuality("zingTag",a).videoTitle},getZingAudioQuality:function(a){return this._getVideoQuality("zingTag",a).audioTitle},getYoutubeQuality:function(a,b){var c=this._getVideoQuality("itag",+a,b);return c&&c.videoTitle},getVimeoQuality:function(a){return this._getVideoQuality("vimeoQuality",a).videoTitle},getClipvnQuality:function(a){return this._getVideoQuality("clipvnQuality",a).videoTitle},getQualityBySize:function(a){if(a=parseInt(a),isNaN(a))return null;var b=1/0,c=null,d=this.QUALITY_TYPES[this.DEFAULT_QUALITY_TYPE];for(var e in this.QUALITY_TYPES){var f=this.QUALITY_TYPES[e];f.size>d.size&&(d=f),a<=1.3*f.size&&f.size<b&&(c=f,b=f.size)}return c=c||d,c.videoTitle},_getVideoQuality:function(a,b,c){for(var d in this.QUALITY_TYPES){var e=this.QUALITY_TYPES[d][a];if(Array.isArray(e)||(e=[e]),-1!==e.indexOf(b))return this.QUALITY_TYPES[d]}return c?null:this.QUALITY_TYPES[this.DEFAULT_QUALITY_TYPE]},_getTypeByQualityType:function(a){for(var b in this.QUALITY_TYPES)if(a===b||a===this.QUALITY_TYPES[b].videoTitle||a===this.QUALITY_TYPES[b].audioTitle)return this.QUALITY_TYPES[b];return this.QUALITY_TYPES[this.DEFAULT_QUALITY_TYPE]},_calculateWeight:function(a,b){var c=MEDIA_TYPES[a.get("type")].extensions,d=c.indexOf(a.get("ext")),e=this._getTypeByQualityType(a.get("quality")).qualityIndex,f=d/c.length+Math.abs(b-e)/7;return f},getQualityLevelByType:function(a){return Object.keys(this.QUALITY_TYPES).indexOf(this._getTypeByQualityType(a).videoTitle)},getVideoQualityIndex:function(a){return this.VIDEO_QUALITY_LEVELS.concat().reverse().indexOf(a)},getOneClickQualityIndex:function(a){return this.QUALITY_LEVELS.concat().reverse().indexOf(a)},getQualityLevelByQualityType:function(a){return this._getTypeByQualityType(a).quality},chooseBestDownload:function(a,b,c){var d=a.length;if(c)for(var e=0;d>e;++e){var f=a[e];if(f.extQuality()===c)return f}b=b||this.DEFAULT_QUALITY_LEVEL;for(var g=h[b],i=1e3,j=-1,e=0;d>e;++e){var f=a[e],k=this._calculateWeight(f,g);i>k&&(i=k,j=e)}return a[j]}},window.quality=new f;var i,j=function(){const a=0,b=10,c=20,d=30;var e=0;if(chrome.extension.getBackgroundPage)switch(document.location.pathname){case"/popup.html":e=a;break;case"/options.html":e=b;break;case"/background.html":e=d;break;default:return}else e=c;var f;return chrome.metricsPrivate?f=function(a,b){chrome.metricsPrivate.recordSmallCount("Savior."+a,b)}:e===c?f=function(a,b){chrome.runtime.sendMessage({requestType:"metrics",method:"log",params:{name:a,value:b}})}:(console.warn("Metrics are not logged"),f=function(a,b){console.info("Metrics",a,b)}),{log:function(a,b){"PageShown"!==a&&(b+=e),"ButtonClicked"===a?a="TryItNowButtonClicked":"CheckBoxClicked"===a&&(a="OneClickCheckbox"),f(a,b)},doLog:e===d?f:null,PAGE_WELCOME_SCREEN:0,PAGE_DOWNLOADS_LIST:1,PAGE_ONE_CLICK_DOWNLOAD:2,PAGE_NO_MEDIA_FOUND:3,PAGE_OPTIONS:4,PAGE_CONTENT_SHOW_CONTROLS:5,PAGE_CONTENT_NO_MEDIA:9,DOWNLOAD_AUTO:0,DOWNLOAD_BUTTON:1,DOWNLOAD_ALL:2,DOWNLOAD_REQUEST_SIZE:3,DOWNLOAD_REQUEST_SIZE_FAILED:4,DOWNLOAD_CANCELED:7,BUTTON_MAIN:0,BUTTON_TRY_IT_NOW:1,BUTTON_SHOW_DOWNLOADS:2,BUTTON_HIDE_DOWNLOADS:3,BUTTON_DOWNLOAD_ALL:4,BUTTON_CHECK_ALL:5,BUTTON_CHECK_NONE:6,BUTTON_FAKE_QUALITY:7,CHECK_BOX_ENABLE_ONE_CLICK:0,CHECK_BOX_SHOW_ON_PAGE_BUTTONS:2}}(),k=30720;i=chrome.storage?chrome.extension.getBackgroundPage().options:{preferred_quality_level:"High",one_click:!0,get:function(a){return this[a]},load:function(){return{done:function(a){a()}}},set:function(){console.log("set",arguments[0],"to",arguments[1])}},i.load().done(function(){function c(){var c=i.get("preferred_quality_level"),e=i.get("min_stream_size")||k,f={onPageButtonsEnabled:i.get("on_page_buttons"),isOneClickEnabled:i.get("one_click"),minStreamSize:e,minStreamSizeValue:a.beautifyFileSize(e),qLevels:quality.QUALITY_LEVELS.map(function(a){return{i18n_ql_title:b("ql_"+a.toLowerCase()),qLevelName:a,isChecked:a===c}}),i18n_options_title:b("options_title"),i18n_show_on_page_buttons:b("options_show_on_page_buttons"),i18n_one_click:b("options_one_click"),i18n_preferred_quality:b("popup_preferred_quality"),i18n_min_stream_szie:b("options_min_stream_size"),i18n_save_and_close:b("options_save_and_close")},g=a.query("#options-template").textContent;d.innerHTML=Mustache.render(g,f)}var d=a.query("#options");c(),d.addEventListener("click",function(a){var b=a.target;if(b.classList.contains("close-button"))return void window.close();switch(b.id){case"on-page-buttons":var c=!!b.checked;return i.set("on_page_buttons",c),void j.log("CheckBoxClicked",j.CHECK_BOX_SHOW_ON_PAGE_BUTTONS+c);case"one-click-download":var c=!!b.checked;return i.set("one_click",c),void j.log("CheckBoxClicked",j.CHECK_BOX_ENABLE_ONE_CLICK+c)}switch(b.getAttribute("type")){case"radio":i.set("preferred_quality_level",b.value),j.log("OneClickQualityChanged",quality.getOneClickQualityIndex(b.value))}},!1),d.addEventListener("change",function(){var b=a.query("#min-stream-size"),c=a.query("#min-stream-size-value"),d=+b.value;i.set("min_stream_size",d),c.textContent=a.beautifyFileSize(d)},!1),j.log("PageShown",j.PAGE_OPTIONS),window.addEventListener("focus",function(){c()},!1)})}();