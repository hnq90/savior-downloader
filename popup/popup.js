!function(a,b,c){function d(a,c){function d(){for(var a=10,b=c.scrollTop,d=-1;f-1>d&&e[d+1].top<=b;)d++;return-1===d?!1:(g!==d&&(-1!==g&&(e[g].node.style.position="static",e[g].placeholder.hidden=!0),e[d].node.style.position="fixed",e[d].placeholder.hidden=!1,g=d),d!==f-1&&b+e[d].height>e[d+1].top?(e[d].node.style.top=a-(b+e[d].height-e[d+1].top)+"px",e[d].node.classList.contains("pulled")||e[d].node.classList.add("pulled")):(e[d].node.style.top=a+"px",e[d].node.classList.contains("pulled")&&e[d].node.classList.remove("pulled")),!1)}var e=[],f=a.length,g=-1;1>f||(c.style.position="relative",e=a.map(function(a){var c=b.createElement("div");return c.style.height=a.offsetHeight+"px",c.hidden=!0,a.parentNode.insertBefore(c,a),{node:a,top:a.offsetTop,height:a.offsetHeight,placeholder:c}}),c.addEventListener("scroll",d,!1))}function e(a){this._widget=a,this._downloads=null,location.protocol.includes("chrome")&&location.pathname.includes("popup.html")&&this.initPlayNowListener()}function f(){t.done(function(a){chrome.tabs.connect(a,{name:"overlay"})})}function g(){setTimeout(function(){a&&a.close()},500)}var h;!function(a){"undefined"!=typeof module&&module.exports?module.exports=a:"function"==typeof define?define(a):h=a}(function(){function a(a,b){return RegExp.prototype.test.call(a,b)}function b(b){return!a(p,b)}function c(a){return a.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function d(a){return String(a).replace(/[&<>"'\/]/g,function(a){return u[a]})}function e(a){this.string=a,this.tail=a,this.pos=0}function f(a,b){this.view=a,this.parent=b,this.clearCache()}function g(){this.clearCache()}function h(a){for(var b,c=a[3],d=c;(b=a[4])&&b.length;)a=b[b.length-1],d=a[3];return[c,d]}function i(a){function b(a,b,c){if(!d[a]){var e=i(b);d[a]=function(a,b){return e(a,b,c)}}return d[a]}function c(c,d,e){for(var f,g,i="",j=0,k=a.length;k>j;++j)switch(f=a[j],f[0]){case"#":g=e.slice.apply(e,h(f)),i+=c._section(f[1],d,g,b(j,f[4],e));break;case"^":i+=c._inverted(f[1],d,b(j,f[4],e));break;case">":i+=c._partial(f[1],d);break;case"&":i+=c._name(f[1],d);break;case"name":i+=c._escaped(f[1],d);break;case"text":i+=f[1]}return i}var d={};return c}function j(a){for(var b,c,d=[],e=d,f=[],g=0;g<a.length;++g)switch(b=a[g],b[0]){case"#":case"^":b[4]=[],f.push(b),e.push(b),e=b[4];break;case"/":if(0===f.length)throw new Error("Unopened section: "+b[1]);if(c=f.pop(),c[1]!==b[1])throw new Error("Unclosed section: "+c[1]);e=f.length>0?f[f.length-1][4]:d;break;default:e.push(b)}if(c=f.pop())throw new Error("Unclosed section: "+c[1]);return d}function k(a){for(var b,c,d=0;d<a.length;++d)b=a[d],c&&"text"===c[0]&&"text"===b[0]?(c[1]+=b[1],c[3]=b[3],a.splice(d--,1)):c=b}function l(a){if(2!==a.length)throw new Error("Invalid tags: "+a.join(" "));return[new RegExp(c(a[0])+"\\s*"),new RegExp("\\s*"+c(a[1]))]}var m={};m.name="mustache.js",m.version="0.7.0",m.tags=["{{","}}"],m.Scanner=e,m.Context=f,m.Writer=g;var n=/\s*/,o=/\s+/,p=/\S/,q=/\s*=/,r=/\s*\}/,s=/#|\^|\/|>|\{|&|=|!/,t=Array.isArray||function(a){return"[object Array]"===Object.prototype.toString.call(a)},u={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};m.escape=d,e.prototype.eos=function(){return""===this.tail},e.prototype.scan=function(a){var b=this.tail.match(a);return b&&0===b.index?(this.tail=this.tail.substring(b[0].length),this.pos+=b[0].length,b[0]):""},e.prototype.scanUntil=function(a){var b,c=this.tail.search(a);switch(c){case-1:b=this.tail,this.pos+=this.tail.length,this.tail="";break;case 0:b="";break;default:b=this.tail.substring(0,c),this.tail=this.tail.substring(c),this.pos+=c}return b},f.make=function(a){return a instanceof f?a:new f(a)},f.prototype.clearCache=function(){this._cache={}},f.prototype.push=function(a){return new f(a,this)},f.prototype.lookup=function(a){var b=this._cache[a];if(!b){if("."===a)b=this.view;else for(var c=this;c;){if(a.indexOf(".")>0){var d=a.split("."),e=0;for(b=c.view;b&&e<d.length;)b=b[d[e++]]}else b=c.view[a];if(null!=b)break;c=c.parent}this._cache[a]=b}return"function"==typeof b&&(b=b.call(this.view)),b},g.prototype.clearCache=function(){this._cache={},this._partialCache={}},g.prototype.compile=function(a,b){return this._compile(this._cache,a,a,b)},g.prototype.compilePartial=function(a,b,c){return this._compile(this._partialCache,a,b,c)},g.prototype.render=function(a,b,c){return this.compile(a)(b,c)},g.prototype._compile=function(a,b,c,d){if(!a[b]){var e=m.parse(c,d),g=i(e),h=this;a[b]=function(a,b){if(b)if("function"==typeof b)h._loadPartial=b;else for(var d in b)h.compilePartial(d,b[d]);return g(h,f.make(a),c)}}return a[b]},g.prototype._section=function(a,b,c,d){var e=b.lookup(a);switch(typeof e){case"object":if(t(e)){for(var f="",g=0,h=e.length;h>g;++g)f+=d(this,b.push(e[g]));return f}return e?d(this,b.push(e)):"";case"function":var i=this,j=function(a){return i.render(a,b)};return e.call(b.view,c,j)||"";default:if(e)return d(this,b)}return""},g.prototype._inverted=function(a,b,c){var d=b.lookup(a);return!d||t(d)&&0===d.length?c(this,b):""},g.prototype._partial=function(a,b){a in this._partialCache||!this._loadPartial||this.compilePartial(a,this._loadPartial(a));var c=this._partialCache[a];return c?c(b):""},g.prototype._name=function(a,b){var c=b.lookup(a);return"function"==typeof c&&(c=c.call(b.view)),null==c?"":String(c)},g.prototype._escaped=function(a,b){return m.escape(this._name(a,b))},m.parse=function(a,d){function f(){if(x&&!y)for(;w.length;)v.splice(w.pop(),1);else w=[];x=!1,y=!1}d=d||m.tags;for(var g,h,i,p,t=l(d),u=new e(a),v=[],w=[],x=!1,y=!1;!u.eos();){if(g=u.pos,i=u.scanUntil(t[0]))for(var z=0,A=i.length;A>z;++z)p=i.charAt(z),b(p)?w.push(v.length):y=!0,v.push(["text",p,g,g+1]),g+=1,"\n"===p&&f();if(g=u.pos,!u.scan(t[0]))break;if(x=!0,h=u.scan(s)||"name",u.scan(n),"="===h)i=u.scanUntil(q),u.scan(q),u.scanUntil(t[1]);else if("{"===h){var B=new RegExp("\\s*"+c("}"+d[1]));i=u.scanUntil(B),u.scan(r),u.scanUntil(t[1]),h="&"}else i=u.scanUntil(t[1]);if(!u.scan(t[1]))throw new Error("Unclosed tag at "+u.pos);v.push([h,i,g,u.pos]),("name"===h||"{"===h||"&"===h)&&(y=!0),"="===h&&(d=i.split(o),t=l(d))}return k(v),j(v)};var v=new g;return m.clearCache=function(){return v.clearCache()},m.compile=function(a,b){return v.compile(a,b)},m.compilePartial=function(a,b,c){return v.compilePartial(a,b,c)},m.render=function(a,b,c){return v.render(a,b,c)},m.to_html=function(a,b,c,d){var e=m.render(a,b,c);return"function"!=typeof d?e:void d(e)},m}());const i={audio:{title:"Audio",rgxp:/audio/i,extensions:["mp3","flac","m4a","wma","ogg","wav","aif","mid","opus"],ctype2extension:{midi:"mid",mp4:"m4a",m4a:"m4a",mpeg:"mp3",mpeg3:"mp3",wav:"wav",aiff:"aif",opus:"opus"}},video:{title:"Video",rgxp:/video/i,extensions:["mp4","mpeg4","mp3","mpg","mpeg","m4v","avi","divx","mov","wmv","movie","asf","webm","flv","3gp","yt_srt"],ctype2extension:{mpeg:"mp4",mp4:"mp4",m4v:"mp4","3gpp":"3gp",flv:"flv",quicktime:"mov",msvideo:"avi","ms-wmv":"wmv","ms-asf":"asf"}}},j=function(){var a={};return Object.keys(i).forEach(function(b){for(var c=i[b].extensions,d=0;d<c.length;d++)a[c[d]]=b}),a}();var k=(function(){function a(a,b){var c=a[0]-b[0];return 0!==c?c:(c=a[1]-b[1],0!==c?c:(c=a[2]-b[2],0!==c?c:c=a[3]-b[3]))}var b="",c={mp4:!0},d=0,e=0,f=0,g=0,h=navigator.userAgent.match(/Chrome\/([\d\.]+)/);return h&&h[1]&&(h=h[1].split("."),h=[+h[0],+h[1],+h[2],+h[3]],a(h,[39,0,2171,103])>=0&&(b+=" webm!",c.webm=!0),a(h,[39,0,2171,105])>=0&&(b+=" m3u8!",d=1),a(h,[55,4,2883,114])>=1&&(b+=" soundOnly!",e=1),a(h,[55,4,2883,114])>=1&&(b+=" Subtitles!",f=1),a(h,[55,4,2883,126])>=1&&(b+=" PlayNowBottomTooltip!",g=1)),{YT:c,M3U8:d,SOUND_ONLY:e,SUBTITLES:f,PLAY_NOW_BOTTOM_TOOLTIP:g}}(),function(){function a(a){return a&&0!==a.indexOf("data:image")?f.exec(a):[]}var c=b.createElement("a"),d=/([^\/]+)$/i,e=/\.([^\/.]*)$/i,f={strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}.strict,g=a(b.location.href);return{parse:function(a,b){var f=c;f.setAttribute("href",a);var g=(f.pathname.match(d)||[])[1]||"",h=g.split(".").map(function(a){return a.toLowerCase()});g=decodeURIComponent(g.replace(e,"")),h.shift();var i=h[h.length-1]||"",j={url:a,protocol:f.protocol,host:f.host,port:f.port,pathname:f.pathname,filename:g,ext:i,exts:h,hash:f.hash,search:f.search};return j.port||delete j.port,b&&(j.query={},f.search.replace(/^\?/,"").split(/\&/).forEach(function(a){a=a.split("="),j.query[a[0]]=a[1]})),j},parseParamString:function(a){a=a.replace(/^[#?]{1}/,"");var b=a.split("&"),c={};return b.forEach(function(a){var b=a.split("=");l.defined(b[0])&&l.defined(b[1])&&(c[b[0]]=decodeURIComponent(b[1].replace(/\+/g," ")))}),c},format:function(a){if(a=Object.create(a),a.query){a.search=[];for(var b in a.query)"undefined"!=typeof a.query[b]?a.search.push(b+"="+encodeURIComponent(a.query[b])):a.search.push(b);a.search="?"+a.search.join("&"),delete a.query}for(var d in a)c[d]=a[d];var e=c.href;return e},parse0:a,resolve:function(b,c){b=a(b),c||(c=g);var d=b[1],e=b[2],f=b[9],h=b[12],i=b[13];if(!d&&(d=c[1],!e))if(e=c[2],f){if("/"!==f.charAt(0)){var j=c[10]||"/";f=j+f}}else f=c[9],h||(h=c[12]);var k=d+"://"+e+f;return h&&(k+="?"+h),i&&(k+="#"+i),k},getHost:function(b){return a(b)[6]||""},getMediaType:function(b){var c=a(b)[11]||"";if(!c)return"";var d=c.split("."),e=d.length-1;if(0>=e)return"";var f=d[e].toLowerCase();return j[f]}}}()),l={SIZES:["B","KB","MB","GB","TB","PB"],_BASE:-1!==navigator.appVersion.indexOf("Win")?1024:1e3,xmlParser:new DOMParser,endsWith:function(a,b){var c=a.length-b.length;return c>=0&&a.indexOf(b,c)===c},hash:function(a,b){if(b=0|b,0===a.length)return b;var c,d;for(c=0,d=a.length;d>c;c++)b=(b<<5)-b+a.charCodeAt(c),b|=0;return b},query:function(a,c){return c=c||b,c.querySelector(a)},queryAll:function(a,c){return c=c||b,l.toArray(c.querySelectorAll(a))},findParent:function(a,b){for(;null!==a&&!a.classList.contains(b);)a=a.parentNode;return a},nearestParent:function(a,c){for(;null!==a&&a!==b&&!a.matches(c);)a=a.parentNode;return a},closest:function(a,b){return a.matches(b)?[a]:l.queryAll(b,a)},getNodePropOrEmptyString:function(a,b){return a&&a[b]||""},toArray:function(a){return Array.prototype.slice.call(a)},unique:function(a){var b=[];return Array.isArray(a)?(a.forEach(function(a){-1===b.indexOf(a)&&b.push(a)}),b):a},extend:function(a,b){var c=function(){};c.prototype=a.prototype,b.prototype=new c,b.prototype.constructor=b,b._super=a.prototype},extendObject:function(a){return Array.prototype.forEach.call(Array.prototype.slice.call(arguments,1),function(b){if(b)for(var c in b)a[c]=b[c]}),a},isMatches:function(a,b){var c,d,e;if(Array.isArray(a)){for(c=0;c<a.length;++c)if(l.isMatches(a[c],b))return!0;return!1}for(b=Array.isArray(b)?b:[b],c=0,d=b.length,e;d>c;++c)if(e=b[c],"string"==typeof e&&-1!==a.indexOf(e)||e instanceof RegExp&&a.match(e))return!0;return!1},_sendBackgroundRequest:function(a,b,c,d){var e=new o;return chrome.runtime.sendMessage({requestType:"make_http_request",method:a,url:b,params:c,headers:d},function(a){e[a.success?"resolve":"reject"](a.data)}),e},getYoutubeInfo:function(a){var b=new o;return chrome.runtime.sendMessage({requestType:"youtube_get_info",method:"GET",url:a},function(a){b[a.success?"resolve":"reject"](a.data)}),b},send:function(a,b,c,d){var e=new o,f=null;if(l.IS_CONTENT_SCRIPT)return l._sendBackgroundRequest(a,b,c,d);try{var g=new XMLHttpRequest;if(g.open(a,b,!0),g.setRequestHeader("Cache-Control","no-cache"),"object"==typeof c&&(f=Object.keys(c).map(function(a){return a+"="+c[a]}).join("&")),"object"==typeof d)for(var h in d)g.setRequestHeader(h,d[h]);"POST"===a&&(g.setRequestHeader("Content-type","application/x-www-form-urlencoded"),f&&g.setRequestHeader("Content-Length",f.length)),g.onload=function(){e.resolve(this.responseText)},g.onerror=function(){e.reject()},g.send(f)}catch(i){e.reject()}return e},get:function(a,b){return l.send("GET",a,{},b)},post:function(a,b,c){return l.send("POST",a,b,c)},_getSize:function(a){function b(a){d&&d[a?"resolve":"reject"](a),d=null,c.abort(),clearTimeout(e),e=null}var c=new XMLHttpRequest,d=new o,e=null,f=1e4;return c.open("GET",a),c.setRequestHeader("Cache-Control","no-cache"),c.url=a,c.onreadystatechange=function(){if(!(this.readyState<2)){var a=null;try{a=+this.getResponseHeader("Content-Length"),Number.isNaN(a)&&(a=null)}catch(c){}(null!==a||200===this.status)&&(200!==this.status&&(a=null),b(a))}},c.send(null),e=setTimeout(b,f),d},getSize:function(b){var c=new o,d=a.cache;return d.get(b).success(function(a){a?(c.resolve(a),d.put(b,a)):c.bind(l._getSize(b)).success(d.put.bind(d,b))}).fail(function(){c.bind(l._getSize(b)).success(d.put.bind(d,b))}),c},beautifyFileSize:function(a,b){if(null===a||"undefined"==typeof a)return"???";for(var c=l._BASE,d=0;d<l.SIZES.length&&a>=c;++d,a/=c);const e=l.SIZES[d];var f=Math.round(10*a)/10;return b&&e&&"kb"===e.toLowerCase()&&(f=f.toFixed(0)),f+l.SIZES[d]},detectMediaTypeAndExt:function(a,b){b=b||"";var c=["application/x-mpegurl","application/vnd.apple.mpegurl","audio/x-mpegurl","audio/mpegurl"];if(-1!==c.indexOf(b))return a.type="video",a.ext="m3u8",a;var d=l.getMediaType(b,a.exts);return d&&i[d]&&(a.type=d,a.ext=this._findIntersection(a.exts,i[d].extensions)||l.extByContentType(b,d)||a.ext),a},getMediaType:function(a,b){var c;for(var d in i){if(c=i[d],a.match(c.rgxp))return d;if(Array.isArray(b)&&l._findIntersection(b,c.extensions)||-1!==c.extensions.indexOf(b))return d}return null},_findIntersection:function(a,b){for(var c=a.concat(b),d={},e=0;e<c.length;++e){var f=c[e];if(d[f])return f;d[f]=!0}return null},extByContentType:function(a,b){var c=i[b].ctype2extension;for(var d in c)if(-1!==a.indexOf(d))return c[d];return null},getProp:function(a,b){function c(a,b){var d=b.shift();return!d||"object"!=typeof a&&"function"!=typeof a||null===a?void 0:0===b.length?a[d]:c(a[d],b)}return c(a,b.split("."))},call:function(a,b){if(a&&!(a.length<=0))for(var c=[].slice.call(arguments,2),d=0;d<a.length;d++)a[d].apply(b,c)},isTrue:function(a){return!!a},noop:function(){},defined:function(a){return"undefined"!=typeof a},notNull:function(a){return null!==a},debounce:function(a,b,c){var d;return function(){function e(){c||a.apply(f,g),d=null}var f=this,g=arguments;d?clearTimeout(d):c&&a.apply(f,g),d=setTimeout(e,b||100)}},unescapeHTML:function(){var a;return function(c){a=a||b.createElement("div"),a.innerHTML=(""+c).replace(/</g,"&lt;");var d=a.firstChild.textContent;return a.innerHTML="",d}}(),replaceEntities:function(a){var b={"&amp;":"&"};return String(a).replace(/&amp;/g,function(a){return b[a]})},isFullscreen:function(){return Boolean(b.fullscreenElement||b.webkitFullscreenElement)},splitMediaSourcesByFilename:function(a){const b=new Map;return a.forEach(function(a){const c=a.filename;b.has(c)?b.set(c,b.get(c).concat(a)):b.set(c,[a])}),b},xpath:function(){function a(a){return a&&a.id&&!/\d/.test(a.id)?"//"+a.tagName+'[@id="'+a.id+'"]':c(a)}function c(a){for(var b=[];a&&a.nodeType==Node.ELEMENT_NODE;a=a.parentNode){for(var c=0,d=!1,e=a.previousSibling;e;e=e.previousSibling)e.nodeType!=Node.DOCUMENT_TYPE_NODE&&e.nodeName==a.nodeName&&++c;for(e=a.nextSibling;e&&!d;e=e.nextSibling)e.nodeName==a.nodeName&&(d=!0);var f=(a.prefix?a.prefix+":":"")+a.localName,g=c||d?"["+(c+1)+"]":"";b.splice(0,0,f+g)}return b.length?"/"+b.join("/"):null}function d(a,c){return c=c||b,b.evaluate(a,c,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue}return{forElement:a,find:d}}(),dom:function(){function a(a,b){return Object.keys(b).forEach(function(c){a.setAttribute(c,b[c])}),a}function c(a,b){return Object.keys(b).forEach(function(c){a.style[c]=b[c]}),a}function d(a){var c=b.createElement("div"),d=b.createDocumentFragment();return c.innerHTML=a,[].slice.call(c.childNodes).forEach(d.appendChild,d),c=null,d}function e(a){if(!(a instanceof HTMLElement))return{width:0,height:0};a.matches("embed")&&a.parentNode.matches("object")&&(a=a.parentNode);var b=a.querySelector("embed");return b&&!adFilter.check(b)&&b.offsetWidth&&b.offsetHeight&&(a=b),{width:a.offsetWidth,height:a.offsetHeight}}function f(a){return a.split(";").reduce(function(a,b){var c=b.indexOf(":");if(-1!==c){var d=b.substr(0,c).trim(),e=b.substr(c+1).trim();a[d]=e}return a},{})}function g(a){return Object.keys(a).map(function(b){return b+": "+a[b]}).join("; ")+";"}function h(a){for(var b={top:0,left:0,height:a.offsetHeight,width:a.offsetWidth};a;)b.left+=a.offsetLeft,b.top+=a.offsetTop,a=a.offsetParent;return b}return{attr:function(b,c){Array.isArray(b)?b.forEach(function(b){a(b,c)}):a(b,c)},style:function(a,b){Array.isArray(a)?a.forEach(function(a){c(a,b)}):c(a,b)},setStyleAttr:function(a,b){var c=function(a){var c=a.getAttribute("style")||"",d=f(c);for(var e in b)b.hasOwnProperty(e)&&(d[e]=b[e]);var h=g(d);c!==h&&a.setAttribute("style",h)}.bind(this);Array.isArray(a)?a.forEach(c):c(a)},parseStyleAttr:f,parseHTML:d,getOffset:h,getEmbedSize:e}}(),google:function(){var a="com|ac|ad|ae|al|am|as|at|az|ba|be|bf|bg|bi|bj|bs|bt|by|ca|cc|cd|cf|cat|cg|ch|ci|cl|cm|cn|cv|cz|de|dj|dk|ee|fi|dm|dz|es|fm|fr|ga|ge|gf|gg|gl|gm|gp|gr|gy|hn|hr|ht|hu|ir|iq|ie|im|io|is|it|je|ki|kg|jo|kz|la|lt|lu|lv|li|lk|md|me|mg|mk|ml|mn|ms|mu|mv|mw|nl|no|nr|nu|pl|ne|pn|ps|pt|ro|rs|ru|rw|sc|se|sh|si|sn|sm|so|tk|tl|tm|to|tn|st|sk|tt|td|vu|ws|vg|tg|us",b="th|id|il|in|jp|ke|ma|kr|mz|ls|nz|tz|ug|uk|uz|ve|vi|za|zm|zw|ao|ck|bw|cr",c="pr|py|qa|sa|sb|sg|sl|sv|tj|tn|tr|tw|gh|gi|gt|hk|jm|kw|lb|lc|ly|mm|mt|mx|my|na|nf|ng|ni|np|om|pa|pe|ph|pk|pg|ua|uy|vc|vn|af|ag|ai|ar|au|bd|bh|bn|bo|br|bz|kh|co|cu|cy|do|ec|eg|et|fj",d=new RegExp("^(www\\.)?google\\.(("+a+")|(co((\\.("+b+"))|m\\.("+c+"))))$","i"),e=/[&?]q=[^&]/i;return{isSERPHost:function(a){return Boolean(a.match(d))},isSERPRequest:function(a){var b=k.parse(a);return Boolean(this.isSERPHost(b.host)&&b.pathname.match(/\/s(earch)?/i)&&b.search.match(e))},getSearchParams:function(a){var b=k.parse(a),c=k.parseParamString(b.search),d=k.parseParamString(b.hash||"#"),e=l.defined(d.q);return{_rawSearch:c,_rawHash:d,q:e?d.q:c.q||null,s:e?d.start||0:c.start||0,tbm:e?d.tbm:c.tbm||null,isXHR:c.tch,isHash:e}}}}()};a.SAVIOR_VERSION=a.SAVIOR_VERSION||"dev";try{var m=chrome.i18n.getMessage}catch(n){}try{chrome.extension.getBackgroundPage(),l.IS_CONTENT_SCRIPT=!1}catch(n){l.IS_CONTENT_SCRIPT=!0}try{l.IS_INCOGNITO=chrome.extension.inIncognitoContext}catch(n){l.IS_INCOGNITO=!1}var o=function(a){if(0===arguments.length)return this._init(),this;if(a instanceof o)return a;var b=new o;return b.resolve(a),b};o.RUNNING=0,o.RESOLVED=1,o.FAILED=2,o.prototype={constructor:o,_init:function(){this._results=[],this._subscribers=[],this.state=o.RUNNING},_notify:function(){var a=this;this._subscribers.forEach(function(b){b.apply(a,a._results)}),this._subscribers=[]},resolve:function(){return this.state=o.RESOLVED,this._results=arguments,this._notify(),this},reject:function(){return this.state=o.FAILED,this._results=arguments,this._notify(),this},subscribe:function(a){this.state!==o.RUNNING?a.apply(this,this._results):this._subscribers.push(a)},done:function(a){return this.subscribe(a),this},success:function(a){var b=this;return this.subscribe(function(){b.state===o.RESOLVED&&a.apply(b,b._results)}),this},fail:function(a){var b=this;return this.subscribe(function(){b.state===o.FAILED&&a.apply(b,b._results)}),this},bind:function(a){return a=new o(a),a.success(this.resolve.bind(this)).fail(this.reject.bind(this)),this}},o.when=function(){var a=[];return a=Array.isArray(arguments[0])?arguments[0]:l.toArray(arguments),new o.When(a)},o.When=function(a){this._doneCallbacks=[],this._successCallbacks=[],this._failCallbacks=[],this._state=o.RUNNING,this._thingsToDo=a.length,this._results=Array(this._thingsToDo),this._init(a)},o.When.prototype={constructor:o.When,_init:function(a){var b=this;a.forEach(function(a,c){a=new o(a),a.subscribe(function(){a.state===o.FAILED&&(b._state=o.FAILED),b._results[c]=l.toArray(arguments),b._thingsToDo--,b._checkIsDone()})}),this._checkIsDone()},_checkIsDone:function(){if(0!==this._thingsToDo)return!1;var a=[];this._results.forEach(function(b){a=a.concat(b)}),this._state===o.FAILED?this._runCallbacks(this._failCallbacks,a):this._runCallbacks(this._successCallbacks,a),this._runCallbacks(this._doneCallbacks,a),this._doneCallbacks=[],this._successCallbacks=[],this._failCallbacks=[]},_runCallbacks:function(a,b){a.forEach(function(a){a.apply(this,b)})},done:function(a){return this._doneCallbacks.push(a),this._checkIsDone(),this},success:function(a){return this._successCallbacks.push(a),this._checkIsDone(),this},fail:function(a){return this._failCallbacks.push(a),this._checkIsDone(),this}},o.chain=function(){function a(b){if(!b.length)return c.resolve.apply(c,d);var e,f=b.shift();"function"==typeof f?(e=o(f()),e.done(function(c){d.push(c),a(b)})):(d.push(f),a(b))}var b,c=new o,d=[];return b=Array.isArray(arguments[0])?arguments[0]:l.toArray(arguments),a(b),c};var p=function(){};p.QL_HIGH="High",p.QL_MEDIUM="Medium",p.QL_LOW="Low",p.QL_VIDEO_ULTRAHD="Ultra HD",p.QL_VIDEO_FULLHD="Full HD",p.QL_VIDEO_HD="HD",p.QL_VIDEO_STANDARD="Standard",p.QL_VIDEO_MEDIUM="Medium",p.QL_VIDEO_SMALL="Small",p.QL_VIDEO_MOBILE="Mobile";var q={};q[p.QL_VIDEO_ULTRAHD]={quality:p.QL_HIGH,qualityIndex:6,size:3072,videoTitle:"Ultra HD",itag:[38,138]},q[p.QL_VIDEO_FULLHD]={quality:p.QL_HIGH,qualityIndex:5,size:1080,videoTitle:"Full HD",audioTitle:"High",itag:[37,46,137],vimeoQuality:"1080p",zingTag:"f1080",dailymotionQuality:"hd1080",clipvnQuality:"5"},q[p.QL_VIDEO_HD]={quality:p.QL_HIGH,qualityIndex:4,size:720,videoTitle:"HD",audioTitle:"High",itag:[22,45,120,136,247],zingTag:["f720","hq","320"],vimeoQuality:"720p",dailymotionQuality:["hd","hd720"],facebookQuality:["hd_src","hd_src_no_ratelimit"],JWQuality:"highquality",clipvnQuality:"4"},q[p.QL_VIDEO_STANDARD]={quality:p.QL_MEDIUM,qualityIndex:3,size:480,videoTitle:"Standard",audioTitle:"Normal",itag:[44,35,135,244],zingTag:["f480"],dailymotionQuality:"hq",vimeoQuality:"480p",facebookQuality:["sd_src","sd_src_no_ratelimit"],JWQuality:"location",clipvnQuality:"3"},q[p.QL_VIDEO_MEDIUM]={quality:p.QL_MEDIUM,qualityIndex:2,size:360,videoTitle:"Medium",audioTitle:"Normal",itag:[18,43,34,134,243],vimeoQuality:"360p",dailymotionQuality:"sd",zingTag:["source","f360","128"],JWQuality:"lowquality",clipvnQuality:"2"},q[p.QL_VIDEO_SMALL]={quality:p.QL_LOW,qualityIndex:1,size:240,videoTitle:"Small",audioTitle:"Low",itag:[36,5,133,242],dailymotionQuality:"ld",vimeoQuality:"270p",zingTag:["f","f240"],clipvnQuality:"1"},q[p.QL_VIDEO_MOBILE]={quality:p.QL_LOW,qualityIndex:0,size:144,videoTitle:"Mobile",audioTitle:"Low",itag:[17,6,160],vimeoQuality:"",clipvnQuality:"0"};var r={};r[p.QL_HIGH]=q[p.QL_VIDEO_ULTRAHD].qualityIndex,r[p.QL_MEDIUM]=q[p.QL_VIDEO_STANDARD].qualityIndex,r[p.QL_LOW]=q[p.QL_VIDEO_SMALL].qualityIndex,p.prototype={constructor:p,DEFAULT_QUALITY_LEVEL:p.QL_HIGH,QUALITY_LEVELS:[p.QL_HIGH,p.QL_MEDIUM,p.QL_LOW],VIDEO_QUALITY_LEVELS:[p.QL_VIDEO_ULTRAHD,p.QL_VIDEO_FULLHD,p.QL_VIDEO_HD,p.QL_VIDEO_STANDARD,p.QL_VIDEO_MEDIUM,p.QL_VIDEO_SMALL,p.QL_VIDEO_MOBILE],DEFAULT_QUALITY_TYPE:p.QL_VIDEO_STANDARD,QUALITY_TYPES:q,getFacebookQuality:function(a){return this._getVideoQuality("facebookQuality",a).videoTitle},getDailymotionQuality:function(a){return this._getVideoQuality("dailymotionQuality",a).videoTitle},getZingVideoQuality:function(a){return this._getVideoQuality("zingTag",a).videoTitle},getZingAudioQuality:function(a){return this._getVideoQuality("zingTag",a).audioTitle},getYoutubeQuality:function(a,b){var c=this._getVideoQuality("itag",+a,b);return c&&c.videoTitle},getVimeoQuality:function(a){return this._getVideoQuality("vimeoQuality",a).videoTitle},getClipvnQuality:function(a){return this._getVideoQuality("clipvnQuality",a).videoTitle},getJWQuality:function(a){return this._getVideoQuality("JWQuality",a).videoTitle},getQualityBySize:function(a){return this._getVideoQuality("size",a).videoTitle},getSizeByQuality:function(a){return(q[a]||{}).size||0},_getVideoQuality:function(a,b,c){for(var d in this.QUALITY_TYPES){var e=this.QUALITY_TYPES[d][a];if(Array.isArray(e)||(e=[e]),-1!==e.indexOf(b))return this.QUALITY_TYPES[d]}return c?null:this.QUALITY_TYPES[this.DEFAULT_QUALITY_TYPE]},_getTypeByQualityType:function(a){for(var b in this.QUALITY_TYPES)if(a===b||a===this.QUALITY_TYPES[b].videoTitle||a===this.QUALITY_TYPES[b].audioTitle)return this.QUALITY_TYPES[b];return this.QUALITY_TYPES[this.DEFAULT_QUALITY_TYPE]},_calculateWeight:function(a,b){var c=i[a.get("type")].extensions,d=c.indexOf(a.get("ext")),e=this._getTypeByQualityType(a.get("quality")).qualityIndex,f=d/c.length+Math.abs(b-e)/7;return f},getQualityLevelByType:function(a){return Object.keys(this.QUALITY_TYPES).indexOf(this._getTypeByQualityType(a).videoTitle)},getVideoQualityIndex:function(a){return this.VIDEO_QUALITY_LEVELS.concat().reverse().indexOf(a)},getOneClickQualityIndex:function(a){return this.QUALITY_LEVELS.concat().reverse().indexOf(a)},getQualityLevelByQualityType:function(a){return this._getTypeByQualityType(a).quality},chooseBestDownload:function(a,b,c){var d=a.length;if(c)for(var e=0;d>e;++e){var f=a[e];if(f.extQuality()===c)return f}b=b||this.DEFAULT_QUALITY_LEVEL;for(var g=r[b],h=1e3,i=-1,e=0;d>e;++e){var f=a[e],j=this._calculateWeight(f,g);h>j&&(h=j,i=e)}return a[i]}},a.quality=new p,function(){var c=function(){};c.SERVER_LOG_URL="https://coccoc.com/s_log",c.SOURCE_POPUP_PAGE=0,c.SOURCE_OPTIONS_PAGE=10,c.SOURCE_CONTENT_SCRIPT=20,c.SOURCE_BACKGROUND_PAGE=30,c.prototype={LEGACY_METRICS_NAME_MAP:{ButtonClicked:"TryItNowButtonClicked",CheckBoxClicked:"OneClickCheckbox"},get source(){if(!chrome.extension.getBackgroundPage)return c.SOURCE_CONTENT_SCRIPT;switch(b.location.pathname){case"/popup.html":return c.SOURCE_POPUP_PAGE;case"/options.html":return c.SOURCE_OPTIONS_PAGE;case"/background.html":return c.SOURCE_BACKGROUND_PAGE;default:return}},_getFullName:function(a){return"Savior."+(this.LEGACY_METRICS_NAME_MAP[a]||a)},_getTotalValue:function(a,b,c){var d=0===a.indexOf("Refr");return d||c||"PageShown"===a||"number"!=typeof b?b:b+this.source},_doLog:function(a,b,d){var e=this._getFullName(b);if(this.source===c.SOURCE_CONTENT_SCRIPT)chrome.runtime.sendMessage({requestType:"metrics",method:"log",params:{name:b,value:d}});else if(chrome.metricsPrivate)switch(a){case"recordSmallCount":chrome.metricsPrivate.recordValue({metricName:e,type:chrome.metricsPrivate.MetricTypeType.HISTOGRAM_LINEAR,min:0,max:100,buckets:100},d);break;case"recordValue":chrome.metricsPrivate.recordValue({metricName:e,type:chrome.metricsPrivate.MetricTypeType.HISTOGRAM_LINEAR,min:0,max:1e3,buckets:1002},d);break;case"recordSerpData":case"recordClickData":chrome.metricsPrivate[a](d)}},_getMethodByName:function(a){switch(a){case"Refr":case"RefrSE":case"RefrFE":return"recordValue";case"SerpData":return"recordSerpData";case"SerpClickData":return"recordClickData";default:return"recordSmallCount"}},log:function(a,b,c){var d=this._getMethodByName(a),e=this._getTotalValue(a,b,c);this._doLog(d,a,e)},logFromContentScript:function(a,b){this.log(a,b,!0)},serverLog:function(a,b){var d=new Image,e=[];b=Object.assign({action:a,source:this.source,version:"0.17.2"},b),Object.keys(b).reduce(function(a,c){return e.push(c+"="+encodeURIComponent(b[c])),e},e),d.src=c.SERVER_LOG_URL+"?"+e.join("&")},PAGE_WELCOME_SCREEN:0,PAGE_DOWNLOADS_LIST:1,PAGE_ONE_CLICK_DOWNLOAD:2,PAGE_NO_MEDIA_FOUND:3,PAGE_OPTIONS:4,PAGE_CONTENT_SHOW_CONTROLS:5,PAGE_CONTENT_NO_MEDIA:9,DOWNLOAD_AUTO:0,DOWNLOAD_BUTTON:1,DOWNLOAD_ALL:2,DOWNLOAD_REQUEST_SIZE:3,DOWNLOAD_REQUEST_SIZE_FAILED:4,DOWNLOAD_SOUND_ONLY:5,DOWNLOAD_SUBTITLES:6,DOWNLOAD_CANCELED:7,BUTTON_MAIN:0,BUTTON_TRY_IT_NOW:1,BUTTON_SHOW_DOWNLOADS:2,BUTTON_HIDE_DOWNLOADS:3,BUTTON_DOWNLOAD_ALL:4,BUTTON_CHECK_ALL:5,BUTTON_CHECK_NONE:6,BUTTON_FAKE_QUALITY:7,BUTTON_DETACH:8,BUTTON_HIDE:9,CHECK_BOX_ENABLE_ONE_CLICK:0,CHECK_BOX_SHOW_ON_PAGE_BUTTONS:2,CHECK_BOX_PREFER_LAST_QUALITY:4,CHECK_BOX_DETACH_ENABLED:6,PIP_DETACH_CLICK:0,PIP_RESTORE_CLICK:1,PIP_SITE_LINK_CLICK:2,PLAY_NOW_SHOWN:0,PLAY_NOW_WIDGET_CLICKED:1,PLAY_NOW_TOOLTIP_SHOWN:2,PLAY_NOW_TOOLTIP_CLOSED:3,PLAY_NOW_TOOLTIP_NOT_SHOW_AGAIN:4,PLAY_NOW_TOOLTIP_BOTTOM_SHOWN:5,PLAY_NOW_TOOLTIP_BOTTOM_CLOSED:6,PLAY_NOW_TOOLTIP_BOTTOM_NOT_SHOW_AGAIN:7},a.metrics=new c}();var s=!l.IS_CONTENT_SCRIPT;e.prototype={setDownloads:function(a){this._downloads=a},render:function(b,c,e){c.downloads=this._downloads.group(),s&&(c.is_only=this._downloads.isOneMedia());var f=l.query("#downloads",this._widget);f.innerHTML=h.render(b,c,{media_template:a.options.get("template-media")}),f.classList.add("content");var g=this.applyCurrentValues(e);if(s){var i=l.query(".downloads-list",this._widget);i.scrollHeight>i.offsetHeight&&(d(l.queryAll("h1",this._widget),i),i.addEventListener("scroll",this._getSizeOfVisibleMedia.bind(this),!1),l.query("#close-popup",this._widget).classList.add("pulled")),this._widget.classList.add("done")}return g},initPlayNowListener:function(){chrome.runtime.onMessage.addListener(function(a,b,c){if("downloads"===a.requestType&&"widget_progress"===a.method){const d=a.params;if(d.mime&&d.mime.includes("video")&&!d.filename.match(/\.mp3$/)){const e=d.url,f=this._widget.querySelector('a[data-url="'+e+'"]');var g;if(!f)return;g=l.nearestParent(f,"li.j-media-scope"),d.exists&&(d.playable||"complete"===d.state)?this._handleProgress(g,d):"interrupted"!==d.state&&d.exists||this._changeWidgetMode(g,"select_media")}}}.bind(this))},_handleProgress:function(a,b){var c=0;const d=a.querySelector(".play-now-btn"),e=parseInt(d.dataset.downloadId);e&&e===b.id||(d.dataset.downloadId=b.id),a.matches(".progress-mode")||(this._changeWidgetMode(a,"progress"),metrics.log("PlayNow",metrics.PLAY_NOW_SHOWN)),c="complete"!==b.state?(b.bytesReceived/b.totalBytes*100).toFixed(0)+"%":"100%";const f=a.querySelector(".progress-bar .bar");f&&(f.style.width=c);const g=l.beautifyFileSize(b.totalBytes,!0),h=l.beautifyFileSize(b.bytesReceived,!0),i=a.querySelector(".progress-box .progress-text");i&&("100%"!==c?i.innerText=h+" "+m("play_now_received_from")+" "+g:i.innerText=g);const j=a.dataset.prevReceived||0,k=l.beautifyFileSize(b.bytesReceived-j,!0),n=a.querySelector(".progress-box .speed-text");n&&("100%"!==c?n.innerHTML='<span class="green-arrow">&#129095;</span> '+k+"/"+m("play_now_per_second"):n.innerHTML=""),a.dataset.prevReceived=b.bytesReceived},_changeWidgetMode:function(a,b){a.classList.remove("progress-mode","select-mode"),a.classList.add(b+"-mode")},_checkFileSize:function(a){var b=this._downloads.getMedia(a);b&&!b.get("size")&&(metrics.log("Download",metrics.DOWNLOAD_REQUEST_SIZE),b.getSize().done(function(a){var c=l.query("#size_"+b.id(),this._widget);c&&(c.classList.add("done"),c.textContent=b.size(),a||metrics.log("Download",metrics.DOWNLOAD_REQUEST_SIZE_FAILED))}.bind(this)))},_applyCurrentValues:function(a){var b=a.querySelector(".j-quality-selector"),c=b.value;l.queryAll(".j-quality-option, .j-quality-download",a).forEach(function(a){a.hidden=a.dataset.quality!==c,s||a.hidden||!a.classList.contains("j-quality-download")||this._checkFileSize(a.dataset.id)},this),s&&this._getSizeOfVisibleMedia()},applyCurrentValues:function(a){var b=this._downloads,c=options.get("prefer_last_quality")&&options.get("preferred_quality:"+a),d=l.queryAll(".j-media-scope",this._widget);return d.forEach(function(d){var e=l.queryAll(".j-quality-download",d);if(e.length>1){var f=e.map(function(a){return a.dataset.id}),g=quality.chooseBestDownload(b.getMediaGroup(f),a,c),h=l.query(".j-quality-selector",d);h&&(h.value=g.extQuality())}this._applyCurrentValues(d)},this),d},_getSizeOfVisibleMedia:function(){for(var a=l.query(".downloads-list",this._widget),b=a.scrollTop,c=a.offsetHeight,d=l.queryAll(".j-quality-download:not([hidden])",a),e=0,f=d.length;f>e;++e){var g=d[e];
if(g.offsetTop>b+c+10)break;this._checkFileSize(g.dataset.id)}},getMetricsParams:function(a,b){var c=a instanceof Node?a.dataset.id:a,d=this._downloads,e=d.getMedia(c),f=b||{},g=d.getAllMediaFormats(c),h=[];for(var i in g)h.push(i+":"+g[i].join("|"));var i=e.ext?e.ext():"unknown";return f.size=e.quality?quality.getSizeByQuality(e.quality()):0,f.ext=i,f.same_size_exts=d.getSameQualityMediaFormats(c).join("|"),f.same_ext_sizes=d.getSameFormatMediaQuality(c).join("|"),f.total=h.join(","),f},download:function(a){return a.classList.contains("j-disabled")?void 0:(a.classList.add("j-disabled"),a.classList.add("btn-progress"),this._downloads.download(a.dataset.id).success(function(){a.classList.remove("btn-progress"),a.classList.add("btn-started")}).fail(function(b){a.classList.remove("btn-progress"),a.classList.remove("j-disabled")}))}};var t=function(){var a=new o;return chrome.tabs.query({windowId:chrome.windows.WINDOW_ID_CURRENT,active:!0},function(b){var c=b&&b[0]&&b[0].id||-1;a.resolve(c)}),a}(),u=function(){var a=b.body;this._oneClickDownload=!1,this._dl=new e(a),this._init(a)};u.prototype={constructor:u,_init:function(a){var c=this;this._widget=a,this._oneClickBlock=l.query("#one-click-block"),this._template=l.query("#list-template").textContent,this._welcome=l.query("#welcome"),a.addEventListener("click",function(a){return c._onClick(a)?void 0:(a.stopPropagation(),!0)},!1),b.addEventListener("change",this._onSelectChange.bind(this),!1),this._oneClickDownload=!!options.get("one_click"),this._drawPopupContent()},_drawPopupContent:function(){var a=!0,b=!a&&!options.get("not_first_run");b&&(f(),this._showWelcomeScreen(),options.set("not_first_run",!0),metrics.log("PageShown",metrics.PAGE_WELCOME_SCREEN)),l.query("#downloads").hidden=b,this._welcome.hidden=!b},_showWelcomeScreen:function(){var a=l.query("#welcome-template").textContent,b=h.render(a,{i18n_welcome_title:m("popup_welcome_title"),i18n_welcome_text:m("popup_welcome_text"),i18n_welcome_button:m("popup_welcome_button")});this._welcome.innerHTML=b},_showOneClickDownloadScreen:function(a){var b=l.query("#one-click-template").textContent,c=h.render(b,{media:a,i18n_starting_download:m("popup_starting_download"),i18n_download_failed:m("popup_download_failed")});this._oneClickBlock.innerHTML=c,l.query("#downloads").hidden=!0,this._oneClickBlock.hidden=!1,metrics.log("PageShown",metrics.PAGE_ONE_CLICK_DOWNLOAD)},_onClick:function(c){var d=this,e=c.target;switch(e.id){case"close-popup":return void a.close();case"welcome-button":return d._drawPopupContent(),metrics.log("ButtonClicked",metrics.BUTTON_TRY_IT_NOW),void setTimeout(function(){b.body.offsetHeight},0)}switch(e.tagName){case"A":case"SPAN":var f=e;return"SPAN"===e.tagName.toUpperCase()&&(f=e.parentNode),f.classList.contains("j-quality-download")?void d._download(f):!0;case"INPUT":if(!e.classList.contains("j-one-click"))return!0;var h=!!e.checked;return options.set("one_click",h),void metrics.log("CheckBoxClicked",metrics.CHECK_BOX_ENABLE_ONE_CLICK+h);case"BUTTON":if(e.matches(".play-now-btn")){const i=parseInt(c.target.dataset.downloadId);chrome.runtime.sendMessage({method:"play",requestType:"downloads",params:i}),metrics.log("PlayNow",metrics.PLAY_NOW_WIDGET_CLICKED),g()}}return!0},_onSelectChange:function(a){var b=a.target;if("SELECT"===b.tagName){if("quality-level-selection"===b.id)options.set("preferred_quality_level",b.value),metrics.log("OneClickQualityChanged",quality.getOneClickQualityIndex(b.value));else{var c=b.value.split("/")[1],d=l.findParent(b,"j-media-scope");this._dl._applyCurrentValues(d),metrics.log("VideoQualityChanged",quality.getVideoQualityIndex(c))}return!1}},_render:function(){var a=options.get("preferred_quality_level");this._dl.render(this._template,{is_single:this._oneClickDownload,quality_levels:quality.QUALITY_LEVELS.map(function(b){return{i18n_ql_title:m("ql_"+b.toLowerCase()),name:b,is_checked:b===a}}),i18n_download:m("popup_download"),i18n_wait:m("popup_download_starting"),i18n_one_click:m("popup_one_click"),i18n_preferred_quality:m("popup_preferred_quality"),i18n_no_media_found:m("popup_no_media_found"),i18n_download_failed:m("popup_download_failed"),i18n_sound_only:m("popup_sound_only"),i18n_play_now:m("play_now_play_now"),has_pip:!1},a)},_showDownloadError:function(a){var b=this,c=l.query("#error-message");c.classList.add("visible"),b._errorTimeout&&clearTimeout(b._errorTimeout),b._errorTimeout=setTimeout(function(){c.classList.remove("visible")},5e3),chrome.extension.getBackgroundPage().console.error('Download has failed. Reason: "%s"',a.message)},_download:function(a){var b=this._dl.download(a);if(b){l.queryAll(".j-media-scope",this._widget).length<=1,b.fail(function(a){this._showDownloadError(a)}.bind(this)),metrics.log("Download",metrics.DOWNLOAD_BUTTON);var c=this._dl.getMetricsParams(a,{autoselect:0});metrics.serverLog("Download",c)}},setDownloads:function(a){var b=this;b._dl.setDownloads(a);var c=a.getMediaCount();if(b._oneClickDownload&&1===c){var d=options.get("preferred_quality_level"),e=options.get("prefer_last_quality")&&options.get("preferred_quality:"+d),f=quality.chooseBestDownload(a.data,d,e);b._showOneClickDownloadScreen(f),a.download(f.id()).success().fail(function(a){b._render(),l.query("#downloads").hidden=!1,b._oneClickBlock.hidden=!0,b._showDownloadError(a)}),metrics.log("Download",metrics.DOWNLOAD_AUTO);var g=b._dl.getMetricsParams(f.id(),{autoselect:1});metrics.serverLog("Download",g)}else b._render(),metrics.log("PageShown",0===c?metrics.PAGE_NO_MEDIA_FOUND:metrics.PAGE_DOWNLOADS_LIST)}},a.onload=function(){var b=chrome.extension.getBackgroundPage();a.options=b.options,a.cache=b.cache;var c=new u;t.done(function(a){b.db.getMediaForTab(a).done(function(a){c.setDownloads(a)})})}}(window,document);