!function(){function a(a){var b=a.url,a="object"==typeof b?b.videoUrl+"\n"+b.audioUrl:b,c=N.hash(a);return c.toString()}function b(a,c){var d=c[0],e={};if(!d){if(a.length>1)for(var f=0;f<a.length;++f){var g=a[f],h=g.url();if("object"==typeof h&&(h=h.videoUrl),-1!==h.indexOf(".googlevideo.com"))return[g]}return[a[0]]}return a.forEach(function(a){var b=a[d]&&a[d]()||"";e[b]=e[b]||[],e[b].push(a)}),Object.keys(e).map(function(a){var f=b(e[a],c.slice(1)),g={media:f};return g[d]=N.defined(a)?a:void 0,g.is_only=1===f.length&&(!N.defined(f[0].is_only)||f[0].is_only),g["i18n_"+d]=O("media_fields_"+d+"_"+a),g})}function c(a){return a.forEach(function(a){var b=a.type;a.media.forEach(function(a){a.media=a.media.sort(function(a,c){return J[b].extensions.indexOf(a.ext)-J[b].extensions.indexOf(c.ext)})})}),a}function d(a){return a.ext?(a.media=a.media.sort(function(a,b){return quality.getQualityLevelByType(a.quality)-quality.getQualityLevelByType(b.quality)}),a):(Array.isArray(a)?a=a.map(d):a.media=d(a.media),a)}function e(a){return d(c(a))}function f(a){return a?(a+="_",function(b){return a+b}):function(){return null}}function g(a){var b=a.parse,c=a.request;if(!c)return b;var d=c.url||function(a){return a},e=c.params||function(){},f=c.headers||function(){};return function(a){var g=new Q;return N.send(c.method,d(a),e(a),f(a)).done(function(a){try{var c=b(a);g.resolve(c)}catch(d){console.warn(d),g.reject()}}),g}}function h(a){return{getToken:f(a.name),getPlaylist:g(a)}}function i(a,b,c){var d=c?function(){this._ids=[]}:function(){};return d.prototype={constructor:d,name:a,_makePlayer:function(b,c,d){return{node:b,ids:c,scraper:d,name:a}},_makePlayer0:function(b,c,d){return{node:b,ids:c,scraper:d,name:a}},getMediaPlayers:b},c&&(d.prototype.processRequest=function(a){a&&-1===this._ids.indexOf(a)&&this._ids.push(a)}),d}function j(a){if(!a)return!1;if(a.name&&-1!==a.name.toLowerCase().indexOf("zeroclipboard")||a.data&&-1!==a.data.toLowerCase().indexOf("zeroclipboard"))return!1;var b=l(a.src);return b&&N.isMatches(b,$)?!1:!0}function k(a){if(!j(a))return null;if(-1!==["PARAM","SOURCE"].indexOf(a.tagName)&&(a=a.parentElement),"OBJECT"===a.tagName){var b=a.querySelectorAll("embed");b&&1===b.length&&(a=b[0])}return a}function l(a){return a&&0!==a.indexOf("data:image")?_.exec(a)[6]||"":""}function m(a){if(!a||0===a.indexOf("data:image"))return"";var b=_.exec(a)[11]||"",c=b.split("."),d=c.length-1;if(0>=d)return"";var e=c[d].toLowerCase();return K[e]}function n(a){return!!a&&N.endsWith(a,"adnetwork.vn")}function o(a){return a?a.trim():a}function p(){}function q(a,b){var c=document.createElement(a);return b&&(c.className=b),c}function r(a,b,c,d){var e={downloads:c.group(),i18n_check_label:O("popup_check_label"),i18n_check_all:O("popup_check_all"),i18n_check_none:O("popup_check_none"),i18n_download_selected:O("popup_download_selected").toUpperCase(),i18n_download:O("popup_download").toUpperCase(),i18n_wait:O("popup_download_starting"),i18n_one_click:O("popup_one_click"),i18n_preferred_quality:O("popup_preferred_quality"),i18n_no_media_found:O("popup_no_media_found"),i18n_download_failed:O("popup_download_failed")},f=Mustache.render(window.options.get("template-list"),e,{media_template:window.options.get("template-media")}),g=N.query("#downloads",d);g.innerHTML=f,g.classList.add("content");var h,i,j=N.queryAll(".j-media-scope",d);1===j.length&&("select"===a._make_action?h=N.query(".j-quality-selector:not([hidden])",j[0]):"download"===a._make_action&&(i=!0)),a._make_action=void 0;var k=!!h,l=a._preferredQuality,m=options.get("preferred_quality:"+l);if(j.forEach(function(b){var d=N.queryAll(".j-quality-download",b);if(d.length>1){var e=d.map(function(a){return a.dataset.id}),f=quality.chooseBestDownload(c.getMediaGroup(e),l,m),g=N.query(".j-quality-selector",b);g&&(g.value=f.extQuality())}a._applyCurrentValues(b,k)}),h){var n=function(){h.removeEventListener("focusout",n,!0);var b=N.findParent(h,"j-media-scope");a._applyCurrentValues(b)};h.addEventListener("focusout",n,!0);var o=document.createEvent("MouseEvents");o.initMouseEvent("mousedown",!0,!0,window),h.dispatchEvent(o)}else if(i){var p=N.query(".j-quality-download:not([hidden])",j[0]);p&&a._download(p)&&(Y.log("Download",Y.DOWNLOAD_AUTO),a._updateDownloadSelected())}}function s(a){return(a.createShadowRoot||a.webkitCreateShadowRoot).call(a)}function t(a,b){for(b=b.parentNode;b&&b!==a;)b=b.parentNode;return!!b}function u(){var a=q("div"),b=s(a),c=q("style"),d="",e=chrome.runtime.getManifest().web_accessible_resources||[];e.forEach(function(a){N.endsWith(a,".css")&&(d+='@import "'+chrome.extension.getURL(a)+'";\n')}),c.innerHTML=d,b.appendChild(c);var f=q("div","body");return b.appendChild(f),{element:a,shadowElement:f}}function v(a){function b(a){return-1!==["mouseenter","mouseover","touchstart","touchmove"].indexOf(a)}function c(c){var d=a.getTargetNode(c.target);return d?(a.onFocus(d,b(c.type)),!0):void 0}function d(a){var b=f[a.type];b&&(null!==e&&(e=a),b(a)&&(a.preventDefault(),a.stopPropagation()))}var e,f={mouseenter:c,mouseleave:c},g=Object.keys(f);return{emitLastEvent:function(){var a=e&&f[e.type];a&&a(e),e=null},attach:function(a){for(var b=g.length-1;b>=0;b--)a.addEventListener(g[b],d,!0)},detach:function(a){for(var b=g.length-1;b>=0;b--)a.removeEventListener(g[b],d,!0)}}}function w(a,b){for(;b;){var c=a.getComputedStyle(b);if(c&&"fixed"===c.getPropertyValue("position"))return"fixed";b=b.parentNode}return"absolute"}function x(a){try{var b=a.ownerDocument.defaultView,c=w(b,a),d=a.getBoundingClientRect(),e=d.top,f=d.left;return"fixed"!==c&&(e+=b.pageYOffset,f+=b.pageXOffset),{position:c,top:e+"px",left:f+"px",height:d.height+"px",width:d.width+"px"}}catch(g){return console.trace(g,a),null}}function y(a){function b(){Y.log("PageShown",Y.PAGE_CONTENT_SHOW_CONTROLS),e.hidden=!1}function c(){setTimeout(function(){if(f){var a=N.query(".downloads-multi #downloads",e);a&&(a.hidden=!0),e.hidden=!0}},1500)}function d(){if(g){var a="",b=x(g);Object.keys(b).forEach(function(c){a+=c+":"+b[c]+";"}),e.setAttribute("style",a)}}var e=q("div","base overlay");e.innerHTML="&nbsp;",e.hidden=!0;var f=!0,g=null;window.addEventListener("resize",d);var h=v({onFocus:function(h,i){if(!i||!window.options.get("on_page_buttons"))return f=!0,void c();if(f=!1,h!==e){if(h!==g){g=h;var j=a.getWidgetForNode(h);if(!j)return;j.attach(e)}d(),b()}},getTargetNode:function(b){return b?b===e?e:a.getTargetNode(b):b}});return h.attach(e),h.attach(document),{attach:function(a){a.appendChild(e),h.emitLastEvent()},destroy:function(){h.detach(document),h.detach(e),window.removeEventListener("resize",d)}}}function z(){return{data:[],reset:function(){this.data=[]},getTargetNode:function(a){for(var b=this.data,c=b.length-1;c>=0;c--){var d=b[c].node;if(d===a||t(d,a))return d}return null},getWidgetForNode:function(a){if(!a)return null;for(var b=this.data,c=b.length-1;c>=0;c--){var d=b[c];if(d.node===a||t(d.node,a)){var e=d.widget;return e.isReady()?e:null}}return null},setMediaPlayers:function(a,b){for(var c=this.data,d=[],e=0;e<c.length;++e)d.push(c[e].node);var f=0;b.forEach(function(b){var e=b.node;if("nhaccuatui"!==b.name&&(e=k(e)),e){var g,h=d.indexOf(e);-1!==h?(console.assert(e===c[h].node,"Missmatched nodes!"),d[h]=null,g=c[h].widget):(g=new ob,c.push({node:e,widget:g})),g.setMediaData(a,b),++f}});for(var e=d.length-1;e>=0;e--){var g=d[e];g&&(console.assert(g===c[e].node,"Missmatched nodes!"),c.splice(e,1))}return!!f}}}function A(a){var b,c=z(),d=y(c);return{destroy:function(){d&&(d.destroy(),d=null),b&&(a.removeChild(b.element),b=null),c.reset()},setMediaPlayers:function(e,f){c.setMediaPlayers(e,f)&&!b&&(b=u(document),a.appendChild(b.element),d.attach(b.shadowElement))}}}function B(a){try{chrome.runtime.sendMessage(a)}catch(b){return!1}return!0}function C(){var a=document.createElement("savior:overlay");a.style.background="#000000",a.style.position="fixed",a.style.left="0px",a.style.top="0px",a.style.right="0px",a.style.bottom="0px",a.style.opacity=.6,a.style.zIndex=2147483647;var b=document.createElement("style");b.innerHTML="body { -webkit-filter: blur(3px)!important; }";var c={_style:b,_overlay:a,_warp:document.createDocumentFragment(),hide:function(a){a&&a.stopPropagation&&(a.stopPropagation(),a.preventDefault()),this._warp.appendChild(this._overlay),this._warp.appendChild(this._style)},show:function(){document.body.appendChild(this._overlay),document.body.offsetHeight,document.head.appendChild(this._style)},destroy:function(){this.hide(),this._style=null,this._overlay=null,this._warp=null}};return a.addEventListener("mouseup",c.hide.bind(c),!0),a.addEventListener("mousedown",c.hide.bind(c),!0),c}function D(a){for(var b=0;b<a.length;++b)if(a[b].ids.length)return!0;return!1}function E(a){return"file:"!==a}function F(a){return""===a||"localhost"===a}function G(){if(document.webkitHidden)return void(rb&&(clearTimeout(rb),rb=null));var a=sb.getMediaPlayers(),b=E(location.protocol);if(b||!F(location.host)){var c=B({requestType:"media",method:"set_present",params:D(a)});if(!c)return void I()}"undefined"==typeof pb&&document.documentElement&&b&&(pb=A(document.documentElement)),pb&&pb.setMediaPlayers(sb,a),rb=setTimeout(G,qb)}function H(){window.options=new W,window.options.load(),window.cache=new nb,sb=new kb,tb=C(),window.onbeforeunload=I,chrome.runtime.onConnect.addListener(function(a){"overlay"===a.name&&tb&&(tb.show(),a.onDisconnect.addListener(function(){tb&&tb.hide()}))}),chrome.runtime.onMessage.addListener(function(a,b,c){var d=null;switch(a.requestType){case"get_media":sb.getMedia().done(function(a){c(a)});break;case"downloads":d=mb.processRequest(a.method,a.params);break;case"request.matched":sb.processRequest(a)}return d?(d.done(function(a){c({success:d.state===Q.RESOLVED,data:a})}),!0):!0}),B({requestType:"media",method:"reset_all"}),window.manager=sb,document.addEventListener("webkitvisibilitychange",G,!1),G()}function I(){tb&&(tb.destroy(),tb=null),pb&&(pb.destroy(),pb=null),rb&&(clearTimeout(rb),rb=null),document.removeEventListener("webkitvisibilitychange",G,!1)}const J={audio:{title:"Audio",contentTypes:[/audio/i],extensions:["mp3","flac","m4a","wma","ogg","wav","aif","mid"],ctype2extension:{midi:"mid",mp4:"m4a",m4a:"m4a",mpeg:"mp3",mpeg3:"mp3",wav:"wav",aiff:"aif"}},video:{title:"Video",contentTypes:[/video/i],extensions:["mp4","mpeg4","mpg","mpeg","m4v","avi","divx","mov","wmv","movie","asf","webm","flv","3gp"],ctype2extension:{mpeg:"mp4",mp4:"mp4",m4v:"mp4","3gpp":"3gp",flv:"flv",quicktime:"mov",msvideo:"avi","ms-wmv":"wmv","ms-asf":"asf"}}},K=function(){var a={};return Object.keys(J).forEach(function(b){for(var c=J[b].extensions,d=0;d<c.length;d++)a[c[d]]=b}),a}(),L=[/^(.+\.)?youtube.com/i,/^(.+\.)?zing.vn/i,/^(.+\.)?nhaccuatui.com/i,/^(.+\.)?nhacso.net/i,/^(.+\.)?vimeo.com/i,/^(.+\.)?clip.vn/i,/vietgiaitri\.com/i];var M=M||function(a,b){var c={},d=c.lib={},e=function(){},f=d.Base={extend:function(a){e.prototype=this;var b=new e;return a&&b.mixIn(a),b.hasOwnProperty("init")||(b.init=function(){b.$super.init.apply(this,arguments)}),b.init.prototype=b,b.$super=this,b},create:function(){var a=this.extend();return a.init.apply(a,arguments),a},init:function(){},mixIn:function(a){for(var b in a)a.hasOwnProperty(b)&&(this[b]=a[b]);a.hasOwnProperty("toString")&&(this.toString=a.toString)},clone:function(){return this.init.prototype.extend(this)}},g=d.WordArray=f.extend({init:function(a,c){a=this.words=a||[],this.sigBytes=c!=b?c:4*a.length},toString:function(a){return(a||i).stringify(this)},concat:function(a){var b=this.words,c=a.words,d=this.sigBytes;if(a=a.sigBytes,this.clamp(),d%4)for(var e=0;a>e;e++)b[d+e>>>2]|=(c[e>>>2]>>>24-8*(e%4)&255)<<24-8*((d+e)%4);else if(65535<c.length)for(e=0;a>e;e+=4)b[d+e>>>2]=c[e>>>2];else b.push.apply(b,c);return this.sigBytes+=a,this},clamp:function(){var b=this.words,c=this.sigBytes;b[c>>>2]&=4294967295<<32-8*(c%4),b.length=a.ceil(c/4)},clone:function(){var a=f.clone.call(this);return a.words=this.words.slice(0),a},random:function(b){for(var c=[],d=0;b>d;d+=4)c.push(4294967296*a.random()|0);return new g.init(c,b)}}),h=c.enc={},i=h.Hex={stringify:function(a){var b=a.words;a=a.sigBytes;for(var c=[],d=0;a>d;d++){var e=b[d>>>2]>>>24-8*(d%4)&255;c.push((e>>>4).toString(16)),c.push((15&e).toString(16))}return c.join("")},parse:function(a){for(var b=a.length,c=[],d=0;b>d;d+=2)c[d>>>3]|=parseInt(a.substr(d,2),16)<<24-4*(d%8);return new g.init(c,b/2)}},j=h.Latin1={stringify:function(a){var b=a.words;a=a.sigBytes;for(var c=[],d=0;a>d;d++)c.push(String.fromCharCode(b[d>>>2]>>>24-8*(d%4)&255));return c.join("")},parse:function(a){for(var b=a.length,c=[],d=0;b>d;d++)c[d>>>2]|=(255&a.charCodeAt(d))<<24-8*(d%4);return new g.init(c,b)}},k=h.Utf8={stringify:function(a){try{return decodeURIComponent(escape(j.stringify(a)))}catch(b){throw Error("Malformed UTF-8 data")}},parse:function(a){return j.parse(unescape(encodeURIComponent(a)))}},l=d.BufferedBlockAlgorithm=f.extend({reset:function(){this._data=new g.init,this._nDataBytes=0},_append:function(a){"string"==typeof a&&(a=k.parse(a)),this._data.concat(a),this._nDataBytes+=a.sigBytes},_process:function(b){var c=this._data,d=c.words,e=c.sigBytes,f=this.blockSize,h=e/(4*f),h=b?a.ceil(h):a.max((0|h)-this._minBufferSize,0);if(b=h*f,e=a.min(4*b,e),b){for(var i=0;b>i;i+=f)this._doProcessBlock(d,i);i=d.splice(0,b),c.sigBytes-=e}return new g.init(i,e)},clone:function(){var a=f.clone.call(this);return a._data=this._data.clone(),a},_minBufferSize:0});d.Hasher=l.extend({cfg:f.extend(),init:function(a){this.cfg=this.cfg.extend(a),this.reset()},reset:function(){l.reset.call(this),this._doReset()},update:function(a){return this._append(a),this._process(),this},finalize:function(a){return a&&this._append(a),this._doFinalize()},blockSize:16,_createHelper:function(a){return function(b,c){return new a.init(c).finalize(b)}},_createHmacHelper:function(a){return function(b,c){return new m.HMAC.init(a,c).finalize(b)}}});var m=c.algo={};return c}(Math);!function(){var a=M,b=a.lib.WordArray;a.enc.Base64={stringify:function(a){var b=a.words,c=a.sigBytes,d=this._map;a.clamp(),a=[];for(var e=0;c>e;e+=3)for(var f=(b[e>>>2]>>>24-8*(e%4)&255)<<16|(b[e+1>>>2]>>>24-8*((e+1)%4)&255)<<8|b[e+2>>>2]>>>24-8*((e+2)%4)&255,g=0;4>g&&c>e+.75*g;g++)a.push(d.charAt(f>>>6*(3-g)&63));if(b=d.charAt(64))for(;a.length%4;)a.push(b);return a.join("")},parse:function(a){var c=a.length,d=this._map,e=d.charAt(64);e&&(e=a.indexOf(e),-1!=e&&(c=e));for(var e=[],f=0,g=0;c>g;g++)if(g%4){var h=d.indexOf(a.charAt(g-1))<<2*(g%4),i=d.indexOf(a.charAt(g))>>>6-2*(g%4);e[f>>>2]|=(h|i)<<24-8*(f%4),f++}return b.create(e,f)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}}(),function(a){function b(a,b,c,d,e,f,g){return a=a+(b&c|~b&d)+e+g,(a<<f|a>>>32-f)+b}function c(a,b,c,d,e,f,g){return a=a+(b&d|c&~d)+e+g,(a<<f|a>>>32-f)+b}function d(a,b,c,d,e,f,g){return a=a+(b^c^d)+e+g,(a<<f|a>>>32-f)+b}function e(a,b,c,d,e,f,g){return a=a+(c^(b|~d))+e+g,(a<<f|a>>>32-f)+b}for(var f=M,g=f.lib,h=g.WordArray,i=g.Hasher,g=f.algo,j=[],k=0;64>k;k++)j[k]=4294967296*a.abs(a.sin(k+1))|0;g=g.MD5=i.extend({_doReset:function(){this._hash=new h.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(a,f){for(var g=0;16>g;g++){var h=f+g,i=a[h];a[h]=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8)}var g=this._hash.words,h=a[f+0],i=a[f+1],k=a[f+2],l=a[f+3],m=a[f+4],n=a[f+5],o=a[f+6],p=a[f+7],q=a[f+8],r=a[f+9],s=a[f+10],t=a[f+11],u=a[f+12],v=a[f+13],w=a[f+14],x=a[f+15],y=g[0],z=g[1],A=g[2],B=g[3],y=b(y,z,A,B,h,7,j[0]),B=b(B,y,z,A,i,12,j[1]),A=b(A,B,y,z,k,17,j[2]),z=b(z,A,B,y,l,22,j[3]),y=b(y,z,A,B,m,7,j[4]),B=b(B,y,z,A,n,12,j[5]),A=b(A,B,y,z,o,17,j[6]),z=b(z,A,B,y,p,22,j[7]),y=b(y,z,A,B,q,7,j[8]),B=b(B,y,z,A,r,12,j[9]),A=b(A,B,y,z,s,17,j[10]),z=b(z,A,B,y,t,22,j[11]),y=b(y,z,A,B,u,7,j[12]),B=b(B,y,z,A,v,12,j[13]),A=b(A,B,y,z,w,17,j[14]),z=b(z,A,B,y,x,22,j[15]),y=c(y,z,A,B,i,5,j[16]),B=c(B,y,z,A,o,9,j[17]),A=c(A,B,y,z,t,14,j[18]),z=c(z,A,B,y,h,20,j[19]),y=c(y,z,A,B,n,5,j[20]),B=c(B,y,z,A,s,9,j[21]),A=c(A,B,y,z,x,14,j[22]),z=c(z,A,B,y,m,20,j[23]),y=c(y,z,A,B,r,5,j[24]),B=c(B,y,z,A,w,9,j[25]),A=c(A,B,y,z,l,14,j[26]),z=c(z,A,B,y,q,20,j[27]),y=c(y,z,A,B,v,5,j[28]),B=c(B,y,z,A,k,9,j[29]),A=c(A,B,y,z,p,14,j[30]),z=c(z,A,B,y,u,20,j[31]),y=d(y,z,A,B,n,4,j[32]),B=d(B,y,z,A,q,11,j[33]),A=d(A,B,y,z,t,16,j[34]),z=d(z,A,B,y,w,23,j[35]),y=d(y,z,A,B,i,4,j[36]),B=d(B,y,z,A,m,11,j[37]),A=d(A,B,y,z,p,16,j[38]),z=d(z,A,B,y,s,23,j[39]),y=d(y,z,A,B,v,4,j[40]),B=d(B,y,z,A,h,11,j[41]),A=d(A,B,y,z,l,16,j[42]),z=d(z,A,B,y,o,23,j[43]),y=d(y,z,A,B,r,4,j[44]),B=d(B,y,z,A,u,11,j[45]),A=d(A,B,y,z,x,16,j[46]),z=d(z,A,B,y,k,23,j[47]),y=e(y,z,A,B,h,6,j[48]),B=e(B,y,z,A,p,10,j[49]),A=e(A,B,y,z,w,15,j[50]),z=e(z,A,B,y,n,21,j[51]),y=e(y,z,A,B,u,6,j[52]),B=e(B,y,z,A,l,10,j[53]),A=e(A,B,y,z,s,15,j[54]),z=e(z,A,B,y,i,21,j[55]),y=e(y,z,A,B,q,6,j[56]),B=e(B,y,z,A,x,10,j[57]),A=e(A,B,y,z,o,15,j[58]),z=e(z,A,B,y,v,21,j[59]),y=e(y,z,A,B,m,6,j[60]),B=e(B,y,z,A,t,10,j[61]),A=e(A,B,y,z,k,15,j[62]),z=e(z,A,B,y,r,21,j[63]);g[0]=g[0]+y|0,g[1]=g[1]+z|0,g[2]=g[2]+A|0,g[3]=g[3]+B|0},_doFinalize:function(){var b=this._data,c=b.words,d=8*this._nDataBytes,e=8*b.sigBytes;c[e>>>5]|=128<<24-e%32;var f=a.floor(d/4294967296);for(c[(e+64>>>9<<4)+15]=16711935&(f<<8|f>>>24)|4278255360&(f<<24|f>>>8),c[(e+64>>>9<<4)+14]=16711935&(d<<8|d>>>24)|4278255360&(d<<24|d>>>8),b.sigBytes=4*(c.length+1),this._process(),b=this._hash,c=b.words,d=0;4>d;d++)e=c[d],c[d]=16711935&(e<<8|e>>>24)|4278255360&(e<<24|e>>>8);return b},clone:function(){var a=i.clone.call(this);return a._hash=this._hash.clone(),a}}),f.MD5=i._createHelper(g),f.HmacMD5=i._createHmacHelper(g)}(Math),function(){var a=M,b=a.lib,c=b.Base,d=b.WordArray,b=a.algo,e=b.EvpKDF=c.extend({cfg:c.extend({keySize:4,hasher:b.MD5,iterations:1}),init:function(a){this.cfg=this.cfg.extend(a)},compute:function(a,b){for(var c=this.cfg,e=c.hasher.create(),f=d.create(),g=f.words,h=c.keySize,c=c.iterations;g.length<h;){i&&e.update(i);var i=e.update(a).finalize(b);e.reset();for(var j=1;c>j;j++)i=e.finalize(i),e.reset();f.concat(i)}return f.sigBytes=4*h,f}});a.EvpKDF=function(a,b,c){return e.create(c).compute(a,b)}}(),M.lib.Cipher||function(a){var b=M,c=b.lib,d=c.Base,e=c.WordArray,f=c.BufferedBlockAlgorithm,g=b.enc.Base64,h=b.algo.EvpKDF,i=c.Cipher=f.extend({cfg:d.extend(),createEncryptor:function(a,b){return this.create(this._ENC_XFORM_MODE,a,b)},createDecryptor:function(a,b){return this.create(this._DEC_XFORM_MODE,a,b)},init:function(a,b,c){this.cfg=this.cfg.extend(c),this._xformMode=a,this._key=b,this.reset()},reset:function(){f.reset.call(this),this._doReset()},process:function(a){return this._append(a),this._process()},finalize:function(a){return a&&this._append(a),this._doFinalize()},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(a){return{encrypt:function(b,c,d){return("string"==typeof c?o:n).encrypt(a,b,c,d)},decrypt:function(b,c,d){return("string"==typeof c?o:n).decrypt(a,b,c,d)}}}});c.StreamCipher=i.extend({_doFinalize:function(){return this._process(!0)},blockSize:1});var j=b.mode={},k=function(b,c,d){var e=this._iv;e?this._iv=a:e=this._prevBlock;for(var f=0;d>f;f++)b[c+f]^=e[f]},l=(c.BlockCipherMode=d.extend({createEncryptor:function(a,b){return this.Encryptor.create(a,b)},createDecryptor:function(a,b){return this.Decryptor.create(a,b)},init:function(a,b){this._cipher=a,this._iv=b}})).extend();l.Encryptor=l.extend({processBlock:function(a,b){var c=this._cipher,d=c.blockSize;k.call(this,a,b,d),c.encryptBlock(a,b),this._prevBlock=a.slice(b,b+d)}}),l.Decryptor=l.extend({processBlock:function(a,b){var c=this._cipher,d=c.blockSize,e=a.slice(b,b+d);c.decryptBlock(a,b),k.call(this,a,b,d),this._prevBlock=e}}),j=j.CBC=l,l=(b.pad={}).Pkcs7={pad:function(a,b){for(var c=4*b,c=c-a.sigBytes%c,d=c<<24|c<<16|c<<8|c,f=[],g=0;c>g;g+=4)f.push(d);c=e.create(f,c),a.concat(c)},unpad:function(a){a.sigBytes-=255&a.words[a.sigBytes-1>>>2]}},c.BlockCipher=i.extend({cfg:i.cfg.extend({mode:j,padding:l}),reset:function(){i.reset.call(this);var a=this.cfg,b=a.iv,a=a.mode;if(this._xformMode==this._ENC_XFORM_MODE)var c=a.createEncryptor;else c=a.createDecryptor,this._minBufferSize=1;this._mode=c.call(a,this,b&&b.words)},_doProcessBlock:function(a,b){this._mode.processBlock(a,b)},_doFinalize:function(){var a=this.cfg.padding;if(this._xformMode==this._ENC_XFORM_MODE){a.pad(this._data,this.blockSize);var b=this._process(!0)}else b=this._process(!0),a.unpad(b);return b},blockSize:4});var m=c.CipherParams=d.extend({init:function(a){this.mixIn(a)},toString:function(a){return(a||this.formatter).stringify(this)}}),j=(b.format={}).OpenSSL={stringify:function(a){var b=a.ciphertext;return a=a.salt,(a?e.create([1398893684,1701076831]).concat(a).concat(b):b).toString(g)},parse:function(a){a=g.parse(a);var b=a.words;if(1398893684==b[0]&&1701076831==b[1]){var c=e.create(b.slice(2,4));b.splice(0,4),a.sigBytes-=16}return m.create({ciphertext:a,salt:c})}},n=c.SerializableCipher=d.extend({cfg:d.extend({format:j}),encrypt:function(a,b,c,d){d=this.cfg.extend(d);var e=a.createEncryptor(c,d);return b=e.finalize(b),e=e.cfg,m.create({ciphertext:b,key:c,iv:e.iv,algorithm:a,mode:e.mode,padding:e.padding,blockSize:a.blockSize,formatter:d.format})},decrypt:function(a,b,c,d){return d=this.cfg.extend(d),b=this._parse(b,d.format),a.createDecryptor(c,d).finalize(b.ciphertext)},_parse:function(a,b){return"string"==typeof a?b.parse(a,this):a}}),b=(b.kdf={}).OpenSSL={execute:function(a,b,c,d){return d||(d=e.random(8)),a=h.create({keySize:b+c}).compute(a,d),c=e.create(a.words.slice(b),4*c),a.sigBytes=4*b,m.create({key:a,iv:c,salt:d})}},o=c.PasswordBasedCipher=n.extend({cfg:n.cfg.extend({kdf:b}),encrypt:function(a,b,c,d){return d=this.cfg.extend(d),c=d.kdf.execute(c,a.keySize,a.ivSize),d.iv=c.iv,a=n.encrypt.call(this,a,b,c.key,d),a.mixIn(c),a},decrypt:function(a,b,c,d){return d=this.cfg.extend(d),b=this._parse(b,d.format),c=d.kdf.execute(c,a.keySize,a.ivSize,b.salt),d.iv=c.iv,n.decrypt.call(this,a,b,c.key,d)}})}(),function(){for(var a=M,b=a.lib.BlockCipher,c=a.algo,d=[],e=[],f=[],g=[],h=[],i=[],j=[],k=[],l=[],m=[],n=[],o=0;256>o;o++)n[o]=128>o?o<<1:o<<1^283;for(var p=0,q=0,o=0;256>o;o++){var r=q^q<<1^q<<2^q<<3^q<<4,r=r>>>8^255&r^99;d[p]=r,e[r]=p;var s=n[p],t=n[s],u=n[t],v=257*n[r]^16843008*r;f[p]=v<<24|v>>>8,g[p]=v<<16|v>>>16,h[p]=v<<8|v>>>24,i[p]=v,v=16843009*u^65537*t^257*s^16843008*p,j[r]=v<<24|v>>>8,k[r]=v<<16|v>>>16,l[r]=v<<8|v>>>24,m[r]=v,p?(p=s^n[n[n[u^s]]],q^=n[n[q]]):p=q=1}var w=[0,1,2,4,8,16,32,64,128,27,54],c=c.AES=b.extend({_doReset:function(){for(var a=this._key,b=a.words,c=a.sigBytes/4,a=4*((this._nRounds=c+6)+1),e=this._keySchedule=[],f=0;a>f;f++)if(c>f)e[f]=b[f];else{var g=e[f-1];f%c?c>6&&4==f%c&&(g=d[g>>>24]<<24|d[g>>>16&255]<<16|d[g>>>8&255]<<8|d[255&g]):(g=g<<8|g>>>24,g=d[g>>>24]<<24|d[g>>>16&255]<<16|d[g>>>8&255]<<8|d[255&g],g^=w[f/c|0]<<24),e[f]=e[f-c]^g}for(b=this._invKeySchedule=[],c=0;a>c;c++)f=a-c,g=c%4?e[f]:e[f-4],b[c]=4>c||4>=f?g:j[d[g>>>24]]^k[d[g>>>16&255]]^l[d[g>>>8&255]]^m[d[255&g]]},encryptBlock:function(a,b){this._doCryptBlock(a,b,this._keySchedule,f,g,h,i,d)},decryptBlock:function(a,b){var c=a[b+1];a[b+1]=a[b+3],a[b+3]=c,this._doCryptBlock(a,b,this._invKeySchedule,j,k,l,m,e),c=a[b+1],a[b+1]=a[b+3],a[b+3]=c},_doCryptBlock:function(a,b,c,d,e,f,g,h){for(var i=this._nRounds,j=a[b]^c[0],k=a[b+1]^c[1],l=a[b+2]^c[2],m=a[b+3]^c[3],n=4,o=1;i>o;o++)var p=d[j>>>24]^e[k>>>16&255]^f[l>>>8&255]^g[255&m]^c[n++],q=d[k>>>24]^e[l>>>16&255]^f[m>>>8&255]^g[255&j]^c[n++],r=d[l>>>24]^e[m>>>16&255]^f[j>>>8&255]^g[255&k]^c[n++],m=d[m>>>24]^e[j>>>16&255]^f[k>>>8&255]^g[255&l]^c[n++],j=p,k=q,l=r;p=(h[j>>>24]<<24|h[k>>>16&255]<<16|h[l>>>8&255]<<8|h[255&m])^c[n++],q=(h[k>>>24]<<24|h[l>>>16&255]<<16|h[m>>>8&255]<<8|h[255&j])^c[n++],r=(h[l>>>24]<<24|h[m>>>16&255]<<16|h[j>>>8&255]<<8|h[255&k])^c[n++],m=(h[m>>>24]<<24|h[j>>>16&255]<<16|h[k>>>8&255]<<8|h[255&l])^c[n++],a[b]=p,a[b+1]=q,a[b+2]=r,a[b+3]=m},keySize:8});a.AES=b._createHelper(c)}(),M.pad.NoPadding={pad:function(){},unpad:function(){}};var N={EXTENSION_RE:/\.([^/.]*)$/i,FILENAME_RE:/([^/]+)$/i,SIZES:["","K","M","G","T","P"],xmlParser:new DOMParser,urlParser:document.createElement("a"),fileDownloader:document.createElement("a"),strip:function(a){return a.replace(/(^\s+)|(\s+$)/m,"")},endsWith:function(a,b){var c=a.length-b.length;return a.indexOf(b,c)===c},hash:function(a,b){if(b=0|b,0===a.length)return b;var c,d;for(c=0,d=a.length;d>c;c++)b=(b<<5)-b+a.charCodeAt(c),b|=0;return b},query:function(a,b){return b=b||document,b.querySelector(a)},queryAll:function(a,b){return b=b||document,N.toArray(b.querySelectorAll(a))},findParent:function(a,b){for(;null!==a&&!a.classList.contains(b);)a=a.parentNode;return a},toArray:function(a){return Array.prototype.slice.call(a)},unique:function(a){var b=[];return Array.isArray(a)?(a.forEach(function(a){-1===b.indexOf(a)&&b.push(a)}),b):a},extend:function(a,b){var c=function(){};c.prototype=a.prototype,b.prototype=new c,b.prototype.constructor=b,b._super=a.prototype},parseUrl:function(a){var b=N.urlParser;b.setAttribute("href",a);var c=(b.pathname.match(N.FILENAME_RE)||[])[1]||"",d=c.split(".").map(function(a){return a.toLowerCase()});c=decodeURIComponent(c.replace(N.EXTENSION_RE,"")),d.shift();var e=d[d.length-1]||"";return{url:a,protocol:b.protocol,host:b.host,port:b.port,pathname:b.pathname,filename:c,ext:e,exts:d,search:b.search}},isMatches:function(a,b){var c,d,e;if(Array.isArray(a)){for(c=0;c<a.length;++c)if(N.isMatches(a[c],b))return!0;return!1}for(b=Array.isArray(b)?b:[b],c=0,d=b.length,e;d>c;++c)if(e=b[c],"string"==typeof e&&-1!==a.indexOf(e)||e instanceof RegExp&&a.match(e))return!0;return!1},_sendBackgroundRequest:function(a,b,c,d){var e=new Q;return chrome.runtime.sendMessage({requestType:"make_http_request",method:a,url:b,params:c,headers:d},function(a){e[a.success?"resolve":"reject"](a.data)}),e},send:function(a,b,c,d){var e=new Q,f=null;if(N.IS_CONTENT_SCRIPT)return N._sendBackgroundRequest(a,b,c,d);try{var g=new XMLHttpRequest;if(g.open(a,b,!0),g.setRequestHeader("Cache-Control","no-cache"),"object"==typeof c&&(f=Object.keys(c).map(function(a){return a+"="+c[a]}).join("&")),"object"==typeof d)for(var h in d)g.setRequestHeader(h,d[h]);"POST"===a&&g.setRequestHeader("Content-type","application/x-www-form-urlencoded"),g.onload=function(){e.resolve(this.responseText)},g.onerror=function(){e.reject()},g.send(f)}catch(i){e.reject()}return e},get:function(a,b){return N.send("GET",a,{},b)},post:function(a,b,c){return N.send("POST",a,b,c)},_getSize:function(a){function b(a){d&&d[a?"resolve":"reject"](a),d=null,c.abort(),clearTimeout(e),e=null}var c=new XMLHttpRequest,d=new Q,e=null,f=1e4;return c.open("GET",a),c.setRequestHeader("Cache-Control","no-cache"),c.url=a,c.onreadystatechange=function(){if(!(this.readyState<2)){var a=null;try{a=+this.getResponseHeader("Content-Length")}catch(c){}(null!==a||200===this.status)&&(200!==this.status&&(a=null),b(a))}},c.send(null),e=setTimeout(b,f),d},getSize:function(a){var b=new Q,c=window.cache;return c.get(a).success(function(d){d?(b.resolve(d),c.put(a,d)):b.bind(N._getSize(a)).success(c.put.bind(c,a))}).fail(function(){b.bind(N._getSize(a)).success(c.put.bind(c,a))}),b},beautifyFileSize:function(a){if(null===a||"undefined"==typeof a)return"???";for(var b=0;b<N.SIZES.length&&a>=1024;++b,a/=1024);return Math.round(10*a)/10+N.SIZES[b]+"b"},detectMediaTypeAndExt:function(a,b){b=b||"","string"==typeof a&&(a=N.parseUrl(a));var c=N.getMediaType(b,a.exts);return c&&J[c]&&(a.type=c,a.ext=this._findIntersection(a.exts,J[c].extensions)||N.extByContentType(b,c)||a.ext),a},getMediaType:function(a,b){var c;for(var d in J){c=J[d];for(var e=0;e<c.contentTypes.length;++e)if(a.match(c.contentTypes[e]))return d;if(Array.isArray(b)&&N._findIntersection(b,c.extensions)||-1!==c.extensions.indexOf(b))return d}return null},_findIntersection:function(a,b){for(var c=a.concat(b),d={},e=0;e<c.length;++e){var f=c[e];if(d[f])return f;d[f]=!0}return null},extByContentType:function(a,b){var c=J[b].ctype2extension;for(var d in c)if(-1!==a.indexOf(d))return c[d];return null},isTrue:function(a){return!!a},noop:function(){},defined:function(a){return"undefined"!=typeof a},notNull:function(a){return null!==a}},O=chrome.i18n.getMessage;try{chrome.extension.getBackgroundPage(),N.IS_CONTENT_SCRIPT=!1}catch(P){N.IS_CONTENT_SCRIPT=!0}var Q=function(a){if(0===arguments.length)return this._init(),this;if(a instanceof Q)return a;var b=new Q;return b.resolve(a),b};Q.RUNNING=0,Q.RESOLVED=1,Q.FAILED=2,Q.prototype={constructor:Q,_init:function(){this._results=[],this._subscribers=[],this.state=Q.RUNNING},_notify:function(){var a=this;this._subscribers.forEach(function(b){b.apply(a,a._results)}),this._subscribers=[]},resolve:function(){return this.state=Q.RESOLVED,this._results=arguments,this._notify(),this},reject:function(){return this.state=Q.FAILED,this._results=arguments,this._notify(),this},subscribe:function(a){this.state!==Q.RUNNING?a.apply(this,this._results):this._subscribers.push(a)},done:function(a){return this.subscribe(a),this},success:function(a){var b=this;return this.subscribe(function(){b.state===Q.RESOLVED&&a.apply(b,b._results)}),this},fail:function(a){var b=this;return this.subscribe(function(){b.state===Q.FAILED&&a.apply(b,b._results)}),this},bind:function(a){return a=new Q(a),a.success(this.resolve.bind(this)).fail(this.reject.bind(this)),this}},Q.when=function(){var a=[];return a=Array.isArray(arguments[0])?arguments[0]:N.toArray(arguments),new Q.When(a)},Q.When=function(a){this._doneCallbacks=[],this._successCallbacks=[],this._failCallbacks=[],this._state=Q.RUNNING,this._thingsToDo=a.length,this._results=Array(this._thingsToDo),this._init(a)},Q.When.prototype={constructor:Q.When,_init:function(a){var b=this;a.forEach(function(a,c){a=new Q(a),a.subscribe(function(){a.state===Q.FAILED&&(b._state=Q.FAILED),b._results[c]=N.toArray(arguments),b._thingsToDo--,b._checkIsDone()})}),this._checkIsDone()},_checkIsDone:function(){if(0!==this._thingsToDo)return!1;var a=[];this._results.forEach(function(b){a=a.concat(b)}),this._state===Q.FAILED?this._runCallbacks(this._failCallbacks,a):this._runCallbacks(this._successCallbacks,a),this._runCallbacks(this._doneCallbacks,a),this._doneCallbacks=[],this._successCallbacks=[],this._failCallbacks=[]},_runCallbacks:function(a,b){a.forEach(function(a){a.apply(this,b)})},done:function(a){return this._doneCallbacks.push(a),this._checkIsDone(),this},success:function(a){return this._successCallbacks.push(a),this._checkIsDone(),this},fail:function(a){return this._failCallbacks.push(a),this._checkIsDone(),this}},Q.chain=function(){function a(b){if(!b.length)return c.resolve.apply(c,d);var e,f=b.shift();"function"==typeof f?(e=Q(f()),e.done(function(c){d.push(c),a(b)})):(d.push(f),a(b))}var b,c=new Q,d=[];return b=Array.isArray(arguments[0])?arguments[0]:N.toArray(arguments),a(b),c};var R=function(){};R.QL_HIGH="High",R.QL_MEDIUM="Medium",R.QL_LOW="Low",R.QL_VIDEO_ULTRAHD="Ultra HD",R.QL_VIDEO_FULLHD="Full HD",R.QL_VIDEO_HD="HD",R.QL_VIDEO_STANDARD="Standard",R.QL_VIDEO_MEDIUM="Medium",R.QL_VIDEO_SMALL="Small",R.QL_VIDEO_MOBILE="Mobile";var S={};S[R.QL_VIDEO_ULTRAHD]={quality:R.QL_HIGH,qualityIndex:6,size:3072,videoTitle:"Ultra HD",itag:[38,138]},S[R.QL_VIDEO_FULLHD]={quality:R.QL_HIGH,qualityIndex:5,size:1080,videoTitle:"Full HD",audioTitle:"High",itag:[37,46,137],vimeoQuality:"",zingTag:"f1080",dailymotionQuality:"hd1080",clipvnQuality:"5"},S[R.QL_VIDEO_HD]={quality:R.QL_HIGH,qualityIndex:4,size:720,videoTitle:"HD",audioTitle:"High",itag:[22,45,120,136,247],zingTag:["f720","hq"],vimeoQuality:"hd",dailymotionQuality:["hd","hd720"],facebookQuality:"hd_src",clipvnQuality:"4"},S[R.QL_VIDEO_STANDARD]={quality:R.QL_MEDIUM,qualityIndex:3,size:480,videoTitle:"Standard",audioTitle:"Normal",itag:[44,35,135,244],zingTag:["f480"],dailymotionQuality:"hq",vimeoQuality:"sd",facebookQuality:"sd_src",clipvnQuality:"3"},S[R.QL_VIDEO_MEDIUM]={quality:R.QL_MEDIUM,qualityIndex:2,size:360,videoTitle:"Medium",audioTitle:"Normal",itag:[18,43,34,134,243],vimeoQuality:"",dailymotionQuality:"sd",zingTag:["source","f360"],clipvnQuality:"2"},S[R.QL_VIDEO_SMALL]={quality:R.QL_LOW,qualityIndex:1,size:240,videoTitle:"Small",audioTitle:"Low",itag:[36,5,133,242],dailymotionQuality:"ld",vimeoQuality:"mobile",zingTag:["f","f240"],clipvnQuality:"1"},S[R.QL_VIDEO_MOBILE]={quality:R.QL_LOW,qualityIndex:0,size:144,videoTitle:"Mobile",audioTitle:"Low",itag:[17,6,160],vimeoQuality:"",clipvnQuality:"0"};
var T={};T[R.QL_HIGH]=S[R.QL_VIDEO_ULTRAHD].qualityIndex,T[R.QL_MEDIUM]=S[R.QL_VIDEO_STANDARD].qualityIndex,T[R.QL_LOW]=S[R.QL_VIDEO_SMALL].qualityIndex,R.prototype={constructor:R,DEFAULT_QUALITY_LEVEL:R.QL_HIGH,QUALITY_LEVELS:[R.QL_HIGH,R.QL_MEDIUM,R.QL_LOW],VIDEO_QUALITY_LEVELS:[R.QL_VIDEO_FULLHD,R.QL_VIDEO_HD,R.QL_VIDEO_STANDARD,R.QL_VIDEO_MEDIUM,R.QL_VIDEO_SMALL,R.QL_VIDEO_MOBILE],DEFAULT_QUALITY_TYPE:R.QL_VIDEO_STANDARD,QUALITY_TYPES:S,getFacebookQuality:function(a){return this._getVideoQuality("facebookQuality",a).videoTitle},getDailymotionQuality:function(a){return this._getVideoQuality("dailymotionQuality",a).videoTitle},getZingVideoQuality:function(a){return this._getVideoQuality("zingTag",a).videoTitle},getZingAudioQuality:function(a){return this._getVideoQuality("zingTag",a).audioTitle},getYoutubeQuality:function(a,b){var c=this._getVideoQuality("itag",+a,b);return c&&c.videoTitle},getVimeoQuality:function(a){return this._getVideoQuality("vimeoQuality",a).videoTitle},getClipvnQuality:function(a){return this._getVideoQuality("clipvnQuality",a).videoTitle},getQualityBySize:function(a){if(a=parseInt(a),isNaN(a))return null;var b=1/0,c=null,d=this.QUALITY_TYPES[this.DEFAULT_QUALITY_TYPE];for(var e in this.QUALITY_TYPES){var f=this.QUALITY_TYPES[e];f.size>d.size&&(d=f),a<=1.3*f.size&&f.size<b&&(c=f,b=f.size)}return c=c||d,c.videoTitle},_getVideoQuality:function(a,b,c){for(var d in this.QUALITY_TYPES){var e=this.QUALITY_TYPES[d][a];if(Array.isArray(e)||(e=[e]),-1!==e.indexOf(b))return this.QUALITY_TYPES[d]}return c?null:this.QUALITY_TYPES[this.DEFAULT_QUALITY_TYPE]},_getTypeByQualityType:function(a){for(var b in this.QUALITY_TYPES)if(a===b||a===this.QUALITY_TYPES[b].videoTitle||a===this.QUALITY_TYPES[b].audioTitle)return this.QUALITY_TYPES[b];return this.QUALITY_TYPES[this.DEFAULT_QUALITY_TYPE]},_calculateWeight:function(a,b){var c=J[a.get("type")].extensions,d=c.indexOf(a.get("ext")),e=this._getTypeByQualityType(a.get("quality")).qualityIndex,f=d/c.length+Math.abs(b-e)/7;return f},getQualityLevelByType:function(a){return Object.keys(this.QUALITY_TYPES).indexOf(this._getTypeByQualityType(a).videoTitle)},getVideoQualityIndex:function(a){return this.VIDEO_QUALITY_LEVELS.concat().reverse().indexOf(a)},getOneClickQualityIndex:function(a){return this.QUALITY_LEVELS.concat().reverse().indexOf(a)},getQualityLevelByQualityType:function(a){return this._getTypeByQualityType(a).quality},chooseBestDownload:function(a,b,c){var d=a.length;if(c)for(var e=0;d>e;++e){var f=a[e];if(f.extQuality()===c)return f}b=b||this.DEFAULT_QUALITY_LEVEL;for(var g=T[b],h=1e3,i=-1,e=0;d>e;++e){var f=a[e],j=this._calculateWeight(f,g);h>j&&(h=j,i=e)}return a[i]}},window.quality=new R;var U=function(a){this._values={},this._sizePromise=null,a.id=a.id||Math.random().toString().substring(2),this.merge(a),this.download=U._downloads[this.id()]||null};U.MAX_FILE_NAME_LENGTH=128,U.isValidData=function(a){return a.type in J&&-1!==J[a.type].extensions.indexOf(a.ext)?!0:!1},U._downloads={},U.prototype._createFieldGetter=function(a){this[a]=function(){return this.get(a)}},U.prototype.get=function(a){return"string"==typeof a||"number"==typeof a?this._values[a]:void 0},U.prototype.set=function(a,b){return"string"!=typeof a&&"number"!=typeof a||this._values[a]===b||(this._values[a]=b,this[a]||this._createFieldGetter(a)),this},U.prototype.merge=function(a){var b=a instanceof U?a._values:a;for(var c in b)this.set(c,"undefined"!=typeof b[c]?b[c]:b[c]||null);return this},U.prototype.title=function(){return(this._values.title||this._values.filename).substr(0,U.MAX_FILE_NAME_LENGTH)},U.prototype.getFilename=function(){var a=this._values.title||this._values.filename,b="."+this._values.ext;return N.endsWith(a,b)||(a+=b),a=a.replace(/\s+/g," ").replace(/[\/\\:*?"<>|\u200c\u200d]/g,"-"),a.substr(0,U.MAX_FILE_NAME_LENGTH)},U.prototype.extQuality=function(){return(this.get("ext")||"")+"/"+(this.get("quality")||"")},U.prototype.size=function(){var a=this.get("size");return a?"("+N.beautifyFileSize(a)+")":""},U.prototype.getSize=function(){if(this._sizePromise)return this._sizePromise;var a=new Q;this._sizePromise=a;var b=this,c=this.get("url");"object"==typeof c&&c.videoUrl&&(c=c.videoUrl);var d=this.get("altUrl"),e=this.get("size");return e?(a.resolve(e),a):(N.getSize(c).success(function(c){b.set("size",c),a.resolve(c)}).fail(function(){if(d){var e=N.getSize(d);e.success(function(a){b.set("size",a),cache.put("filesize_"+c,a)}),a.bind(e)}else a.reject(null)}),a)};var V=function(a){this._uninitialized=!0,this.data=[],this.setMediaData(a)};V.prototype={setMediaData:function(b){var c=this,d=new Q;return b?(Q(b).done(function(b){if(b=b.filter(U.isValidData),c._uninitialized&&0===b.length)return c._uninitialized=!1,void d.reject(c,!0);c._uninitialized=!1;for(var e=c.data,f=[],g=0;g<e.length;g++)f.push(e[g].id());var h=!1,i={};b.forEach(function(b){if(b.id=b.id||a(b),!(b.id in i)){i[b.id]=1;var c=f.indexOf(b.id);-1!==c?(f[c]=null,e[c].merge(b)):(h=!0,e.push(new U(b)))}});for(var g=f.length-1;g>=0;g--)f[g]&&(h=!0,e.splice(g,1));d.resolve(c,h)}),d):(d.reject(this,!1),d)},getMediaCount:function(){var a=this.data;if(0===a.length)return 0;for(var b=0,c={},d=0;d<a.length;++d){var e=a[d],f=e.title()+e.type();c[f]||(c[f]=!0,++b)}return b},getMedia:function(a){return this.data.filter(function(b){return b.id()==a})[0]},getMediaGroup:function(a){return this.data.filter(function(b){return-1!==a.indexOf(b.id())})},download:function(a){var b=this.getMedia(a);if(b){var c={url:b.url(),filename:b.getFilename(),referrer:b.referrer()},d=mb.download(c);return d.success(function(a){b.download=a,U._downloads[b.id()]=a}),d}},group:function(){return e(b(this.data,["type","title","ext","quality"]))},isOneMedia:function(){for(var a,b,c=this.data,d={},e=0,f=0;e<c.length&&1>=f;++e)if(a=c[e],b=a.title()+a.type(),!d[b]&&(d[b]=!0,++f>1))return!1;return!0}};var W=function(){this._storage=chrome.storage.local,this._options={},this._default={on_page_buttons:!0};var a=this;chrome.storage.onChanged.addListener(function(b,c){if("local"===c)for(var d in b)a._options[d]=b[d].newValue})};W.prototype={load:function(){var a=new Q,b=this;return this._storage.get(null,function(c){b._options=c,a.resolve(c)}),a},set:function(a,b){var c={};("string"==typeof a||"number"==typeof a&&"undefined"!=typeof b)&&(c[a]=b,this._options[a]=b,this._storage.set(c))},get:function(a){return a in this._options?this._options[a]:this._default[a]}};var X,Y=function(){const a=0,b=10,c=20,d=30;var e=0;if(chrome.extension.getBackgroundPage)switch(document.location.pathname){case"/popup.html":e=a;break;case"/options.html":e=b;break;case"/background.html":e=d;break;default:return}else e=c;var f;return chrome.metricsPrivate?f=function(a,b){chrome.metricsPrivate.recordSmallCount("Savior."+a,b)}:e===c?f=function(a,b){chrome.runtime.sendMessage({requestType:"metrics",method:"log",params:{name:a,value:b}})}:(console.warn("Metrics are not logged"),f=function(a,b){console.info("Metrics",a,b)}),{log:function(a,b){"PageShown"!==a&&(b+=e),"ButtonClicked"===a?a="TryItNowButtonClicked":"CheckBoxClicked"===a&&(a="OneClickCheckbox"),f(a,b)},doLog:e===d?f:null,PAGE_WELCOME_SCREEN:0,PAGE_DOWNLOADS_LIST:1,PAGE_ONE_CLICK_DOWNLOAD:2,PAGE_NO_MEDIA_FOUND:3,PAGE_OPTIONS:4,PAGE_CONTENT_SHOW_CONTROLS:5,PAGE_CONTENT_NO_MEDIA:9,DOWNLOAD_AUTO:0,DOWNLOAD_BUTTON:1,DOWNLOAD_ALL:2,DOWNLOAD_REQUEST_SIZE:3,DOWNLOAD_REQUEST_SIZE_FAILED:4,DOWNLOAD_CANCELED:7,BUTTON_MAIN:0,BUTTON_TRY_IT_NOW:1,BUTTON_SHOW_DOWNLOADS:2,BUTTON_HIDE_DOWNLOADS:3,BUTTON_DOWNLOAD_ALL:4,BUTTON_CHECK_ALL:5,BUTTON_CHECK_NONE:6,BUTTON_FAKE_QUALITY:7,CHECK_BOX_ENABLE_ONE_CLICK:0,CHECK_BOX_SHOW_ON_PAGE_BUTTONS:2}}(),Z={extract:function(a){var b,c=a.getAttribute("flashvars").split("&");return c.forEach(function(a){a=a.split("="),"file"===a[0]&&(b=decodeURIComponent(a[1]))}),b},parsePlaylist:function(a){var b=N.xmlParser.parseFromString(a,"text/xml"),c=[];return N.queryAll("track",b).forEach(function(a){var b=a.querySelector("location").textContent,d=[a.querySelector("title").textContent],e=a.querySelector("creator");e&&""!==e.textContent.trim()&&d.unshift(e.textContent.trim());var f=N.parseUrl(b);f.type="mp3"===f.ext?"audio":"video",f.title=d.join(" – "),c.push(f)}),c}},$=[/^(.+\.)?googlesyndication\.com/i,/^(.+\.)?adi\.vcmedia\.vn/i],_={strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}.loose;!function(){function a(a){return N.isMatches(a,L)}function b(){var a=N.queryAll(c).filter(j);return 1===a.length?k(a[0]):null}var c='embed[type="application/x-shockwave-flash"], object[type="application/x-shockwave-flash"]';X=i("default",function(){var c=location.host,d=[];if(a(c))return d;for(var e=N.queryAll("[src]"),f=[],g=0,h=e.length;h>g;++g){var i=e[g],j=i.src,l=m(j);if(l&&i.getAttribute("src")){var o=N.parseUrl(j);n(o.host)||(o.type=l,U.isValidData(o)&&(i=k(i),i?d.push(this._makePlayer(i,[o])):f.push(o)))}}return f.length&&d.push(this._makePlayer(null,f)),d.push(this._makePlayer(b(),this._ids)),d},!0)}();var ab;!function(){function a(b){var c=b.split("&"),d={},e=0;return c.forEach(function(b){var c=b.split("=");if(c[0]&&"undefined"!=typeof c[1]){var f="undefined"==typeof d[c[0]]?c[0]:c[0]+e++;if("url"==c[0]||"title"==c[0]||"type"===c[0])d[f]=decodeURIComponent(c[1]);else if("url_encoded_fmt_stream_map"===c[0]||"adaptive_fmts"===c[0]){var g=decodeURIComponent(c[1]).split(",");d[f]=g.map(a)}else d[f]=a(decodeURIComponent(c[1]||""))}else d=b}),d}function b(a){for(var b,c=0;c<m.length;++c)if(b=a.match(m[c]))return b[1];return null}function c(b){function c(e,f){if(f>=e.length)return void d.reject([]);var h=e[f];N.get(o+b+h).success(function(b){var h=a(b);return"fail"===h.status?void c(e,f+1):void d.resolve(g(h))}).fail(function(){c(e,f+1)})}var d=new Q;return c(p,0),d}function d(a,b){return a.replace(/^(https?:\/\/)([^\/#?]+)/,"$1"+b)}function e(a,b){var c=[];return a.forEach(function(a){if(a.itag&&a.url&&n[a.itag]){var e={type:"video",url:a.url+(a.sig?"&signature="+a.sig:""),quality:quality.getYoutubeQuality(a.itag),filename:b,ext:n[a.itag]};a.fallback_host&&(e.altUrl=d(e.url,a.fallback_host)),c.push(e)}}),c}function f(a,b){function c(a){return a.bitrate*(-1!==a.contentType.indexOf("vorbis")?10:1)}a=a.filter(function(a){if(!a.url)return console.warn("Yo! why U no have url",a),!1;var b=(a.size||"").replace(/^\d+x/,"");return a.contentType=a.type,a.type=N.getMediaType(a.type,n[a.itag]),a.quality=quality.getYoutubeQuality(a.itag,!0)||quality.getQualityBySize(b,!0),a.type&&("audio"===a.type||a.quality)});var d=a.filter(function(a){return"audio"===a.type}).sort(function(a,b){return c(a)-c(b)})[0];if(!d)return console.warn("Yo! why U no haz audio youtube"),[];var e=a.filter(function(a){return"video"===a.type}).map(function(a){return{type:"video",quality:a.quality,url:{videoUrl:a.url,videoCodec:a.contentType,audioUrl:d.url,audioCodec:a.contentType},title:b,filename:b,ext:"mp4"}});return e}function g(a){var b=[],c=a.title.replace(/\+(?!\+)/g," "),d=a.url_encoded_fmt_stream_map,g=a.adaptive_fmts;return d&&d.length&&(b=e(d,c)),g&&g.length&&(b=b.concat(f(g,c))),b}function j(b){var c=N.queryAll("embed#movie_player, embed#movie_player-flash"),d=[];return c.forEach(function(c){var e=c.getAttribute("flashvars"),f=a(e);f.video_id&&-1!==b.indexOf(f.video_id)&&(d=d.concat(g(f)))}),d}const l="https:"===location.protocol.toLowerCase()?"https:":"http:",m=[/^https?:\/\/(?:www\.)?youtube(?:-nocookie)?(?:\.googleapis)?\.com\/(?:(?:v)|(?:embed)|(?:e))\/([^&\?]+)/i,/https?:\/\/(?:www\.)?youtube\.com\/.*(?:\?|&)v=([^&\?]+)/i],n={5:"flv",6:"flv",13:"3gp",17:"3gp",18:"mp4",22:"mp4",34:"flv",35:"flv",36:"3gp",37:"mp4",43:"webm",44:"webm",45:"webm",46:"webm",120:"flv",160:"mp4",133:"mp4",134:"mp4",135:"mp4",136:"mp4",137:"mp4",138:"mp4",242:"webm",243:"webm",244:"webm",247:"webm",139:"mp4a",140:"mp4a",141:"mp4a",171:"ogg",172:"ogg"},o=l+"//www.youtube.com/get_video_info?video_id=",p=["&el=embedded","&el=detailpage","&el=vevo"],q=[/^https?:\/\/(?:www\.)?facebook.com\//i],r=N.isMatches(document.location.href,q),s=h({name:"youtube",parse:function(a){var b=j([a]);return b.length?b:b=c(a)}});ab=i("youtube",function(){var a,c=this,d=[],e=[];if(!N.query("#player-unavailable:not(.hid)")){a=N.query(".html5-video-player")||N.query("#player, #movie_player, #movie_player-html5, #movie_player-flash");var f=N.queryAll('embed[type="application/x-shockwave-flash"]',a);if(1===f.length&&(f=k(f[0]),f&&(a=f)),a){a=c._makePlayer(a,[],s);var g=b(location.href);g&&(a.ids.push(g),e.push(g))}}var h=N.query(".channels-video-player, #upsell-video");if(h){var i=h.dataset;if(h=c._makePlayer(h,[],s),i){var g=i.videoId;g&&(h.ids.push(g),e.push(g))}a||(a=h,h=null)}var j='iframe[src*="youtube"], embed[src*="youtube"]';return r&&(j+=', a[href*="youtube.com"]'),N.queryAll(j).forEach(function(a){var f=b(a.src||decodeURIComponent(a.href));f&&-1===e.indexOf(f)&&(e.push(f),"A"===a.tagName&&(a=null),d.push(c._makePlayer(a,[f],s)))}),h&&h.ids.length&&d.splice(0,0,h),a&&a.ids.length&&d.splice(0,0,a),d.push(c._makePlayer(null,this._ids,s)),d},!0),ab.getMoviesById=c}();var bb;!function(){function a(a){for(var b,c=0;c<f.length;++c)if(b=a.match(f[c]),b&&b[1])return b[1];return null}function b(a){var b=a.match(g)||[];return b[1]}function c(a){var b=[],c=a.request.files.h264;return c?(Object.keys(c).forEach(function(d){b.push({type:"video",title:a.video.title,filename:a.video.title,ext:"mp4",url:c[d].url,quality:window.quality.getVimeoQuality(d)})}),b):b}function d(c){switch(c.tagName){case"IFRAME":return a(c.src);case"PARAM":return b(c.value);case"VIDEO":return b(c.src);default:return a(c.getAttribute("data-fallback-url")||"")}return null}const e="https:"===location.protocol.toLowerCase()?"https:":"http:",f=[/\/\/(?:player\.)?vimeo\.com(?:\/video)?\/([0-9]+)/i,/\/\/vimeo.com\/couchmode\/.*\/([0-9]+)/i,/\/\/player.vimeo.com\/v[0-9]\/video\/([0-9]+)/i,/\/\/player.vimeo.com\/moog\/([0-9]+)/i],g=/(?:&|\?)clip_id=([0-9]+)(?:&|$)/i,j=e+"//player.vimeo.com/video/{{id}}/config?referrer={{location}}",k=h({name:"vimeo",request:{method:"GET",url:function(a){return a.match(/\/video\/(\d+)\/config(\?|$)/i)?a:j.replace("{{id}}",a).replace("{{location}}",location.href)}},parse:function(a){var b=JSON.parse(a);return c(b)}});bb=i("vimeo",function(){var b=this,c=[],e=[],f=N.queryAll('iframe[src*="vimeo.com"], param[value*="vimeo.com"], video[src*="vimeo.com"], .player[data-fallback-url]');if(f.forEach(function(a){var f=d(a);f&&-1===e.indexOf(f)?(e.push(f),c.push(b._makePlayer(a,[f],k))):console.log("missed",a,f)}),"vimeo.com"===location.host||"player.vimeo.com"===location.host){var g=N.query("#videos_gallery li.selected a"),h=g&&g.href||location.href,i=a(h);i&&-1===e.indexOf(i)&&(e.push(i),c.push(b._makePlayer(g,[i],k)))}return c.push(b._makePlayer(null,b._ids,k)),c},!0)}();var cb;!function(){function a(a){var b={};return a.split("&").forEach(function(a){var c=a.split("=");if("params"===c[0])try{b[c[0]]=JSON.parse(decodeURIComponent(c[1]))}catch(d){}else b[c[0]]=decodeURIComponent(c[1])}),b}function b(a,b){var c=[],d=a.video_data||a.params&&a.params.video_data;if(d){var f=N.query("h2.uiHeaderTitle")||N.query(".fbPhotoMediaTitleNoFullScreen");b=b||f&&N.strip(f.textContent),l.forEach(function(a){d.forEach(function(d){d[a]&&(c=c.concat(e(d[a],b||d.video_id,a)))})})}return c}function c(a){for(var b=/fbPhotoMediaTitleNoFullScreen\\">([^>]*)\\u003C|fbPhotoSnowliftVideoTitle\\">([^>]*)\\u003C/g,c=null;c=b.exec(a);)if(c&&(c[1]||c[2]))return c[1];return null}function d(a){var b=a.match(/\[\\"params\\",\\"([^"]+)\\"/i);try{return JSON.parse(decodeURIComponent(b[1].replace(/\\\\u0025/g,"%")))}catch(c){return{}}}function e(a,b,c){if(a){var d=N.parseUrl(a);return d.type="video",c&&(d.quality=quality.getFacebookQuality(c)),b&&(d.title=b.replace(/\+(?!\+)/g," ")),[d]}return[]}function f(a){var b=a.href||"",c=b.match(n);if(!c||!c[1])return null;for(var d=c[1],e=null;a=a.parentNode;){var e=a.getAttribute("data-gt");if(e)break}try{e=JSON.parse(e)}catch(f){return null}var g=e.viewerid;return g?m.replace("{{user_id}}",g).replace("{{data}}",encodeURIComponent(JSON.stringify({v:d,theater:null,firstLoad:!0}))):null}const g='embed[flashvars*="fbcdn.net"], embed[flashvars*="fbcdn-video-a"]',j="a.videoThumb",k=/(\.|^)(facebook|fb).com$/i,l=["hd_src","sd_src"],m="https://www.facebook.com/ajax/pagelet/generic.php/PhotoViewerInitPagelet?no_script_path=1&data={{data}}&__user={{user_id}}&__a=1&__dyn={{dyn}}&__req=jsonp_2&__adt=2",n=/^https?:\/\/(?:www\.)(?:facebook|fb)\.com\/(?:v\/|photo\.php\?v=)([0-9]+)/i,o=h({name:"facebook",request:{method:"GET",url:function(a){return a.replace("{{dyn}}",Math.random().toString().slice(2))}},parse:function(a){var e=d(a),f=c(a);return b(e,f)}}),p=h({parse:b});cb=i("facebook",function(){var b=this,c=[];if(location.host.match(k)){var d=N.queryAll(j);d.forEach(function(a){var d=f(a);d&&c.push(b._makePlayer(a,[d],o))})}var d=N.queryAll(g);return d.forEach(function(d){var e=d.getAttribute("flashvars");e=a(e),e&&c.push(b._makePlayer(d,[e],p))}),c})}();var db;!function(){function a(a){var b=a.available_formats,c=a.title,d=[];return b.forEach(function(b){var e=a[g[b]];if(e){var f=N.parseUrl(e);f.type="video",f.quality=quality.getDailymotionQuality(b),c&&(f.title=c),d.push(f)}}),d}const b=/^https?:\/\/(?:www\.)dailymotion\.com\/embed\/video\/([a-z0-9]+)/i,c=/"videoId":"([a-z0-9]+)"/i,d=/^#video=([a-z0-9]+)/i,e='param[name="flashvars"][value*="dailymotion.com"], iframe[src*="http://www.dailymotion.com/embed/video/"], embed[src*="http://www.dailymotion.com/embed/video/"]',f="id,swf_url,thumbnail_url,thumbnail_large_url,thumbnail_medium_url,stream_h264_url,stream_h264_ld_url,stream_h264_hq_url,stream_h264_hd_url,stream_h264_hd1080_url,paywall,mode,onair,audience_url,stream_live_hls_url,stream_live_rtsp_url,title,url,owner_screenname,owner_username,duration,channel,owner_url,ads,private,type,owner.type,isrc,language,available_formats,explicit,created_time,stream_hls_url,vast_url_template,log_view_urls",g={ld:"stream_h264_ld_url",sd:"stream_h264_url",hq:"stream_h264_hq_url",hd:"stream_h264_hd_url",hd720:"stream_h264_hd_url",hd1080:"stream_h264_hd1080_url"},j=h({name:"dailymotion",request:{method:"GET",url:function(a){return"http://www.dailymotion.com/json/video/"+a+"?fields="+f+"&parentURL="+encodeURIComponent(location.href)}},parse:function(b){return a(JSON.parse(b))}});db=i("dailymotion",function(){var a,f=this,g=[],h=[],i=N.queryAll(e);if(i.forEach(function(d){var e,i,k=!1;"PARAM"===d.tagName?(e=c,i=decodeURIComponent(d.value)):(e=b,i=d.src,k=!0);var l=i.match(e),m=l&&l[1];if(m&&-1===h.indexOf(m)){h.push(m);var n=f._makePlayer(d,[m],j);g.push(n),(k||!a)&&(a=n)}}),"www.dailymotion.com"===location.host){var k=location.hash.match(d)||location.href.match(b),l=k&&k[1];if(l&&-1===h.indexOf(l))if(a)a.ids.push(l);else{var m=f._makePlayer(node,[l],j);g.push(m)}}return a&&(this._ids!==a.ids&&(a.ids=N.unique(a.ids.concat(this._ids))),this._ids=a.ids),g},!0)}();var eb;!function(){const a=h({parse:function(a){return ab.getMoviesById(a)}}),b=h({name:"vietgiaitri",request:{method:"GET"},parse:Z.parsePlaylist});eb=i("vietgiaitri",function(){var c=this,d=[],e=location.href.match(/vietgiaitri\.com\/.*id\.([^\.]+)\.vgt/i),f=(e||[])[1];return f&&d.push(this._makePlayer(null,[f],a)),location.host.match(/vietgiaitri\.com/i)&&N.queryAll('embed[src*="vietgiaitri.com"]').forEach(function(a){var e=Z.extract(a);e&&d.push(c._makePlayer(a,[e],b))}),d})}();var fb;!function(){function a(a){try{var d;switch(a.tagName){case"IFRAME":d=a.src.match(b);break;case"PARAM":d=a.getAttribute("value").match(c)}return(d||[])[1]}catch(e){return void 0}}const b=/https?:\/\/clip\.vn\/embed\/([0-9a-z_-]+)/i,c=/(?:^|&)id=([0-9a-z_-]+)/i,d=h({name:"clipvn",request:{method:"POST",url:function(a){return"http://nfo.clip.vn/movies/nfo/"+a},params:function(){return{referrer:encodeURIComponent(btoa(location.href)),onsite:"clip"}},headers:function(){return{"X-REFERRER":location.href}}},parse:function(a){var b=N.xmlParser.parseFromString(a,"text/xml"),c=b.querySelector("ClipInfo title"),d=N.queryAll("ClipInfo enclosure",b).map(function(a){var b=a.getAttribute("url"),d=N.parseUrl(b),e=a.getAttribute("quality");return d.type="video",c&&(d.title=c.textContent),d.quality=quality.getClipvnQuality(e),d});return d}});fb=i("clipvn",function(){var b=this,c=[],e=[],f=N.queryAll('param[name="flashvars"][value*="clip.vn"], iframe[src*="clip.vn"]');return f.forEach(function(f){var g=a(f);g&&-1===e.indexOf(g)&&(e.push(g),c.push(b._makePlayer(f,[g],d)))}),c})}();var gb;!function(){function a(a){try{return M.AES.decrypt({ciphertext:M.enc.Hex.parse(a),salt:""},M.enc.Utf8.parse(f),{iv:M.enc.Utf8.parse(g),mode:M.mode.CBC,padding:M.pad.NoPadding}).toString(M.enc.Utf8)}catch(b){return""}}function b(a){var b=N.queryAll("script"),c=[];return b.forEach(function(b){var d=b.textContent.match(/<source\s+src="([^"]+)"\s+type="([^"]+)"/i);if(d){var e=N.detectMediaTypeAndExt(d[1],d[2]);e.title=a,c.push(e)}}),c}function c(a){return-1===a.indexOf("load-song")}const d='param[value*=".zing.vn/xml/"], param[value*="tv.zing.vn/tv/xml/"]',e=/xmlURL=([^&]+)/i,f="f_pk_ZingTV_1_@z",g="f_iv_ZingTV_1_@z",j=/^https?:\/\//i,k=["f1080","f720","hq","f480","f360","source","f240","f"],l=["m3u8","m3u"],m=h({name:"zingvn",request:{method:"GET"},parse:function(c){var d=N.xmlParser.parseFromString(c,"text/xml"),e=[];return N.queryAll("data > item",d).forEach(function(c){var d=c.getAttribute("type"),f=[c.querySelector("title").textContent],g=c.querySelector("performer");g&&""!==g.textContent.trim()&&f.unshift(g.textContent.trim()),f=f.join(" – "),N.toArray(c.childNodes).forEach(function(b){if(-1!==k.indexOf(b.tagName)){var c=b.textContent;if(N.isMatches(c,j)||(c=a(c)),"require vip"!==c&&""!==c&&-1===c.indexOf("/rplaylist")&&N.isMatches(c,j)){var g=N.parseUrl(c);-1===l.indexOf(g.ext)&&("mp3"===d?(g.type="audio",g.quality=quality.getZingAudioQuality(b.tagName)):(g.type="video",g.quality=quality.getZingVideoQuality(b.tagName)),g.ext=g.ext||d,g.title=f,e.push(g))}}}),e.length||(e=b(f))}),e}});gb=i("zingvn",function(){var a=this,b=[],f=[],g=N.queryAll(d);return g.forEach(function(d){var g=(d.getAttribute("value").match(e)||[])[1];g&&c(g)&&-1===f.indexOf(g)&&(f.push(g),b.push(a._makePlayer(d,[g],m)))}),b.push(a._makePlayer(null,this._ids,m)),b},!0)}();var hb;!function(){function a(){return"www.nhaccuatui.com"===location.hostname&&0===location.pathname.indexOf("/video/")}function b(){if("www.nhaccuatui.com"!==location.hostname)return null;var a=N.queryAll('object[type="application/x-shockwave-flash"]');if(1!==a.length)return null;var b=a[0];return b.getAttribute("data").match(/flash\/player\.nct/)?b:k(b)}const c='meta[content*="flash/xml?key"]',d=/https?:\/\/[^\?]+xml\?key.*/,e=h({name:"nhaccuatui",request:{method:"GET"},parse:Z.parsePlaylist});hb=i("nhaccuatui",function(){var f=[];if(a())return f;var g=N.queryAll(c).map(function(a){var b=a.getAttribute("content")||"";return(b.match(d)||[null])[0]}).filter(N.notNull);return g=N.unique(g),g.length&&f.push(this._makePlayer(null,g,e)),f.push(this._makePlayer(b(),this._ids,e)),f},!0)}();var ib;!function(){function a(a){var b={};return a.split("&").forEach(function(a){var c=a.split("=");b[c[0]]=decodeURIComponent(c[1])}),b}function b(a){return a.replace(/&#(\d+);/g,function(a,b){return String.fromCharCode(+b)})}const c="http://nhac.vui.vn",d='param[name="flashvars"][value*="vui.vn"]',e="http://nhac.vui.vn/asx2.php?type={{type}}&id={{id}}",f=/playlistfile=([^?&]+)/i,g=/(a|m|clip)(\d+)[^-]+$/i,j={a:3,m:1,clip:1},k=h({name:"vui",request:{method:"GET",url:function(a){return a.match(/^https?:\/\//i)?a:c+a}},parse:function(a){var c=N.xmlParser.parseFromString(a,"text/xml"),d=[];return N.queryAll("item",c).forEach(function(a){try{var c=[b(a.querySelector("title").textContent)],e=a.querySelector("description");e&&(e=e.textContent.replace(/thể hiện:/i,"").trim(),""!==e&&c.unshift(e));var f=a.getElementsByTagNameNS("http://developer.longtailvideo.com/","file")[0].textContent,g=N.parseUrl(f);g.type="mp3"===g.ext?"audio":"video",g.title=c.join(" – "),d.push(g)}catch(h){}}),d}});ib=i("vui",function(){var b=this,c=N.parseUrl(location.href);if(c.host.match(/vui\.vn$/))if("html"===c.ext){var h=c.filename.match(g);if(h&&h[1]&&h[2]){for(var i=h[2],l=null,m=N.queryAll('param[name="flashvars"]'),n=m.length-1;n>=0;n--){var o=m[n];if(o.value&&-1!==o.value.indexOf(i)){l=o;break}}var c=e.replace("{{type}}",j[h[1]]).replace("{{id}}",i);return[b._makePlayer(l,[c],k)]}}else if("swf"===c.ext){var h=c.search.match(f);if(h&&h[1]){var c=decodeURIComponent(h[1]);return[b._makePlayer(null,[c],k)]}}var p=[],q=N.queryAll(d);return q.forEach(function(c){var d=a(c.value);d&&d.playlistfile&&p.push(b._makePlayer(c,[d.playlistfile],k))}),p})}();var jb;!function(){function a(a){var b,e,f=/^https?:\/\/nhacso.net\/embed\/([^\/]+)\/(.+)/i;if(a.src){if(e=a.src.match(f),3!==e.length)return null;switch(e[1]){case"album":b=d+e[2];break;case"video":b=c+e[2];break;default:return null}}else b=a.value.replace(/^.*xmlPath=([^&]+).*$/i,"$1");return b}const b=['param[name="flashvars"][value*="xmlPath=http://nhacso.net"]','iframe[src*="http://nhacso.net/embed"]','param[name="movie"][value*="xmlPath=http://nhacso.net"]'].join(","),c="http://nhacso.net/flash/video2/xnl/1/id/",d="http://nhacso.net/flash/album/xnl/1/uid/X1xQVUNcZgQEBQ==,",e=h({name:"nhacso",request:{method:"GET"},parse:function(a){var b=N.xmlParser.parseFromString(a,"text/xml"),c=[];return N.queryAll("track, song",b).forEach(function(a){try{var b=[a.querySelector("name, title").textContent],d=a.querySelector("artist");d&&""!==d.textContent.trim()&&b.unshift(d.textContent.trim());var e=a.querySelector("sourceUrl, url, mp3link").textContent,f=N.parseUrl(e);f.type="mp3"===f.ext?"audio":"video",f.title=b.join(" – "),c.push(f)}catch(g){}}),c}});jb=i("nhacso",function(){var c=this,d=[],f=[],g=N.queryAll(b);return g.forEach(function(b){var g=a(b);g&&-1===f.indexOf(g)&&(f.push(g),d.push(c._makePlayer(b,[g],e)))}),d})}();var kb=function(){this._providers=[new X,new ab,new bb,new cb,new gb,new hb,new eb,new fb,new ib,new jb,new db]};!function(){function a(a,b){Array.prototype.push.apply(a,b)}function b(a){var b=[],c=a.ids;if(!c.length)return b;var d=a.scraper;return d?(c.forEach(function(a){var c=d.getToken(a);if(!c)return void b.push(d.getPlaylist(a));var e=new Q;cache.get(c).success(function(a){e.resolve(a)}).fail(function(){var b=new Q(d.getPlaylist(a));b.success(function(a){cache.put(c,a)}).done(function(a){e.resolve(a)})}),b.push(e)}),b):(b.push(new Q(c)),b)}function c(a){var b=new Q;return Q.when(a).done(function(){var a=Array.prototype.concat.apply([],arguments).map(function(a){return a&&(a.referrer=a.referrer||location.href),a});b.resolve(a)}),b}kb.prototype={constructor:kb,processRequest:function(a){for(var b=a.name,c=0;c<this._providers.length;++c){var d=this._providers[c];if(d.name===b&&d.processRequest){d.processRequest(a.result);break}}},getMedia:function(){var d=this._players;if(!d){var e=new Q;return e.reject([]),e}var f=[];return d.forEach(function(c){a(f,b(c))}),c(f)},getMediaForPlayer:function(a){return c(b(a))},getMediaPlayers:function(){var b=[];return this._providers.forEach(function(c){a(b,c.getMediaPlayers())}),this._players=b,b}}}();var lb=[{locationPatterns:[/https?:\/\/(?:www\.)?phimvang\.org\/xem-phim/i],urlPatterns:[],extractor:"title"},{locationPatterns:[/^https?:\/\/(www\.)?ustream.tv\/recorded\/([0-9]+)/i],urlPatterns:[],extractor:"#ViewerContent h2"},{locationPatterns:[/^https?:\/\/tv\.vnn\.vn\/(xem-phim|phim-bo)/i],urlPatterns:[],extractor:".video-content h1",server:".content-link > .active"},{locationPatterns:[/^https?:\/\/phim\.soha\.vn\/\w+\/watch/i],urlPatterns:[],extractor:"#paneloverlay h1"},{locationPatterns:[/^https?:\/\/v1vn.com\/xem-phim-online/i],urlPatterns:[],extractor:"title"},{locationPatterns:[/^https?:\/\/phim\.vnnclub\.com\/(xem|bo)-phim/i],urlPatterns:[],extractor:"#page-header-inner blink"},{locationPatterns:[/^https?:\/\/(www\.)?phim3s.net\/phim/i],urlPatterns:[],extractor:"h2.title a",server:".serverlist .server li a.active"},{locationPatterns:[/^https?:\/\/www\.thegioiphim\.eu\/movie-episode-full\.php/i],urlPatterns:[],extractor:".category-main"},{locationPatterns:[/^https?:\/\/(www\.)?hayghe\.com\/xem-phim/i],urlPatterns:[],extractor:"#tit_player"}];extractFileName=function(a){for(var b,c,d=0;d<lb.length;++d)if(c=lb[d],N.isMatches(a,c.urlPatterns)||N.isMatches(location.href,c.locationPatterns)){if("string"==typeof c.extractor)try{b=N.query(c.extractor).textContent.trim(),c.server&&(b+=" ("+N.query(c.server).textContent.trim()+")")}catch(e){}else"function"==typeof c.extractor&&(b=c.extractor());if(b)return o(b)}return null},chrome.runtime.onMessage.addListener(function(a,b,c){"extract_file_name"===a.requestType&&c(extractFileName(a.url||a.media.url))}),p.prototype={processRequest:function(a,b){switch(a){case"erased":console.log("erased download:",b);break;case"changed":console.log("changed download:",b)}},_sendMessage:function(a,b,c){chrome.runtime.sendMessage({requestType:"downloads",method:a,params:b},c)},download:function(a){var b=new Q;return this._sendMessage("download",a,function(a){var c=a.data;a.success?b.resolve(c):b.reject(c)}),b},pause:function(a){this._sendMessage("pause",a)},resume:function(a){this._sendMessage("resume",a)},cancel:function(a){this._sendMessage("cancel",a)},open:function(a){this._sendMessage("open",a)},show:function(a){this._sendMessage("show",a)}};var mb=new p,nb=function(){};nb.prototype={constructor:nb,_sendMessage:function(a,b,c){chrome.runtime.sendMessage({requestType:"cache",method:a,params:b},c)},get:function(a){var b=new Q;return this._sendMessage("get",{key:a},function(a){b[a.success?"resolve":"reject"](a.data)}),b},put:function(a,b,c){this._sendMessage("put",{key:a,value:b,ttl:c})},"delete":function(){this._sendMessage("delete",{key:key})},proxy:function(a,b,c,d){var e=this,f=new Q;return this.get(b+d).success(f.resolve.bind(f)).fail(function(){var g=new Q(c.call(a,d));g.success(function(a){e.put(b+d,a)}).done(function(a){f.resolve(a)})}),f}};var ob=function(){var a=q("div","downloads");a.innerHTML=Mustache.render(window.options.get("template-widget"),{i18n_download:O("popup_download").toUpperCase()}),this._userInitiated=!1,this._ready=!1,this._make_action=void 0,this._init(a)};ob.prototype={constructor:ob,_init:function(a){this._downloads=new V,this._widget=a,this._setPreferredQuality(options.get("preferred_quality_level"));var b=this;a.addEventListener("click",function(a){return b._onClick(a)?void 0:(a.preventDefault(),a.stopPropagation(),!0)},!1),a.addEventListener("change",this._onSelectChange.bind(this),!1)},attach:function(a){var b=a.firstChild;b?b!==this._widget&&a.replaceChild(this._widget,b):a.appendChild(this._widget),this._updateDownloads()},_setPreferredQuality:function(a){if(a=a||quality.DEFAULT_QUALITY_LEVEL,!this._userInitiated&&this._preferredQuality!==a){this._preferredQuality=a;var b=N.query("#preferred-select",this._widget);b&&(b.value=a,b.innerText=O("popup_preferred_quality_hint")+" "+O("ql_"+a.toLowerCase()))}},_updateDownloads:function(){if(!this._player||!this._userInitiated)return void this._setPreferredQuality(options.get("preferred_quality_level"));var a=this._downloads.setMediaData(this._manager.getMediaForPlayer(this._player));this._player=null,this._manager=null,a.done(this._showDownloads.bind(this))},_showDownloads:function(a,b){if(b){var c=this._widget,d=a.getMediaCount(),e=N.query("#showhide-all",c);if(0===d)return c.className="downloads-empty",e.textContent=e.title=O("popup_no_media_found"),void Y.log("PageShown",Y.PAGE_CONTENT_NO_MEDIA);c.className=d>1?"downloads-multi":"downloads-single main",e.textContent=O("popup_how_many_media_found",[d]),r(this,d,a,c)
}},_onClick:function(a){var b=this,c=a.target;switch(c.id){case"download-main":case"preferred-select":if(!b._userInitiated){c.setAttribute("disabled",!0);var d="preferred-select"===c.id;b._make_action=d?"select":"download",b._userInitiated=!0,Y.log("ButtonClicked",d?Y.BUTTON_FAKE_QUALITY:Y.BUTTON_MAIN),b._updateDownloads()}return;case"showhide-all":var e=N.query("#downloads",b._widget);if(e){var f=!e.hidden;e.hidden=f,Y.log("ButtonClicked",f?Y.BUTTON_HIDE_DOWNLOADS:Y.BUTTON_SHOW_DOWNLOADS)}return;case"download-selected":return Y.log("ButtonClicked",Y.BUTTON_DOWNLOAD_ALL),N.queryAll(".j-media-scope.selected",b._widget).forEach(function(a){b._download(N.query(".j-quality-download:not([hidden])",a))&&Y.log("Download",Y.DOWNLOAD_ALL)}),void b._updateDownloadSelected();case"check-all":return Y.log("ButtonClicked",Y.BUTTON_CHECK_ALL),void b._toggleSelectMedia(N.queryAll(".j-media-scope",b._widget),!0);case"check-none":return Y.log("ButtonClicked",Y.BUTTON_CHECK_NONE),void b._toggleSelectMedia(N.queryAll(".j-media-scope",b._widget),!1)}switch(c.tagName){case"LI":if(c.classList.contains("j-media-scope")){var g=!c.classList.contains("selected");return void b._toggleSelectMedia(c,g)}break;case"SPAN":var h=c.parentNode;return h.classList.contains("j-quality-download")?void(b._download(h)&&(Y.log("Download",Y.DOWNLOAD_BUTTON),b._updateDownloadSelected())):!0;case"SELECT":return;case"INPUT":if("checkbox"===c.type){var i=N.findParent(c,"j-media-scope");return i&&b._toggleSelectMedia(i,c.checked),!0}}return!0},_onSelectChange:function(a){var b=a.target;if("SELECT"===b.tagName){if("quality-level-selection"===b.id);else{var c=b.value.trim(),d=c.split("/")[1];if(1===N.queryAll(".j-media-scope",this._widget).length){var e=quality.getQualityLevelByQualityType(d);options.set("preferred_quality_level",e),options.set("preferred_quality:"+e,c)}var f=N.findParent(b,"j-media-scope");this._applyCurrentValues(f),Y.log("VideoQualityChanged",quality.getVideoQualityIndex(d)),this._updateDownloadSelected()}return!1}},_toggleSelectMedia:function(a,b){function c(a){a.classList.toggle("selected",b),N.query('.filename [type="checkbox"]',a).checked=b}Array.isArray(a)?a.forEach(c):c(a),this._updateDownloadSelected()},_updateDownloadSelected:function(){var a=!0;N.queryAll(".j-media-scope.selected",this._widget).some(function(b){return N.query(".j-quality-download:not([hidden]):not(.j-disabled)",b)?(a=!1,!0):void 0}),N.query("#download-selected",this._widget).classList.toggle("disabled",a)},_applyCurrentValues:function(a,b){var c=this,d=a.querySelector(".j-quality-selector"),e=d.value;N.queryAll(".j-quality-option, .j-quality-download",a).forEach(function(a){a.hidden=a.dataset.quality!==e,b||a.hidden||!a.classList.contains("j-quality-download")||c._checkFileSize(a.dataset.id)})},_getSizeOfVisibleMedia:function(){for(var a=N.query(".downloads-list",this._widget),b=a.scrollTop,c=a.offsetHeight,d=N.queryAll(".j-quality-download:not([hidden])",a),e=0,f=d.length;f>e;++e){var g=d[e];if(g.offsetTop>b+c+10)break;this._checkFileSize(g.dataset.id)}},_checkFileSize:function(a){var b=this._downloads.getMedia(a);b&&!b.get("size")&&(Y.log("Download",Y.DOWNLOAD_REQUEST_SIZE),b.getSize().done(this._updateFileSize.bind(this,b)))},_updateFileSize:function(a,b){var c=N.query("#size_"+a.id(),this._widget);c&&(c.classList.add("done"),c.textContent=a.size(),b||Y.log("Download",Y.DOWNLOAD_REQUEST_SIZE_FAILED))},_download:function(a){return a.classList.contains("j-disabled")?void 0:(a.classList.add("j-disabled"),a.classList.add("btn-progress"),this._downloads.download(a.dataset.id).success(function(){a.classList.remove("btn-progress"),a.classList.add("btn-started")}).fail(function(b){a.classList.remove("btn-progress"),a.classList.remove("j-disabled"),console.warn("failed to download :(",a.dataset.id,b)}),!0)},setMediaData:function(a,b){this._manager=a,this._player=b,this._ready=b.ids.length>0,this._updateDownloads()},isReady:function(){return this._ready}};var pb,qb=3e3,rb=null,sb=null,tb=null;H()}();