!function(a,b,c){function d(a){return-1!==["m3u8","m3u"].indexOf(a)}function e(a){var b=a.url;a="object"==typeof b?b.videoUrl+"\n"+b.audioUrl:b;var c=v.hash(a);return c.toString()}function f(a,b){var d=b[0],e={};if(!d){if(a.length>1)for(var g=0;g<a.length;++g){var h=a[g],i=h.url();if("object"==typeof i&&(i=i.videoUrl),-1!==i.indexOf(".googlevideo.com"))return[h]}return[a[0]]}return a.forEach(function(a){var b=a[d]&&a[d]()||"";e[b]=e[b]||[],e[b].push(a)}),Object.keys(e).map(function(a){var g=f(e[a],b.slice(1)),h={media:g};return h[d]=v.defined(a)?a:c,h.is_only=1===g.length&&(!v.defined(g[0].is_only)||g[0].is_only),h["i18n_"+d]=w("media_fields_"+d+"_"+a),h})}function g(a){return a.forEach(function(a){var b=a.type;a.media.forEach(function(a){a.media=a.media.sort(function(a,c){return o[b].extensions.indexOf(a.ext)-o[b].extensions.indexOf(c.ext)})})}),a}function h(a){return a.ext?(a.media=a.media.sort(function(a,b){return quality.getQualityLevelByType(a.quality)-quality.getQualityLevelByType(b.quality)}),a):(Array.isArray(a)?a=a.map(h):a.media=h(a.media),a)}function i(a){return h(g(a))}function j(){function a(a,b){if(a){if("USER_CANCELED"===a)return void G.log("Download",G.DOWNLOAD_CANCELED);var c;0===a.indexOf("SERVER_")?c="RefrSE":0===a.indexOf("FILE_")&&(c="RefrFE"),c&&G.log(c,b.ref)}}var b=this;b._callbacks={},b._data={},b._tabMedia2id={},chrome.downloads.onCreated.addListener(function(a){b._data[a.id]={item:a,tid:null},console.log("download item",a.state,a)}),chrome.downloads.onErased.addListener(function(a){var c=b._data[a];c&&b._sendMessage(c.tid,"erased",a),delete b._data[a]}),chrome.downloads.onChanged.addListener(function(c){var d=b._data[c.id];d&&null!==d.tid&&(console.log("sending change",d.tid,c),b._sendMessage(d.tid,"changed",c),c.error&&a(c.error.current,d),b._onChange(c))}),chrome.tabs.onRemoved.addListener(function(a){delete b._callbacks[a],delete b._tabMedia2id[a]})}function k(a,b,c){return{name:a,hosts:Array.isArray(b)?b:[b],match:c}}function l(a,b,c){chrome.tabs.sendMessage(a,{requestType:"request.matched",name:b,result:c})}function m(a,b){if("flv"!==a.ext)return!1;var c=b.server;return c&&-1!==c.indexOf("icecast")}function n(a,b){if(!b||d(a.ext))return!0;if("vhosting.vcmedia.vn"===a.host)return!0;var c=+b;Number.isNaN(c)&&(c=null);var e=options.get("min_stream_size");return null!==c&&e>c?!1:(a.size=c,!0)}const o={audio:{title:"Audio",rgxp:/audio/i,extensions:["mp3","flac","m4a","wma","ogg","wav","aif","mid"],ctype2extension:{midi:"mid",mp4:"m4a",m4a:"m4a",mpeg:"mp3",mpeg3:"mp3",wav:"wav",aiff:"aif"}},video:{title:"Video",rgxp:/video/i,extensions:["mp4","mpeg4","mpg","mpeg","m4v","avi","divx","mov","wmv","movie","asf","webm","flv","3gp"],ctype2extension:{mpeg:"mp4",mp4:"mp4",m4v:"mp4","3gpp":"3gp",flv:"flv",quicktime:"mov",msvideo:"avi","ms-wmv":"wmv","ms-asf":"asf"}}},p=function(){var a={};return Object.keys(o).forEach(function(b){for(var c=o[b].extensions,d=0;d<c.length;d++)a[c[d]]=b}),a}(),q=[/^(.+\.)?youtube.com/i,/^(.+\.)?zing.vn/i,/^(.+\.)?nhaccuatui.com/i,/^(.+\.)?nhacso.net/i,/^(.+\.)?vimeo.com/i,/^(.+\.)?clip.vn/i,/vietgiaitri\.com/i],r=[/^(.+\.)?nixcdn\.com/im,/^(.+\.)?vcmedia\.vn/i,/^(.+\.)?kenhhd\.tv/i],s=[/^(.+\.)?googlesyndication\.com/i,/^(.+\.)?histats\.com/i,"adnetwork.vn","doubleclick.net","admicro","adnet.vn","ds-vn.serving-sys.com","lavanetwork.net","video.sgame.vn:8080","cdn.blueseed","vcmedia.vn","innity.net","serving-sys.com","ambientplatform.vn","gvt1.com"];var t=function(){function a(a,b){var c=a[0]-b[0];return 0!==c?c:(c=a[1]-b[1],0!==c?c:(c=a[2]-b[2],0!==c?c:c=a[3]-b[3]))}var b="",c={mp4:!0},d=0,e=navigator.userAgent.match(/Chrome\/([\d\.]+)/);return e&&e[1]&&(e=e[1].split("."),e=[+e[0],+e[1],+e[2],+e[3]],a(e,[39,0,2171,103])>=0&&(b+=" webm!",c.webm=!0),a(e,[39,0,2171,105])>=0&&(b+=" m3u8!",d=1)),b&&console.info(b),{YT:c,M3U8:d}}(),u=function(){function a(a){return a&&0!==a.indexOf("data:image")?f.exec(a):[]}var c=b.createElement("a"),d=/([^/]+)$/i,e=/\.([^/.]*)$/i,f={strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}.strict,g=a(b.location.href);return{parse:function(a,b){var f=c;f.setAttribute("href",a);var g=(f.pathname.match(d)||[])[1]||"",h=g.split(".").map(function(a){return a.toLowerCase()});g=decodeURIComponent(g.replace(e,"")),h.shift();var i=h[h.length-1]||"",j={url:a,protocol:f.protocol,host:f.host,port:f.port,pathname:f.pathname,filename:g,ext:i,exts:h,search:f.search};return j.port||delete j.port,b&&(j.query={},f.search.replace(/^\?/,"").split(/\&/).forEach(function(a){a=a.split("="),j.query[a[0]]=a[1]})),j},format:function(a){if(a=Object.create(a),a.query){a.search=[];for(var b in a.query)a.search.push("undefined"!=typeof a.query[b]?b+"="+encodeURIComponent(a.query[b]):b);a.search="?"+a.search.join("&"),delete a.query}for(var d in a)c[d]=a[d];var e=c.href;return e},parse0:a,resolve:function(b,c){b=a(b),c||(c=g);var d=b[1],e=b[2],f=b[9],h=b[12],i=b[13];if(!d&&(d=c[1],!e))if(e=c[2],f){if("/"!==f.charAt(0)){var j=c[10]||"/";f=j+f}}else f=c[9],h||(h=c[12]);var k=d+"://"+e+f;return h&&(k+="?"+h),i&&(k+="#"+i),k},getHost:function(b){return a(b)[6]||""},getMediaType:function(b){var c=a(b)[11]||"";if(!c)return"";var d=c.split("."),e=d.length-1;if(0>=e)return"";var f=d[e].toLowerCase();return p[f]}}}(),v={SIZES:["B","KB","MB","GB","TB","PB"],_BASE:-1!==navigator.appVersion.indexOf("Win")?1024:1e3,xmlParser:new DOMParser,endsWith:function(a,b){var c=a.length-b.length;return c>=0&&a.indexOf(b,c)===c},hash:function(a,b){if(b=0|b,0===a.length)return b;var c,d;for(c=0,d=a.length;d>c;c++)b=(b<<5)-b+a.charCodeAt(c),b|=0;return b},query:function(a,c){return c=c||b,c.querySelector(a)},queryAll:function(a,c){return c=c||b,v.toArray(c.querySelectorAll(a))},findParent:function(a,b){for(;null!==a&&!a.classList.contains(b);)a=a.parentNode;return a},closest:function(a,b){return a.matches(b)?[a]:v.queryAll(b,a)},toArray:function(a){return Array.prototype.slice.call(a)},unique:function(a){var b=[];return Array.isArray(a)?(a.forEach(function(a){-1===b.indexOf(a)&&b.push(a)}),b):a},extend:function(a,b){var c=function(){};c.prototype=a.prototype,b.prototype=new c,b.prototype.constructor=b,b._super=a.prototype},extendObject:function(a){return Array.prototype.forEach.call(Array.prototype.slice.call(arguments,1),function(b){if(b)for(var c in b)a[c]=b[c]}),a},isMatches:function(a,b){var c,d,e;if(Array.isArray(a)){for(c=0;c<a.length;++c)if(v.isMatches(a[c],b))return!0;return!1}for(b=Array.isArray(b)?b:[b],c=0,d=b.length,e;d>c;++c)if(e=b[c],"string"==typeof e&&-1!==a.indexOf(e)||e instanceof RegExp&&a.match(e))return!0;return!1},_sendBackgroundRequest:function(a,b,c,d){var e=new y;return chrome.runtime.sendMessage({requestType:"make_http_request",method:a,url:b,params:c,headers:d},function(a){e[a.success?"resolve":"reject"](a.data)}),e},send:function(a,b,c,d){var e=new y,f=null;if(v.IS_CONTENT_SCRIPT)return v._sendBackgroundRequest(a,b,c,d);try{var g=new XMLHttpRequest;if(g.open(a,b,!0),g.setRequestHeader("Cache-Control","no-cache"),"object"==typeof c&&(f=Object.keys(c).map(function(a){return a+"="+c[a]}).join("&")),"object"==typeof d)for(var h in d)g.setRequestHeader(h,d[h]);"POST"===a&&(g.setRequestHeader("Content-type","application/x-www-form-urlencoded"),f&&g.setRequestHeader("Content-Length",f.length)),g.onload=function(){e.resolve(this.responseText)},g.onerror=function(){e.reject()},g.send(f)}catch(i){e.reject()}return e},get:function(a,b){return v.send("GET",a,{},b)},post:function(a,b,c){return v.send("POST",a,b,c)},_getSize:function(a){function b(a){d&&d[a?"resolve":"reject"](a),d=null,c.abort(),clearTimeout(e),e=null}var c=new XMLHttpRequest,d=new y,e=null,f=1e4;return console.log("%c[SQ] %s","color:'navi';",a),c.open("GET",a),c.setRequestHeader("Cache-Control","no-cache"),c.url=a,c.onreadystatechange=function(){if(!(this.readyState<2)){var a=null;try{a=+this.getResponseHeader("Content-Length"),Number.isNaN(a)&&(a=null)}catch(c){}(null!==a||200===this.status)&&(200!==this.status&&(a=null),b(a))}},c.send(null),e=setTimeout(b,f),d},getSize:function(b){var c=new y,d=a.cache;return d.get(b).success(function(a){a?(c.resolve(a),d.put(b,a)):c.bind(v._getSize(b)).success(d.put.bind(d,b))}).fail(function(){c.bind(v._getSize(b)).success(d.put.bind(d,b))}),c},beautifyFileSize:function(a){if(null===a||"undefined"==typeof a)return"???";for(var b=v._BASE,c=0;c<v.SIZES.length&&a>=b;++c,a/=b);return Math.round(10*a)/10+v.SIZES[c]},detectMediaTypeAndExt:function(a,b){b=b||"";var c=["application/x-mpegurl","application/vnd.apple.mpegurl","audio/x-mpegurl","audio/mpegurl"];if(-1!==c.indexOf(b))return a.type="video",a.ext="m3u8",a;var d=v.getMediaType(b,a.exts);return d&&o[d]&&(a.type=d,a.ext=this._findIntersection(a.exts,o[d].extensions)||v.extByContentType(b,d)||a.ext),a},getMediaType:function(a,b){var c;for(var d in o){if(c=o[d],a.match(c.rgxp))return d;if(Array.isArray(b)&&v._findIntersection(b,c.extensions)||-1!==c.extensions.indexOf(b))return d}return null},_findIntersection:function(a,b){for(var c=a.concat(b),d={},e=0;e<c.length;++e){var f=c[e];if(d[f])return f;d[f]=!0}return null},extByContentType:function(a,b){var c=o[b].ctype2extension;for(var d in c)if(-1!==a.indexOf(d))return c[d];return null},call:function(a,b){if(a&&!(a.length<=0))for(var c=[].slice.call(arguments,2),d=0;d<a.length;d++)a[d].apply(b,c)},isTrue:function(a){return!!a},noop:function(){},defined:function(a){return"undefined"!=typeof a},notNull:function(a){return null!==a},replaceEntities:function(a){var b={"&amp;":"&"};return String(a).replace(/&amp;/g,function(a){return b[a]})}},w=chrome.i18n.getMessage;try{chrome.extension.getBackgroundPage(),v.IS_CONTENT_SCRIPT=!1}catch(x){v.IS_CONTENT_SCRIPT=!0}var y=function(a){if(0===arguments.length)return this._init(),this;if(a instanceof y)return a;var b=new y;return b.resolve(a),b};y.RUNNING=0,y.RESOLVED=1,y.FAILED=2,y.prototype={constructor:y,_init:function(){this._results=[],this._subscribers=[],this.state=y.RUNNING},_notify:function(){var a=this;this._subscribers.forEach(function(b){b.apply(a,a._results)}),this._subscribers=[]},resolve:function(){return this.state=y.RESOLVED,this._results=arguments,this._notify(),this},reject:function(){return this.state=y.FAILED,this._results=arguments,this._notify(),this},subscribe:function(a){this.state!==y.RUNNING?a.apply(this,this._results):this._subscribers.push(a)},done:function(a){return this.subscribe(a),this},success:function(a){var b=this;return this.subscribe(function(){b.state===y.RESOLVED&&a.apply(b,b._results)}),this},fail:function(a){var b=this;return this.subscribe(function(){b.state===y.FAILED&&a.apply(b,b._results)}),this},bind:function(a){return a=new y(a),a.success(this.resolve.bind(this)).fail(this.reject.bind(this)),this}},y.when=function(){var a=[];return a=Array.isArray(arguments[0])?arguments[0]:v.toArray(arguments),new y.When(a)},y.When=function(a){this._doneCallbacks=[],this._successCallbacks=[],this._failCallbacks=[],this._state=y.RUNNING,this._thingsToDo=a.length,this._results=Array(this._thingsToDo),this._init(a)},y.When.prototype={constructor:y.When,_init:function(a){var b=this;a.forEach(function(a,c){a=new y(a),a.subscribe(function(){a.state===y.FAILED&&(b._state=y.FAILED),b._results[c]=v.toArray(arguments),b._thingsToDo--,b._checkIsDone()})}),this._checkIsDone()},_checkIsDone:function(){if(0!==this._thingsToDo)return!1;var a=[];this._results.forEach(function(b){a=a.concat(b)}),this._state===y.FAILED?this._runCallbacks(this._failCallbacks,a):this._runCallbacks(this._successCallbacks,a),this._runCallbacks(this._doneCallbacks,a),this._doneCallbacks=[],this._successCallbacks=[],this._failCallbacks=[]},_runCallbacks:function(a,b){a.forEach(function(a){a.apply(this,b)})},done:function(a){return this._doneCallbacks.push(a),this._checkIsDone(),this},success:function(a){return this._successCallbacks.push(a),this._checkIsDone(),this},fail:function(a){return this._failCallbacks.push(a),this._checkIsDone(),this}},y.chain=function(){function a(b){if(!b.length)return c.resolve.apply(c,d);var e,f=b.shift();"function"==typeof f?(e=y(f()),e.done(function(c){d.push(c),a(b)})):(d.push(f),a(b))}var b,c=new y,d=[];return b=Array.isArray(arguments[0])?arguments[0]:v.toArray(arguments),a(b),c};var z=function(){this._storage=chrome.storage.local,this._options={},this._default={on_page_buttons:!0,min_stream_size:30720,prefer_last_quality:!0};var a=this;chrome.storage.onChanged.addListener(function(b,c){if("local"===c)for(var d in b)a._options[d]=b[d].newValue})};z.prototype={load:function(){var a=new y,b=this;return this._storage.get(null,function(c){b._options=c,a.resolve(c)}),a},set:function(a,b){var c={};("string"==typeof a||"number"==typeof a&&"undefined"!=typeof b)&&(c[a]=b,this._options[a]=b,this._storage.set(c))},get:function(a){return a in this._options?this._options[a]:this._default[a]}};var A=function(){};A.QL_HIGH="High",A.QL_MEDIUM="Medium",A.QL_LOW="Low",A.QL_VIDEO_ULTRAHD="Ultra HD",A.QL_VIDEO_FULLHD="Full HD",A.QL_VIDEO_HD="HD",A.QL_VIDEO_STANDARD="Standard",A.QL_VIDEO_MEDIUM="Medium",A.QL_VIDEO_SMALL="Small",A.QL_VIDEO_MOBILE="Mobile";var B={};B[A.QL_VIDEO_ULTRAHD]={quality:A.QL_HIGH,qualityIndex:6,size:3072,videoTitle:"Ultra HD",itag:[38,138]},B[A.QL_VIDEO_FULLHD]={quality:A.QL_HIGH,qualityIndex:5,size:1080,videoTitle:"Full HD",audioTitle:"High",itag:[37,46,137],vimeoQuality:"",zingTag:"f1080",dailymotionQuality:"hd1080",clipvnQuality:"5"},B[A.QL_VIDEO_HD]={quality:A.QL_HIGH,qualityIndex:4,size:720,videoTitle:"HD",audioTitle:"High",itag:[22,45,120,136,247],zingTag:["f720","hq"],vimeoQuality:"hd",dailymotionQuality:["hd","hd720"],facebookQuality:"hd_src",clipvnQuality:"4"},B[A.QL_VIDEO_STANDARD]={quality:A.QL_MEDIUM,qualityIndex:3,size:480,videoTitle:"Standard",audioTitle:"Normal",itag:[44,35,135,244],zingTag:["f480"],dailymotionQuality:"hq",vimeoQuality:"sd",facebookQuality:"sd_src",clipvnQuality:"3"},B[A.QL_VIDEO_MEDIUM]={quality:A.QL_MEDIUM,qualityIndex:2,size:360,videoTitle:"Medium",audioTitle:"Normal",itag:[18,43,34,134,243],vimeoQuality:"",dailymotionQuality:"sd",zingTag:["source","f360"],clipvnQuality:"2"},B[A.QL_VIDEO_SMALL]={quality:A.QL_LOW,qualityIndex:1,size:240,videoTitle:"Small",audioTitle:"Low",itag:[36,5,133,242],dailymotionQuality:"ld",vimeoQuality:"mobile",zingTag:["f","f240"],clipvnQuality:"1"},B[A.QL_VIDEO_MOBILE]={quality:A.QL_LOW,qualityIndex:0,size:144,videoTitle:"Mobile",audioTitle:"Low",itag:[17,6,160],vimeoQuality:"",clipvnQuality:"0"};var C={};C[A.QL_HIGH]=B[A.QL_VIDEO_ULTRAHD].qualityIndex,C[A.QL_MEDIUM]=B[A.QL_VIDEO_STANDARD].qualityIndex,C[A.QL_LOW]=B[A.QL_VIDEO_SMALL].qualityIndex,A.prototype={constructor:A,DEFAULT_QUALITY_LEVEL:A.QL_HIGH,QUALITY_LEVELS:[A.QL_HIGH,A.QL_MEDIUM,A.QL_LOW],VIDEO_QUALITY_LEVELS:[A.QL_VIDEO_FULLHD,A.QL_VIDEO_HD,A.QL_VIDEO_STANDARD,A.QL_VIDEO_MEDIUM,A.QL_VIDEO_SMALL,A.QL_VIDEO_MOBILE],DEFAULT_QUALITY_TYPE:A.QL_VIDEO_STANDARD,QUALITY_TYPES:B,getFacebookQuality:function(a){return this._getVideoQuality("facebookQuality",a).videoTitle},getDailymotionQuality:function(a){return this._getVideoQuality("dailymotionQuality",a).videoTitle},getZingVideoQuality:function(a){return this._getVideoQuality("zingTag",a).videoTitle},getZingAudioQuality:function(a){return this._getVideoQuality("zingTag",a).audioTitle},getYoutubeQuality:function(a,b){var c=this._getVideoQuality("itag",+a,b);return c&&c.videoTitle},getVimeoQuality:function(a){return this._getVideoQuality("vimeoQuality",a).videoTitle},getClipvnQuality:function(a){return this._getVideoQuality("clipvnQuality",a).videoTitle},getQualityBySize:function(a){if(a=parseInt(a),isNaN(a))return null;var b=1/0,c=null,d=this.QUALITY_TYPES[this.DEFAULT_QUALITY_TYPE];for(var e in this.QUALITY_TYPES){var f=this.QUALITY_TYPES[e];f.size>d.size&&(d=f),a<=1.3*f.size&&f.size<b&&(c=f,b=f.size)}return c=c||d,c.videoTitle},_getVideoQuality:function(a,b,c){for(var d in this.QUALITY_TYPES){var e=this.QUALITY_TYPES[d][a];if(Array.isArray(e)||(e=[e]),-1!==e.indexOf(b))return this.QUALITY_TYPES[d]}return c?null:this.QUALITY_TYPES[this.DEFAULT_QUALITY_TYPE]},_getTypeByQualityType:function(a){for(var b in this.QUALITY_TYPES)if(a===b||a===this.QUALITY_TYPES[b].videoTitle||a===this.QUALITY_TYPES[b].audioTitle)return this.QUALITY_TYPES[b];return this.QUALITY_TYPES[this.DEFAULT_QUALITY_TYPE]},_calculateWeight:function(a,b){var c=o[a.get("type")].extensions,d=c.indexOf(a.get("ext")),e=this._getTypeByQualityType(a.get("quality")).qualityIndex,f=d/c.length+Math.abs(b-e)/7;return f},getQualityLevelByType:function(a){return Object.keys(this.QUALITY_TYPES).indexOf(this._getTypeByQualityType(a).videoTitle)},getVideoQualityIndex:function(a){return this.VIDEO_QUALITY_LEVELS.concat().reverse().indexOf(a)},getOneClickQualityIndex:function(a){return this.QUALITY_LEVELS.concat().reverse().indexOf(a)},getQualityLevelByQualityType:function(a){return this._getTypeByQualityType(a).quality},chooseBestDownload:function(a,b,c){var d=a.length;if(c)for(var e=0;d>e;++e){var f=a[e];if(f.extQuality()===c)return f}b=b||this.DEFAULT_QUALITY_LEVEL;for(var g=C[b],h=1e3,i=-1,e=0;d>e;++e){var f=a[e],j=this._calculateWeight(f,g);h>j&&(h=j,i=e)}return a[i]}},a.quality=new A;var D=function(){this._cache={}};D.DEFAULT_TTL=12e5,D.prototype={constructor:D,processRequest:function(a,b,c){var d=this;switch(b){case"get":return d.get(c.key);case"put":d.put(c.key,c.value,c.ttl);break;case"delete":d["delete"](c.key)}},get:function(a){var b=new y;return a in this._cache?b.resolve(this._cache[a]):b.reject(null),b},put:function(a,b,c){a&&"undefined"!=typeof b&&(c=c||D.DEFAULT_TTL,this._cache[a]=b,setTimeout(this["delete"].bind(this,a),c))},"delete":function(a){this._cache[a]&&delete this._cache[a]}};var E=function(a){console.assert(a.id),this._values={},this._sizePromise=null,this._hls=!1,this.merge(a)};E.MAX_FILE_NAME_LENGTH=128,E.isValidData=function(a){if(t.M3U8&&d(a.ext))return!0;var b=o[a.type];return b&&-1!==b.extensions.indexOf(a.ext)},E.prototype._createFieldGetter=function(a){this[a]=function(){return this.get(a)}},E.prototype.get=function(a){return"string"==typeof a||"number"==typeof a?this._values[a]:void 0},E.prototype.set=function(a,b){return"string"!=typeof a&&"number"!=typeof a||this._values[a]===b||(this._values[a]=b,this[a]||this._createFieldGetter(a)),this},E.prototype.merge=function(a){var b=a instanceof E?a._values:a;for(var c in b)this.set(c,"undefined"!=typeof b[c]?b[c]:b[c]||null);return d(this.get("ext"))&&(this.set("ext","mp4"),this._hls=!0),this},E.prototype.getName=function(){return v.replaceEntities(this._values.title||this._values.filename)},E.prototype.title=function(){return this.getName().substr(0,E.MAX_FILE_NAME_LENGTH)},E.prototype.getFilename=function(){var a=this.getName(),b="."+this._values.ext;return v.endsWith(a,b)||(a+=b),a=a.replace(/\s+/g," ").replace(/[\/\\:*?"<>|\u200c\u200d]/g,"-"),a.substr(0,E.MAX_FILE_NAME_LENGTH)},E.prototype.extQuality=function(){return(this.get("ext")||"")+"/"+(this.get("quality")||"")},E.prototype.size=function(){var a=this.get("size");return a?"("+v.beautifyFileSize(a)+")":""},E.prototype.getSize=function(){function a(a){a&&e.push(v.getSize(a))}var b=this;if(b._sizePromise)return b._sizePromise;var c=new y;b._sizePromise=c;var d=b.get("size")||0;if(d||b._hls)return c.resolve(d),c;var e=[],f=b.get("url");if("object"==typeof f){var g=[f.audioUrl,f.videoUrl];g.forEach(a)}else a(f);e.length>0?e=1===e.length?e[0]:y.when(e):(e=new y,e.reject());var h=b.get("altUrl");return e.success(function(){for(var a=arguments,d=0,e=a.length-1;e>=0;e--)d+=a[e];b.set("size",d),c.resolve(d)}).fail(function(){if(h){var a=v.getSize(h);a.success(function(a){b.set("size",a)}),c.bind(a)}else c.reject(null)}),c};var F=function(a,b){this.api=J,this._uninitialized=!0,v.defined(b)||(b=-1),this._tid=b,this.data=[],this.setMediaData(a)};F.prototype={setMediaData:function(a){var b=this,c=new y;return a?(y(a).done(function(a){if(b._uninitialized&&0===a.length)return b._uninitialized=!1,void c.reject(b,!0);b._uninitialized=!1;for(var d=b.data,f=[],g=new Array(d.length),h=0;h<d.length;h++)f.push(d[h].id());a.forEach(function(a){a.id=a.id||e(a);var c,h=f.indexOf(a.id);-1===h?(f.push(a.id),c=new E(a),d.push(c)):(h<g.length&&(g[h]=!0),c=d[h],c.merge(a)),c._ditem=b.api.item(b._tid,a.id)});for(var i=g.length!==d.length,h=g.length-1;h>=0;h--)g[h]||(i=!0,d.splice(h,1));c.resolve(b,i)}),c):(c.reject(this,!1),c)},getMediaCount:function(){var a=this.data;if(0===a.length)return 0;for(var b=0,c={},d=0;d<a.length;++d){var e=a[d],f=e.title()+e.type();c[f]||(c[f]=!0,++b)}return b},getMedia:function(a){return this.data.filter(function(b){return b.id()==a})[0]},getMediaGroup:function(a){return this.data.filter(function(b){return-1!==a.indexOf(b.id())})},download:function(a){var b=this,c=b.getMedia(a);if(c){var d={id:c.id(),url:c.url(),filename:c.getFilename(),referrer:c.referrer(),hls:c._hls},e=b.api.download(b._tid,d);return e.success(function(a){c._ditem=a}),e}},onChange:function(a){this.api.onChange(this._tid,a)},group:function(){return i(f(this.data,["type","title","ext","quality"]))},isOneMedia:function(){for(var a,b,c=this.data,d={},e=0,f=0;e<c.length&&1>=f;++e)if(a=c[e],b=a.title()+a.type(),!d[b]&&(d[b]=!0,++f>1))return!1;return!0}};var G=function(){function a(a){return-1===i.indexOf(a)}const c=0,d=10,e=20,f=30;var g=0;if(chrome.extension.getBackgroundPage)switch(b.location.pathname){case"/popup.html":g=c;break;case"/options.html":g=d;break;case"/background.html":g=f;break;default:return}else g=e;var h,i=["Refr","RefrSE","RefrFE"];return chrome.metricsPrivate?h=function(b,c){a(b)?chrome.metricsPrivate.recordSmallCount("Savior."+b,c):chrome.metricsPrivate.recordValue({metricName:"Savior."+b,type:"histogram-linear",min:0,max:1e3,buckets:1002},c)}:g===e?h=function(a,b){chrome.runtime.sendMessage({requestType:"metrics",method:"log",params:{name:a,value:b}})}:(console.warn("Metrics are not logged"),h=function(a,b){console.info("Metrics",a,b)}),{log:function(a,b){-1===i.indexOf(a)&&"PageShown"!==a&&(b+=g),"ButtonClicked"===a?a="TryItNowButtonClicked":"CheckBoxClicked"===a&&(a="OneClickCheckbox"),h(a,b)},doLog:g===f?h:null,PAGE_WELCOME_SCREEN:0,PAGE_DOWNLOADS_LIST:1,PAGE_ONE_CLICK_DOWNLOAD:2,PAGE_NO_MEDIA_FOUND:3,PAGE_OPTIONS:4,PAGE_CONTENT_SHOW_CONTROLS:5,PAGE_CONTENT_NO_MEDIA:9,DOWNLOAD_AUTO:0,DOWNLOAD_BUTTON:1,DOWNLOAD_ALL:2,DOWNLOAD_REQUEST_SIZE:3,DOWNLOAD_REQUEST_SIZE_FAILED:4,DOWNLOAD_CANCELED:7,BUTTON_MAIN:0,BUTTON_TRY_IT_NOW:1,BUTTON_SHOW_DOWNLOADS:2,BUTTON_HIDE_DOWNLOADS:3,BUTTON_DOWNLOAD_ALL:4,BUTTON_CHECK_ALL:5,BUTTON_CHECK_NONE:6,BUTTON_FAKE_QUALITY:7,CHECK_BOX_ENABLE_ONE_CLICK:0,CHECK_BOX_SHOW_ON_PAGE_BUTTONS:2,CHECK_BOX_PREFER_LAST_QUALITY:4}}(),H=function(){var a=this;this._media={},chrome.tabs.onRemoved.addListener(function(b){a.resetAllMedia(b,!0)})};H.prototype={constructor:H,processRequest:function(a,b,c){var d=this;switch(b){case"reset_all":d.resetAllMedia(a);break;case"set_present":d.setHasMedia(a,c)}},showPageActionState:function(a){var b=!!this._media[a];chrome.runtime.lastError&&console.warn(chrome.runtime.lastError),chrome.pageAction[b?"show":"hide"](a),chrome.runtime.lastError&&console.warn(chrome.runtime.lastError),b&&!options.get("not_first_run")&&chrome.pageAction.showPopup&&setTimeout(function(){chrome.tabs.query({active:!0,currentWindow:!0,windowType:"normal"},function(b){b.length&&b[0].id==a&&!options.get("not_first_run")&&(chrome.runtime.lastError&&console.warn(chrome.runtime.lastError),chrome.pageAction.showPopup(a))})},5e3)},_requestMediaFromCS:function(a){var b=new y;return chrome.tabs.sendMessage(a,{requestType:"get_media"},function(a){b.resolve(a)}),b},resetAllMedia:function(a,b){delete this._media[a],b||this.showPageActionState(a)},setHasMedia:function(a,b){this._media[a]=b,this.showPageActionState(a)},getMediaForTab:function(a){var b=new y;return this._requestMediaFromCS(a).done(function(c){b.resolve(new F(c,a))}),b}},a.db=new H;var I=function(){for(var a=["facebook.com","youtube.com","mp3.zing.vn","tv.zing.vn","radio.zing.vn","clip.vn","nhaccuatui.com","haivl.tv","yan.vn","xvideos.com","meme.vn","yeucahat.com","chimsedinang.com","phim3s.net","media.bongdaplus.vn","nhac.vui.vn","phim14.net","xhamster.com","xnxx.com","movies.hdviet.com","chiasenhac.com","videos.vietgiaitri.com","hayhaytv.vn","vietsub.vnsharing.net","nhacso.net","pornhub.com","phimsexvip.com","vntube.tv","hdonline.vn","xemphimso.com","dailymotion.com","tienganh123.com","redtube.com","phim8.vn","tube8.com","vietnamnettv.vn","sexnhanh.com","zphimsex.com","vivo.vn","porn99.net","phimnhanh.net","anime47.com","phimsexporn.com","keeng.vn","lauxanh.org","khosachnoi.com.vn","xemnghe.com","blogviet.com.vn","soundcloud.com","learningenglish.voanews.com"],b={},c=0,d=a.length;d>c;++c){var e=a[c];console.assert(!(e in b),'Duplicate "'+e+'": '+b[e]+", "+c),b[e]=c+1}return function(a){for(var c=u.getHost(a),d=b[c];!d&&c;){var e=c.indexOf(".")+1;if(0===e)break;c=c.substr(e),d=b[c]}return 0|d}}();j.prototype={processRequest:function(a,b,c){var d=this;switch(b){case"download":return console.log("downloading from",a),d.download(a,c,!0);case"pause":d.pause(c);break;case"resume":d.resume(c);break;case"cancel":d.cancel(c);break;case"open":d.open(c);break;case"show":d.show(c)}},_sendMessage:function(a,b,c,d){chrome.tabs.sendMessage(a,{requestType:"downloads",method:b,params:c},d)},_onChange:function(a){console.log("changed download:",a,this._data[a.id]);var b=this._data[a.id];if(!b)return void console.log("No matching download",a);var c=b.item;for(var d in a)"id"!==d&&(c[d]=a[d].current);v.call(this._callbacks[b.tid],this,b.mid,c,a)},_options:function(a){var b={filename:a.filename},c=a.url;if("object"==typeof c){if(!c.videoUrl||!c.audioUrl)return;chrome.mediaDownload?(b.videoUrl=c.videoUrl,b.audioUrl=c.audioUrl):b.url=c.videoUrl}else b.url=c;if(chrome.mediaDownload){var d=a.referrer;d&&(b.referrer=d);var e=[b.url,b.audioUrl,b.videoUrl].filter(v.defined);v.isMatches(e,r)&&(b.streamsNumber=1),a.hls&&(b.streamsNumber=-42)}return b},onChange:function(a,b){var c=this._callbacks[a];c||(c=this._callbacks[a]=[]),c.push(b)},download:function(a,b,c){function d(b){if(b){var d=e._data[b];if(d){d.tid=a,d.mid=h,d.ref=I(g);var i=e._tabMedia2id[a];return i||(i=e._tabMedia2id[a]={}),i[h]=b,G.log("Refr",d.ref),f.resolve(d.item),void(c||e._sendMessage(a,"created",d))}console.log("O_o no download data:",b)}f.reject(chrome.runtime.lastError)}var e=this,f=new y,g=b.referrer,h=b.id,i=e._options(b);return console.log(i.url),i?i.url?(i.conflictAction="uniquify",chrome.downloads.download(i,d)):chrome.mediaDownload.combineStreams(i,d):d(),f},item:function(a,b){var c=this._tabMedia2id[a],d=c&&c[b],e=this._data[d];return e&&e.item},pause:function(a){chrome.downloads.pause(a)},resume:function(a){chrome.downloads.resume(a)},cancel:function(a){chrome.downloads.cancel(a)},open:function(a){chrome.downloads.open(a)},show:function(a){chrome.downloads.show(+a)}};var J=new j,K=function(){var a=["youtube.com","vimeo.com",/^(.+\.)?vimeocdn.com/,"fbcdn.net",/^(.+\.)?clip.vn$/i,"subs.xemphimonlines.com","dailymotion.com","dmcdn.net",/.*dailymotion.*\/frag\(\d+\)\//gi,"nhacrap.tv","nixcdn.com",/^(.+\.)?zdn\.vn$/i,"vui.vn"];return Array.prototype.push.apply(a,s),function(b){return v.isMatches(b.host,a)?"vhosting.vcmedia.vn"===b.host?!1:!0:/fptplay\.net/.test(b.host)&&/seg\d*-frag\d*/i.test(b.pathname)?!0:-1!==["49ef4358-e34d-484f-a18e-495cd9fe3817","75247339-7897-437d-9627-55b1a1528700"].indexOf(b.filename)?!0:!1}}(),L=function(){};L.prototype={constructor:L,name:"default",match:function(a,b,c){if(!K(b)&&c["content-type"]){var e=b;"plist.vn-hd.com"===e.host&&d(e.ext)?e.type="video":e=v.detectMediaTypeAndExt(e,c["content-type"]),E.isValidData(e)&&!m(e,c)&&(e.url=this._filterUrl(a.url),(302===a.statusCode||n(e,c["content-length"]))&&(302===a.statusCode&&a.redirectUrl&&(e.altUrl=this._filterUrl(a.redirectUrl)),this._reportNewMedia(a,e)))}},_reportNewMedia:function(a,b){function c(a){var c=u.parse(a);v.isMatches(c.host,q)||!c.protocol.match(/^http|^ftp/)||"coccoc.com"===c.host&&"/webhp"===c.pathname||(b.referrer=a,l(e,d.name,b))}var d=this,e=a.tabId;-1===a.parentFrameId?chrome.tabs.get(e,function(a){a?c(a.url):console.log(chrome.runtime.lastError)}):chrome.webNavigation.getAllFrames({tabId:e},function(b){var d=b.filter(function(b){return b.frameId===a.frameId})[0];d&&c(d.url)})},_filterUrl:function(a){return a.match(/googlevideo\.com/g)&&(a=a.replace(/[&?]begin=\d+/g,"")),a}};var M=function(a){this._listeners=a,this._init()};M.prototype={constructor:M,_init:function(){var a=this._onResponseStarted.bind(this),b={urls:["*://*/*"],types:["xmlhttprequest","object","other"]};chrome.webRequest.onBeforeRedirect.addListener(a,b,["responseHeaders"]),chrome.webRequest.onResponseStarted.addListener(a,b,["responseHeaders"])},_onResponseStarted:function(a){if(!(a.tabId<0)){var b=this._parseHeaders(a.responseHeaders),c=u.parse(a.url);this._listeners.some(function(d){if(!d.hosts||v.isMatches(c.host,d.hosts)){var e=d.match(a,c,b);return e&&l(a.tabId,d.name,e),!0}})}},_parseHeaders:function(a){var b={};return a.length?(a.forEach(function(a){b[a.name.toLowerCase()]=a.value.toLowerCase()}),b):{}}},new M([k("youtube","youtube.com",function(a,b){var c;return b.pathname.match(/^\/(api|get)_video_info/)&&(c=b.search.match(/(?:&|\?)video_id=([^&]+)(?:&|$)/i))?c[1]:void 0}),k("zingvn",/[a-z0-9]+\.zing\.vn/i,function(a,b){var c=b.pathname;return c.match(/\/([a-z-]+\/)?xml\//gi)&&-1===c.indexOf("load-song")?b.protocol+"//"+b.host+b.pathname:void 0}),k("nhaccuatui","www.nhaccuatui.com",function(a,b){return b.search.match(/^\?key[0-9]=[0-9a-f]{32}/i)?a.url:void 0}),k("dailymotion",/(www\.)?dailymotion\.com$/,function(a,b){var c=b.pathname.match(/^\/sequence\/(play|full)\/([a-z0-9]+)/i);return c?c[2]:void 0}),k("vimeo",/player\.vimeo\.com$/i,function(a,b){var c=(b.pathname+b.search).match(/\/video\/(\d+)\/config(\?|$)/i);return c?a.url:void 0}),new L]),function(){return}(),function(){return}(),console.log("BG:run"),a.onRequest=function(a,b,c){var d=null;switch(a.requestType){case"media":d=db.processRequest(b.tab.id,a.method,a.params);break;case"cache":d=cache.processRequest(b.tab.id,a.method,a.params);break;case"make_http_request":d=v.send(a.method,a.url,a.params,a.headers);break;case"downloads":d=J.processRequest(b.tab.id,a.method,a.params);break;case"metrics":if("log"===a.method){var e=a.params;G.doLog(e.name,e.value)}}return d?(d.done(function(a){c({success:d.state===y.RESOLVED,data:a})}),!0):void 0},a.db=new H,a.options=new z,a.cache=new D;var N=options.load();N.done(function(){options.get("preferred_quality_level")||options.set("preferred_quality_level",quality.DEFAULT_QUALITY_LEVEL),chrome.runtime.onMessage.addListener(onRequest),chrome.tabs.onUpdated.addListener(function(a,b,c){c.url.match(/^(coccoc|chrome):/)&&db.resetAllMedia(a),"complete"===b.status&&db.showPageActionState(a)})}),b.addEventListener("DOMContentLoaded",function(){console.log("BG:DOMContentLoaded"),N.done(function(){options.set("template-widget",v.query("#template-widget").textContent),options.set("template-list",v.query("#template-list").textContent),options.set("template-media",v.query("#template-media").textContent)})}),!function(){var a=navigator.userAgent,b=a.replace(/(corom)\/((\d+)?[\w\.]+) /i,"");if(b!==a){var c=function(a){for(var c=0,d=a.requestHeaders.length;d>c;++c)if("User-Agent"===a.requestHeaders[c].name){a.requestHeaders[c].value=b;break}return{requestHeaders:a.requestHeaders}};chrome.webRequest.onBeforeSendHeaders.addListener(c,{urls:["*://*.google.com/*"]},["blocking","requestHeaders"])}}(),chrome.webRequest.onBeforeSendHeaders.addListener(function(a){return-1===a.tabId?(a.requestHeaders.forEach(function(a){"Cookie"===a.name&&(a.value+="; touchEnable=true;")}),{requestHeaders:a.requestHeaders
}):void 0},{urls:["*://*.nhaccuatui.com/flash/xml?key3=*"]},["blocking","requestHeaders"])}(window,document);