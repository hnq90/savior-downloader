!function(a,b,c){function d(a){return-1!==["m3u8","m3u"].indexOf(a)}function e(a){var b=a.url;a="object"==typeof b?b.videoUrl+"\n"+b.audioUrl:b;var c=q.hash(a);return c.toString()}function f(a,b){var d=b[0],e={};if(!d){if(a.length>1)for(var g=0;g<a.length;++g){var h=a[g],i=h.url();if("object"==typeof i&&(i=i.videoUrl),-1!==i.indexOf(".googlevideo.com"))return[h]}return[a[0]]}return a.forEach(function(a){var b=a[d]&&a[d]()||"";e[b]=e[b]||[],e[b].push(a)}),Object.keys(e).map(function(a){var g=f(e[a],b.slice(1)),h={media:g};return h[d]=q.defined(a)?a:c,h.is_only=1===g.length&&(!q.defined(g[0].is_only)||g[0].is_only),h["i18n_"+d]=r("media_fields_"+d+"_"+a),h})}function g(a){return a.forEach(function(a){var b=a.type;a.media.forEach(function(a){a.media=a.media.sort(function(a,c){return n[b].extensions.indexOf(a.ext)-n[b].extensions.indexOf(c.ext)})})}),a}function h(a){return a.ext?(a.media=a.media.sort(function(a,b){return quality.getQualityLevelByType(a.quality)-quality.getQualityLevelByType(b.quality)}),a):(Array.isArray(a)?a=a.map(h):a.media=h(a.media),a)}function i(a){return h(g(a))}function j(a,c){function d(){for(var a=10,b=c.scrollTop,d=-1;f-1>d&&e[d+1].top<=b;)d++;return-1===d?!1:(g!==d&&(-1!==g&&(e[g].node.style.position="static",e[g].placeholder.hidden=!0),e[d].node.style.position="fixed",e[d].placeholder.hidden=!1,g=d),d!==f-1&&b+e[d].height>e[d+1].top?(e[d].node.style.top=a-(b+e[d].height-e[d+1].top)+"px",e[d].node.classList.contains("pulled")||e[d].node.classList.add("pulled")):(e[d].node.style.top=a+"px",e[d].node.classList.contains("pulled")&&e[d].node.classList.remove("pulled")),!1)}var e=[],f=a.length,g=-1;1>f||(c.style.position="relative",e=a.map(function(a){var c=b.createElement("div");return c.style.height=a.offsetHeight+"px",c.hidden=!0,a.parentNode.insertBefore(c,a),{node:a,top:a.offsetTop,height:a.offsetHeight,placeholder:c}}),c.addEventListener("scroll",d,!1))}function k(a){var b=this;b._widget=a,b._downloads=null}function l(){B.done(function(a){chrome.tabs.connect(a,{name:"overlay"})})}function m(){setTimeout(function(){a&&a.close()},500)}const n={audio:{title:"Audio",rgxp:/audio/i,extensions:["mp3","flac","m4a","wma","ogg","wav","aif","mid"],ctype2extension:{midi:"mid",mp4:"m4a",m4a:"m4a",mpeg:"mp3",mpeg3:"mp3",wav:"wav",aiff:"aif"}},video:{title:"Video",rgxp:/video/i,extensions:["mp4","mpeg4","mpg","mpeg","m4v","avi","divx","mov","wmv","movie","asf","webm","flv","3gp"],ctype2extension:{mpeg:"mp4",mp4:"mp4",m4v:"mp4","3gpp":"3gp",flv:"flv",quicktime:"mov",msvideo:"avi","ms-wmv":"wmv","ms-asf":"asf"}}},o=function(){var a={};return Object.keys(n).forEach(function(b){for(var c=n[b].extensions,d=0;d<c.length;d++)a[c[d]]=b}),a}();var p=function(){function a(a,b){var c=a[0]-b[0];return 0!==c?c:(c=a[1]-b[1],0!==c?c:(c=a[2]-b[2],0!==c?c:c=a[3]-b[3]))}var b="",c={mp4:!0},d=0,e=navigator.userAgent.match(/Chrome\/([\d\.]+)/);return e&&e[1]&&(e=e[1].split("."),e=[+e[0],+e[1],+e[2],+e[3]],a(e,[39,0,2171,103])>=0&&(b+=" webm!",c.webm=!0),a(e,[39,0,2171,105])>=0&&(b+=" m3u8!",d=1)),b&&console.info(b),{YT:c,M3U8:d}}(),q=(function(){function a(a){return a&&0!==a.indexOf("data:image")?f.exec(a):[]}var c=b.createElement("a"),d=/([^/]+)$/i,e=/\.([^/.]*)$/i,f={strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}.strict,g=a(b.location.href);return{parse:function(a,b){var f=c;f.setAttribute("href",a);var g=(f.pathname.match(d)||[])[1]||"",h=g.split(".").map(function(a){return a.toLowerCase()});g=decodeURIComponent(g.replace(e,"")),h.shift();var i=h[h.length-1]||"",j={url:a,protocol:f.protocol,host:f.host,port:f.port,pathname:f.pathname,filename:g,ext:i,exts:h,search:f.search};return j.port||delete j.port,b&&(j.query={},f.search.replace(/^\?/,"").split(/\&/).forEach(function(a){a=a.split("="),j.query[a[0]]=a[1]})),j},format:function(a){if(a=Object.create(a),a.query){a.search=[];for(var b in a.query)a.search.push("undefined"!=typeof a.query[b]?b+"="+encodeURIComponent(a.query[b]):b);a.search="?"+a.search.join("&"),delete a.query}for(var d in a)c[d]=a[d];var e=c.href;return e},parse0:a,resolve:function(b,c){b=a(b),c||(c=g);var d=b[1],e=b[2],f=b[9],h=b[12],i=b[13];if(!d&&(d=c[1],!e))if(e=c[2],f){if("/"!==f.charAt(0)){var j=c[10]||"/";f=j+f}}else f=c[9],h||(h=c[12]);var k=d+"://"+e+f;return h&&(k+="?"+h),i&&(k+="#"+i),k},getHost:function(b){return a(b)[6]||""},getMediaType:function(b){var c=a(b)[11]||"";if(!c)return"";var d=c.split("."),e=d.length-1;if(0>=e)return"";var f=d[e].toLowerCase();return o[f]}}}(),{SIZES:["B","KB","MB","GB","TB","PB"],_BASE:-1!==navigator.appVersion.indexOf("Win")?1024:1e3,xmlParser:new DOMParser,endsWith:function(a,b){var c=a.length-b.length;return c>=0&&a.indexOf(b,c)===c},hash:function(a,b){if(b=0|b,0===a.length)return b;var c,d;for(c=0,d=a.length;d>c;c++)b=(b<<5)-b+a.charCodeAt(c),b|=0;return b},query:function(a,c){return c=c||b,c.querySelector(a)},queryAll:function(a,c){return c=c||b,q.toArray(c.querySelectorAll(a))},findParent:function(a,b){for(;null!==a&&!a.classList.contains(b);)a=a.parentNode;return a},closest:function(a,b){return a.matches(b)?[a]:q.queryAll(b,a)},toArray:function(a){return Array.prototype.slice.call(a)},unique:function(a){var b=[];return Array.isArray(a)?(a.forEach(function(a){-1===b.indexOf(a)&&b.push(a)}),b):a},extend:function(a,b){var c=function(){};c.prototype=a.prototype,b.prototype=new c,b.prototype.constructor=b,b._super=a.prototype},extendObject:function(a){return Array.prototype.forEach.call(Array.prototype.slice.call(arguments,1),function(b){if(b)for(var c in b)a[c]=b[c]}),a},isMatches:function(a,b){var c,d,e;if(Array.isArray(a)){for(c=0;c<a.length;++c)if(q.isMatches(a[c],b))return!0;return!1}for(b=Array.isArray(b)?b:[b],c=0,d=b.length,e;d>c;++c)if(e=b[c],"string"==typeof e&&-1!==a.indexOf(e)||e instanceof RegExp&&a.match(e))return!0;return!1},_sendBackgroundRequest:function(a,b,c,d){var e=new t;return chrome.runtime.sendMessage({requestType:"make_http_request",method:a,url:b,params:c,headers:d},function(a){e[a.success?"resolve":"reject"](a.data)}),e},send:function(a,b,c,d){var e=new t,f=null;if(q.IS_CONTENT_SCRIPT)return q._sendBackgroundRequest(a,b,c,d);try{var g=new XMLHttpRequest;if(g.open(a,b,!0),g.setRequestHeader("Cache-Control","no-cache"),"object"==typeof c&&(f=Object.keys(c).map(function(a){return a+"="+c[a]}).join("&")),"object"==typeof d)for(var h in d)g.setRequestHeader(h,d[h]);"POST"===a&&(g.setRequestHeader("Content-type","application/x-www-form-urlencoded"),f&&g.setRequestHeader("Content-Length",f.length)),g.onload=function(){e.resolve(this.responseText)},g.onerror=function(){e.reject()},g.send(f)}catch(i){e.reject()}return e},get:function(a,b){return q.send("GET",a,{},b)},post:function(a,b,c){return q.send("POST",a,b,c)},_getSize:function(a){function b(a){d&&d[a?"resolve":"reject"](a),d=null,c.abort(),clearTimeout(e),e=null}var c=new XMLHttpRequest,d=new t,e=null,f=1e4;return console.log("%c[SQ] %s","color:'navi';",a),c.open("GET",a),c.setRequestHeader("Cache-Control","no-cache"),c.url=a,c.onreadystatechange=function(){if(!(this.readyState<2)){var a=null;try{a=+this.getResponseHeader("Content-Length"),Number.isNaN(a)&&(a=null)}catch(c){}(null!==a||200===this.status)&&(200!==this.status&&(a=null),b(a))}},c.send(null),e=setTimeout(b,f),d},getSize:function(b){var c=new t,d=a.cache;return d.get(b).success(function(a){a?(c.resolve(a),d.put(b,a)):c.bind(q._getSize(b)).success(d.put.bind(d,b))}).fail(function(){c.bind(q._getSize(b)).success(d.put.bind(d,b))}),c},beautifyFileSize:function(a){if(null===a||"undefined"==typeof a)return"???";for(var b=q._BASE,c=0;c<q.SIZES.length&&a>=b;++c,a/=b);return Math.round(10*a)/10+q.SIZES[c]},detectMediaTypeAndExt:function(a,b){b=b||"";var c=["application/x-mpegurl","application/vnd.apple.mpegurl","audio/x-mpegurl","audio/mpegurl"];if(-1!==c.indexOf(b))return a.type="video",a.ext="m3u8",a;var d=q.getMediaType(b,a.exts);return d&&n[d]&&(a.type=d,a.ext=this._findIntersection(a.exts,n[d].extensions)||q.extByContentType(b,d)||a.ext),a},getMediaType:function(a,b){var c;for(var d in n){if(c=n[d],a.match(c.rgxp))return d;if(Array.isArray(b)&&q._findIntersection(b,c.extensions)||-1!==c.extensions.indexOf(b))return d}return null},_findIntersection:function(a,b){for(var c=a.concat(b),d={},e=0;e<c.length;++e){var f=c[e];if(d[f])return f;d[f]=!0}return null},extByContentType:function(a,b){var c=n[b].ctype2extension;for(var d in c)if(-1!==a.indexOf(d))return c[d];return null},call:function(a,b){if(a&&!(a.length<=0))for(var c=[].slice.call(arguments,2),d=0;d<a.length;d++)a[d].apply(b,c)},isTrue:function(a){return!!a},noop:function(){},defined:function(a){return"undefined"!=typeof a},notNull:function(a){return null!==a},replaceEntities:function(a){var b={"&amp;":"&"};return String(a).replace(/&amp;/g,function(a){return b[a]})}}),r=chrome.i18n.getMessage;try{chrome.extension.getBackgroundPage(),q.IS_CONTENT_SCRIPT=!1}catch(s){q.IS_CONTENT_SCRIPT=!0}var t=function(a){if(0===arguments.length)return this._init(),this;if(a instanceof t)return a;var b=new t;return b.resolve(a),b};t.RUNNING=0,t.RESOLVED=1,t.FAILED=2,t.prototype={constructor:t,_init:function(){this._results=[],this._subscribers=[],this.state=t.RUNNING},_notify:function(){var a=this;this._subscribers.forEach(function(b){b.apply(a,a._results)}),this._subscribers=[]},resolve:function(){return this.state=t.RESOLVED,this._results=arguments,this._notify(),this},reject:function(){return this.state=t.FAILED,this._results=arguments,this._notify(),this},subscribe:function(a){this.state!==t.RUNNING?a.apply(this,this._results):this._subscribers.push(a)},done:function(a){return this.subscribe(a),this},success:function(a){var b=this;return this.subscribe(function(){b.state===t.RESOLVED&&a.apply(b,b._results)}),this},fail:function(a){var b=this;return this.subscribe(function(){b.state===t.FAILED&&a.apply(b,b._results)}),this},bind:function(a){return a=new t(a),a.success(this.resolve.bind(this)).fail(this.reject.bind(this)),this}},t.when=function(){var a=[];return a=Array.isArray(arguments[0])?arguments[0]:q.toArray(arguments),new t.When(a)},t.When=function(a){this._doneCallbacks=[],this._successCallbacks=[],this._failCallbacks=[],this._state=t.RUNNING,this._thingsToDo=a.length,this._results=Array(this._thingsToDo),this._init(a)},t.When.prototype={constructor:t.When,_init:function(a){var b=this;a.forEach(function(a,c){a=new t(a),a.subscribe(function(){a.state===t.FAILED&&(b._state=t.FAILED),b._results[c]=q.toArray(arguments),b._thingsToDo--,b._checkIsDone()})}),this._checkIsDone()},_checkIsDone:function(){if(0!==this._thingsToDo)return!1;var a=[];this._results.forEach(function(b){a=a.concat(b)}),this._state===t.FAILED?this._runCallbacks(this._failCallbacks,a):this._runCallbacks(this._successCallbacks,a),this._runCallbacks(this._doneCallbacks,a),this._doneCallbacks=[],this._successCallbacks=[],this._failCallbacks=[]},_runCallbacks:function(a,b){a.forEach(function(a){a.apply(this,b)})},done:function(a){return this._doneCallbacks.push(a),this._checkIsDone(),this},success:function(a){return this._successCallbacks.push(a),this._checkIsDone(),this},fail:function(a){return this._failCallbacks.push(a),this._checkIsDone(),this}},t.chain=function(){function a(b){if(!b.length)return c.resolve.apply(c,d);var e,f=b.shift();"function"==typeof f?(e=t(f()),e.done(function(c){d.push(c),a(b)})):(d.push(f),a(b))}var b,c=new t,d=[];return b=Array.isArray(arguments[0])?arguments[0]:q.toArray(arguments),a(b),c};var u=function(){};u.QL_HIGH="High",u.QL_MEDIUM="Medium",u.QL_LOW="Low",u.QL_VIDEO_ULTRAHD="Ultra HD",u.QL_VIDEO_FULLHD="Full HD",u.QL_VIDEO_HD="HD",u.QL_VIDEO_STANDARD="Standard",u.QL_VIDEO_MEDIUM="Medium",u.QL_VIDEO_SMALL="Small",u.QL_VIDEO_MOBILE="Mobile";var v={};v[u.QL_VIDEO_ULTRAHD]={quality:u.QL_HIGH,qualityIndex:6,size:3072,videoTitle:"Ultra HD",itag:[38,138]},v[u.QL_VIDEO_FULLHD]={quality:u.QL_HIGH,qualityIndex:5,size:1080,videoTitle:"Full HD",audioTitle:"High",itag:[37,46,137],vimeoQuality:"",zingTag:"f1080",dailymotionQuality:"hd1080",clipvnQuality:"5"},v[u.QL_VIDEO_HD]={quality:u.QL_HIGH,qualityIndex:4,size:720,videoTitle:"HD",audioTitle:"High",itag:[22,45,120,136,247],zingTag:["f720","hq"],vimeoQuality:"hd",dailymotionQuality:["hd","hd720"],facebookQuality:"hd_src",clipvnQuality:"4"},v[u.QL_VIDEO_STANDARD]={quality:u.QL_MEDIUM,qualityIndex:3,size:480,videoTitle:"Standard",audioTitle:"Normal",itag:[44,35,135,244],zingTag:["f480"],dailymotionQuality:"hq",vimeoQuality:"sd",facebookQuality:"sd_src",clipvnQuality:"3"},v[u.QL_VIDEO_MEDIUM]={quality:u.QL_MEDIUM,qualityIndex:2,size:360,videoTitle:"Medium",audioTitle:"Normal",itag:[18,43,34,134,243],vimeoQuality:"",dailymotionQuality:"sd",zingTag:["source","f360"],clipvnQuality:"2"},v[u.QL_VIDEO_SMALL]={quality:u.QL_LOW,qualityIndex:1,size:240,videoTitle:"Small",audioTitle:"Low",itag:[36,5,133,242],dailymotionQuality:"ld",vimeoQuality:"mobile",zingTag:["f","f240"],clipvnQuality:"1"},v[u.QL_VIDEO_MOBILE]={quality:u.QL_LOW,qualityIndex:0,size:144,videoTitle:"Mobile",audioTitle:"Low",itag:[17,6,160],vimeoQuality:"",clipvnQuality:"0"};var w={};w[u.QL_HIGH]=v[u.QL_VIDEO_ULTRAHD].qualityIndex,w[u.QL_MEDIUM]=v[u.QL_VIDEO_STANDARD].qualityIndex,w[u.QL_LOW]=v[u.QL_VIDEO_SMALL].qualityIndex,u.prototype={constructor:u,DEFAULT_QUALITY_LEVEL:u.QL_HIGH,QUALITY_LEVELS:[u.QL_HIGH,u.QL_MEDIUM,u.QL_LOW],VIDEO_QUALITY_LEVELS:[u.QL_VIDEO_FULLHD,u.QL_VIDEO_HD,u.QL_VIDEO_STANDARD,u.QL_VIDEO_MEDIUM,u.QL_VIDEO_SMALL,u.QL_VIDEO_MOBILE],DEFAULT_QUALITY_TYPE:u.QL_VIDEO_STANDARD,QUALITY_TYPES:v,getFacebookQuality:function(a){return this._getVideoQuality("facebookQuality",a).videoTitle},getDailymotionQuality:function(a){return this._getVideoQuality("dailymotionQuality",a).videoTitle},getZingVideoQuality:function(a){return this._getVideoQuality("zingTag",a).videoTitle},getZingAudioQuality:function(a){return this._getVideoQuality("zingTag",a).audioTitle},getYoutubeQuality:function(a,b){var c=this._getVideoQuality("itag",+a,b);return c&&c.videoTitle},getVimeoQuality:function(a){return this._getVideoQuality("vimeoQuality",a).videoTitle},getClipvnQuality:function(a){return this._getVideoQuality("clipvnQuality",a).videoTitle},getQualityBySize:function(a){if(a=parseInt(a),isNaN(a))return null;var b=1/0,c=null,d=this.QUALITY_TYPES[this.DEFAULT_QUALITY_TYPE];for(var e in this.QUALITY_TYPES){var f=this.QUALITY_TYPES[e];f.size>d.size&&(d=f),a<=1.3*f.size&&f.size<b&&(c=f,b=f.size)}return c=c||d,c.videoTitle},_getVideoQuality:function(a,b,c){for(var d in this.QUALITY_TYPES){var e=this.QUALITY_TYPES[d][a];if(Array.isArray(e)||(e=[e]),-1!==e.indexOf(b))return this.QUALITY_TYPES[d]}return c?null:this.QUALITY_TYPES[this.DEFAULT_QUALITY_TYPE]},_getTypeByQualityType:function(a){for(var b in this.QUALITY_TYPES)if(a===b||a===this.QUALITY_TYPES[b].videoTitle||a===this.QUALITY_TYPES[b].audioTitle)return this.QUALITY_TYPES[b];return this.QUALITY_TYPES[this.DEFAULT_QUALITY_TYPE]},_calculateWeight:function(a,b){var c=n[a.get("type")].extensions,d=c.indexOf(a.get("ext")),e=this._getTypeByQualityType(a.get("quality")).qualityIndex,f=d/c.length+Math.abs(b-e)/7;return f},getQualityLevelByType:function(a){return Object.keys(this.QUALITY_TYPES).indexOf(this._getTypeByQualityType(a).videoTitle)},getVideoQualityIndex:function(a){return this.VIDEO_QUALITY_LEVELS.concat().reverse().indexOf(a)},getOneClickQualityIndex:function(a){return this.QUALITY_LEVELS.concat().reverse().indexOf(a)},getQualityLevelByQualityType:function(a){return this._getTypeByQualityType(a).quality},chooseBestDownload:function(a,b,c){var d=a.length;if(c)for(var e=0;d>e;++e){var f=a[e];if(f.extQuality()===c)return f}b=b||this.DEFAULT_QUALITY_LEVEL;for(var g=w[b],h=1e3,i=-1,e=0;d>e;++e){var f=a[e],j=this._calculateWeight(f,g);h>j&&(h=j,i=e)}return a[i]}},a.quality=new u;var x=function(a){console.assert(a.id),this._values={},this._sizePromise=null,this._hls=!1,this.merge(a)};x.MAX_FILE_NAME_LENGTH=128,x.isValidData=function(a){if(p.M3U8&&d(a.ext))return!0;var b=n[a.type];return b&&-1!==b.extensions.indexOf(a.ext)},x.prototype._createFieldGetter=function(a){this[a]=function(){return this.get(a)}},x.prototype.get=function(a){return"string"==typeof a||"number"==typeof a?this._values[a]:void 0},x.prototype.set=function(a,b){return"string"!=typeof a&&"number"!=typeof a||this._values[a]===b||(this._values[a]=b,this[a]||this._createFieldGetter(a)),this},x.prototype.merge=function(a){var b=a instanceof x?a._values:a;for(var c in b)this.set(c,"undefined"!=typeof b[c]?b[c]:b[c]||null);return d(this.get("ext"))&&(this.set("ext","mp4"),this._hls=!0),this},x.prototype.getName=function(){return q.replaceEntities(this._values.title||this._values.filename)},x.prototype.title=function(){return this.getName().substr(0,x.MAX_FILE_NAME_LENGTH)},x.prototype.getFilename=function(){var a=this.getName(),b="."+this._values.ext;return q.endsWith(a,b)||(a+=b),a=a.replace(/\s+/g," ").replace(/[\/\\:*?"<>|\u200c\u200d]/g,"-"),a.substr(0,x.MAX_FILE_NAME_LENGTH)},x.prototype.extQuality=function(){return(this.get("ext")||"")+"/"+(this.get("quality")||"")},x.prototype.size=function(){var a=this.get("size");return a?"("+q.beautifyFileSize(a)+")":""},x.prototype.getSize=function(){function a(a){a&&e.push(q.getSize(a))}var b=this;if(b._sizePromise)return b._sizePromise;var c=new t;b._sizePromise=c;var d=b.get("size")||0;if(d||b._hls)return c.resolve(d),c;var e=[],f=b.get("url");if("object"==typeof f){var g=[f.audioUrl,f.videoUrl];g.forEach(a)}else a(f);e.length>0?e=1===e.length?e[0]:t.when(e):(e=new t,e.reject());var h=b.get("altUrl");return e.success(function(){for(var a=arguments,d=0,e=a.length-1;e>=0;e--)d+=a[e];b.set("size",d),c.resolve(d)}).fail(function(){if(h){var a=q.getSize(h);a.success(function(a){b.set("size",a)}),c.bind(a)}else c.reject(null)}),c};var y=function(a,b){this.api=downloads,this._uninitialized=!0,q.defined(b)||(b=-1),this._tid=b,this.data=[],this.setMediaData(a)};y.prototype={setMediaData:function(a){var b=this,c=new t;return a?(t(a).done(function(a){if(b._uninitialized&&0===a.length)return b._uninitialized=!1,void c.reject(b,!0);b._uninitialized=!1;for(var d=b.data,f=[],g=new Array(d.length),h=0;h<d.length;h++)f.push(d[h].id());a.forEach(function(a){a.id=a.id||e(a);var c,h=f.indexOf(a.id);-1===h?(f.push(a.id),c=new x(a),d.push(c)):(h<g.length&&(g[h]=!0),c=d[h],c.merge(a)),c._ditem=b.api.item(b._tid,a.id)});for(var i=g.length!==d.length,h=g.length-1;h>=0;h--)g[h]||(i=!0,d.splice(h,1));c.resolve(b,i)}),c):(c.reject(this,!1),c)},getMediaCount:function(){var a=this.data;if(0===a.length)return 0;for(var b=0,c={},d=0;d<a.length;++d){var e=a[d],f=e.title()+e.type();c[f]||(c[f]=!0,++b)}return b},getMedia:function(a){return this.data.filter(function(b){return b.id()==a})[0]},getMediaGroup:function(a){return this.data.filter(function(b){return-1!==a.indexOf(b.id())})},download:function(a){var b=this,c=b.getMedia(a);if(c){var d={id:c.id(),url:c.url(),filename:c.getFilename(),referrer:c.referrer(),hls:c._hls},e=b.api.download(b._tid,d);return e.success(function(a){c._ditem=a}),e}},onChange:function(a){this.api.onChange(this._tid,a)},group:function(){return i(f(this.data,["type","title","ext","quality"]))},isOneMedia:function(){for(var a,b,c=this.data,d={},e=0,f=0;e<c.length&&1>=f;++e)if(a=c[e],b=a.title()+a.type(),!d[b]&&(d[b]=!0,++f>1))return!1;return!0}};var z=function(){function a(a){return-1===i.indexOf(a)}const c=0,d=10,e=20,f=30;var g=0;if(chrome.extension.getBackgroundPage)switch(b.location.pathname){case"/popup.html":g=c;break;case"/options.html":g=d;break;case"/background.html":g=f;break;default:return}else g=e;var h,i=["Refr","RefrSE","RefrFE"];return chrome.metricsPrivate?h=function(b,c){a(b)?chrome.metricsPrivate.recordSmallCount("Savior."+b,c):chrome.metricsPrivate.recordValue({metricName:"Savior."+b,type:"histogram-linear",min:0,max:1e3,buckets:1002},c)}:g===e?h=function(a,b){chrome.runtime.sendMessage({requestType:"metrics",method:"log",params:{name:a,value:b}})}:(console.warn("Metrics are not logged"),h=function(a,b){console.info("Metrics",a,b)}),{log:function(a,b){-1===i.indexOf(a)&&"PageShown"!==a&&(b+=g),"ButtonClicked"===a?a="TryItNowButtonClicked":"CheckBoxClicked"===a&&(a="OneClickCheckbox"),h(a,b)},doLog:g===f?h:null,PAGE_WELCOME_SCREEN:0,PAGE_DOWNLOADS_LIST:1,PAGE_ONE_CLICK_DOWNLOAD:2,PAGE_NO_MEDIA_FOUND:3,PAGE_OPTIONS:4,PAGE_CONTENT_SHOW_CONTROLS:5,PAGE_CONTENT_NO_MEDIA:9,DOWNLOAD_AUTO:0,DOWNLOAD_BUTTON:1,DOWNLOAD_ALL:2,DOWNLOAD_REQUEST_SIZE:3,DOWNLOAD_REQUEST_SIZE_FAILED:4,DOWNLOAD_CANCELED:7,BUTTON_MAIN:0,BUTTON_TRY_IT_NOW:1,BUTTON_SHOW_DOWNLOADS:2,BUTTON_HIDE_DOWNLOADS:3,BUTTON_DOWNLOAD_ALL:4,BUTTON_CHECK_ALL:5,BUTTON_CHECK_NONE:6,BUTTON_FAKE_QUALITY:7,CHECK_BOX_ENABLE_ONE_CLICK:0,CHECK_BOX_SHOW_ON_PAGE_BUTTONS:2,CHECK_BOX_PREFER_LAST_QUALITY:4}}(),A=!q.IS_CONTENT_SCRIPT;k.prototype={setDownloads:function(a){var b=this;b._downloads=a},render:function(b,c,d){var e=this;c.downloads=e._downloads.group(),A&&(c.is_only=e._downloads.isOneMedia());var f=e._widget,g=q.query("#downloads",f);g.innerHTML=Mustache.render(b,c,{media_template:a.options.get("template-media")}),g.classList.add("content");var h=e.applyCurrentValues(d);if(A){var i=q.query(".downloads-list",f);i.scrollHeight>i.offsetHeight&&(j(q.queryAll("h1",f),i),i.addEventListener("scroll",e._getSizeOfVisibleMedia.bind(e),!1),q.query("#close-popup",f).classList.add("pulled")),f.classList.add("done")}return h},_checkFileSize:function(a){var b=this,c=b._downloads.getMedia(a);c&&!c.get("size")&&(z.log("Download",z.DOWNLOAD_REQUEST_SIZE),c.getSize().done(function(a){var d=q.query("#size_"+c.id(),b._widget);d&&(d.classList.add("done"),d.textContent=c.size(),a||z.log("Download",z.DOWNLOAD_REQUEST_SIZE_FAILED))}))},_applyCurrentValues:function(a){var b=this,c=a.querySelector(".j-quality-selector"),d=c.value;q.queryAll(".j-quality-option, .j-quality-download",a).forEach(function(a){a.hidden=a.dataset.quality!==d,A||a.hidden||!a.classList.contains("j-quality-download")||b._checkFileSize(a.dataset.id)}),A&&b._getSizeOfVisibleMedia()},applyCurrentValues:function(a){var b=this,c=b._widget,d=b._downloads,e=options.get("prefer_last_quality")&&options.get("preferred_quality:"+a),f=q.queryAll(".j-media-scope",c);return f.forEach(function(c){var f=q.queryAll(".j-quality-download",c);if(f.length>1){var g=f.map(function(a){return a.dataset.id}),h=quality.chooseBestDownload(d.getMediaGroup(g),a,e),i=q.query(".j-quality-selector",c);i&&(i.value=h.extQuality())}b._applyCurrentValues(c)}),f},_getSizeOfVisibleMedia:function(){for(var a=this,b=q.query(".downloads-list",a._widget),c=b.scrollTop,d=b.offsetHeight,e=q.queryAll(".j-quality-download:not([hidden])",b),f=0,g=e.length;g>f;++f){var h=e[f];if(h.offsetTop>c+d+10)break;a._checkFileSize(h.dataset.id)}},download:function(a){return a.classList.contains("j-disabled")?void 0:(a.classList.add("j-disabled"),a.classList.add("btn-progress"),this._downloads.download(a.dataset.id).success(function(){a.classList.remove("btn-progress"),a.classList.add("btn-started")}).fail(function(b){a.classList.remove("btn-progress"),a.classList.remove("j-disabled"),console.warn("failed to download :(",a.dataset.id,b)}))}};var B=function(){var a=new t;return chrome.tabs.query({windowId:chrome.windows.WINDOW_ID_CURRENT,active:!0},function(b){var c=b&&b[0]&&b[0].id||-1;a.resolve(c)}),a}(),C=function(){var a=b.body;this._oneClickDownload=!1,this._dl=new k(a),this._init(a)};C.prototype={constructor:C,_init:function(a){var c=this;c._widget=a,c._oneClickBlock=q.query("#one-click-block"),c._template=q.query("#list-template").textContent,c._welcome=q.query("#welcome"),a.addEventListener("click",function(a){return c._onClick(a)?void 0:(a.stopPropagation(),!0)},!1),b.addEventListener("change",c._onSelectChange.bind(c),!1),c._oneClickDownload=!!options.get("one_click"),c._drawPopupContent()},_drawPopupContent:function(){var a=this,b=!options.get("not_first_run");b&&(l(),a._showWelcomeScreen(),options.set("not_first_run",!0),z.log("PageShown",z.PAGE_WELCOME_SCREEN)),q.query("#downloads").hidden=b,a._welcome.hidden=!b},_showWelcomeScreen:function(){var a=q.query("#welcome-template").textContent,b=Mustache.render(a,{i18n_welcome_title:r("popup_welcome_title"),i18n_welcome_text:r("popup_welcome_text"),i18n_welcome_button:r("popup_welcome_button")});this._welcome.innerHTML=b},_showOneClickDownloadScreen:function(a){var b=q.query("#one-click-template").textContent,c=Mustache.render(b,{media:a,i18n_starting_download:r("popup_starting_download"),i18n_download_failed:r("popup_download_failed")});this._oneClickBlock.innerHTML=c,q.query("#downloads").hidden=!0,this._oneClickBlock.hidden=!1,z.log("PageShown",z.PAGE_ONE_CLICK_DOWNLOAD)},_onClick:function(c){var d=this,e=c.target;switch(e.id){case"close-popup":return void a.close();case"welcome-button":return d._drawPopupContent(),z.log("ButtonClicked",z.BUTTON_TRY_IT_NOW),void setTimeout(function(){b.body.offsetHeight},0)}switch(e.tagName){case"SPAN":var f=e.parentNode;return f.classList.contains("j-quality-download")?void d._download(f):!0;case"INPUT":if(!e.classList.contains("j-one-click"))return!0;var g=!!e.checked;return options.set("one_click",g),void z.log("CheckBoxClicked",z.CHECK_BOX_ENABLE_ONE_CLICK+g)}return!0},_onSelectChange:function(a){var b=a.target;if("SELECT"===b.tagName){if("quality-level-selection"===b.id)options.set("preferred_quality_level",b.value),z.log("OneClickQualityChanged",quality.getOneClickQualityIndex(b.value));else{var c=b.value.split("/")[1],d=q.findParent(b,"j-media-scope");this._dl._applyCurrentValues(d),z.log("VideoQualityChanged",quality.getVideoQualityIndex(c))}return!1}},_render:function(){var a=this,b=options.get("preferred_quality_level");a._dl.render(a._template,{is_single:a._oneClickDownload,quality_levels:quality.QUALITY_LEVELS.map(function(a){return{i18n_ql_title:r("ql_"+a.toLowerCase()),name:a,is_checked:a===b}}),i18n_download:r("popup_download"),i18n_wait:r("popup_download_starting"),i18n_one_click:r("popup_one_click"),i18n_preferred_quality:r("popup_preferred_quality"),i18n_no_media_found:r("popup_no_media_found"),i18n_download_failed:r("popup_download_failed")},b)},_showDownloadError:function(a){var b=this,c=q.query("#error-message");c.classList.add("visible"),b._errorTimeout&&clearTimeout(b._errorTimeout),b._errorTimeout=setTimeout(function(){c.classList.remove("visible")},5e3),chrome.extension.getBackgroundPage().console.error('Download has failed. Reason: "%s"',a.message)},_download:function(a){var b=this,c=b._dl.download(a);c&&(q.queryAll(".j-media-scope",b._widget).length<=1&&c.success(m),c.fail(function(a){b._showDownloadError(a)}),z.log("Download",z.DOWNLOAD_BUTTON))},setDownloads:function(a){var b=this;b._dl.setDownloads(a);var c=a.getMediaCount();if(b._oneClickDownload&&1===c){var d=options.get("preferred_quality_level"),e=options.get("prefer_last_quality")&&options.get("preferred_quality:"+d),f=quality.chooseBestDownload(a.data,d,e);b._showOneClickDownloadScreen(f),a.download(f.id()).success(m).fail(function(a){b._render(),q.query("#downloads").hidden=!1,b._oneClickBlock.hidden=!0,b._showDownloadError(a)}),z.log("Download",z.DOWNLOAD_AUTO)}else b._render(),z.log("PageShown",0===c?z.PAGE_NO_MEDIA_FOUND:z.PAGE_DOWNLOADS_LIST)}},a.onload=function(){var b=chrome.extension.getBackgroundPage();a.options=b.options,a.cache=b.cache;var c=new C;B.done(function(a){b.db.getMediaForTab(a).done(function(a){c.setDownloads(a)})})}}(window,document);