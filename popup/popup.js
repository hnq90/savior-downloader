!function(e){function t(t){for(var o,r,l=t[0],s=t[1],c=t[2],d=0,_=[];d<l.length;d++)r=l[d],i[r]&&_.push(i[r][0]),i[r]=0;for(o in s)Object.prototype.hasOwnProperty.call(s,o)&&(e[o]=s[o]);for(u&&u(t);_.length;)_.shift()();return a.push.apply(a,c||[]),n()}function n(){for(var e,t=0;t<a.length;t++){for(var n=a[t],o=!0,l=1;l<n.length;l++){var s=n[l];0!==i[s]&&(o=!1)}o&&(a.splice(t--,1),e=r(r.s=n[0]))}return e}var o={},i={1:0},a=[];function r(t){if(o[t])return o[t].exports;var n=o[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,r),n.l=!0,n.exports}r.m=e,r.c=o,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:n})},r.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="./";var l=window.webpackJsonp=window.webpackJsonp||[],s=l.push.bind(l);l.push=t,l=l.slice();for(var c=0;c<l.length;c++)t(l[c]);var u=s;a.push([59,0]),n()}({114:function(e,t){},43:function(e,t,n){var o=n(58),i=new Error("Element already at target scroll position"),a=new Error("Scroll cancelled"),r=Math.min;function l(e){return function(t,n,l,u){"function"==typeof(l=l||{})&&(u=l,l={}),"function"!=typeof u&&(u=c);var d=+new Date,_=t[e],p=l.ease||s,f=isNaN(l.duration)?350:+l.duration,h=!1;return _===n?u(i,t[e]):o(function i(l){if(h)return u(a,t[e]);var s=+new Date;var c=r(1,(s-d)/f);var w=p(c);t[e]=w*(n-_)+_;o(c<1?i:function(){u(null,t[e])})}),function(){h=!0}}}function s(e){return.5*(1-Math.cos(Math.PI*e))}function c(){}e.exports={left:l("scrollLeft"),top:l("scrollTop")}},57:function(e,t,n){(function(t){var n;n="undefined"!=typeof window?window:void 0!==t?t:"undefined"!=typeof self?self:{},e.exports=n}).call(this,n(8))},58:function(e,t,n){var o=n(57),i=o.requestAnimationFrame||o.webkitRequestAnimationFrame||o.mozRequestAnimationFrame||function(e){var t=+new Date,n=Math.max(0,16-(t-a)),o=setTimeout(e,n);return a=t,o},a=+new Date;var r=o.cancelAnimationFrame||o.webkitCancelAnimationFrame||o.mozCancelAnimationFrame||clearTimeout;Function.prototype.bind&&(i=i.bind(o),r=r.bind(o)),(e.exports=i).cancel=r},59:function(e,t,n){"use strict";n.r(t);n(114);var o=n(0),i=n(6),a=n(3),r=n(1),l=n(19),s=n(2),c=n(7),u=n.n(c),d=n(18),_=n(43),p=n.n(_),f=n(20),h=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}();function w(){return new Promise(function(e){chrome.tabs.query({windowId:chrome.windows.WINDOW_ID_CURRENT,active:!0},function(t){var n=t&&t[0]&&t[0].id||-1;e(n)})})}function m(){setTimeout(function(){window&&window.close()},500)}var v=function(){function e(){var t=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var n=document.body;this._oneClickDownload=!1,this._dl=new l.a(n),s.a.load().then(function(){return t._init(n)})}return h(e,[{key:"_init",value:function(e){var t=this;this._widget=e,this._oneClickBlock=o.Utils.query("#one-click-block"),this._template=o.Utils.query("#list-template").textContent,this._welcome=o.Utils.query("#welcome"),this._mediaListHeight=null,w().then(function(e){chrome.runtime.sendMessage({requestType:"popup_request_media",params:{tabId:e}},function(n){if(n&&"resolve"===n.success)var o=function(e){if(!e||!e.length)return e;var t=e.slice(0);return t.forEach(function(e){delete e.id}),t}(n.data),i=new f.a(o,e,function(){t.setDownloads(i)})})}),e.addEventListener("click",function(e){if(!t._onClick(e))return e.stopPropagation(),!0},!1),document.addEventListener("change",this._onSelectChange.bind(this),!1),this._oneClickDownload=!!s.a.get("one_click"),this._drawPopupContent()}},{key:"_drawPopupContent",value:function(){o.Utils.query("#downloads").hidden=!1,this._welcome.hidden=!0}},{key:"_showWelcomeScreen",value:function(){var e=o.Utils.query("#welcome-template").textContent,t=u.a.render(e,{i18n_welcome_title:Object(o.i18n)("popup_welcome_title"),i18n_welcome_text:Object(o.i18n)("popup_welcome_text"),i18n_welcome_button:Object(o.i18n)("popup_welcome_button")});this._welcome.innerHTML=t}},{key:"_showOneClickDownloadScreen",value:function(e){var t=o.Utils.query("#one-click-template").textContent,n=u.a.render(t,{media:e,i18n_starting_download:Object(o.i18n)("popup_starting_download"),i18n_download_failed:Object(o.i18n)("popup_download_failed")});this._oneClickBlock.innerHTML=n,o.Utils.query("#downloads").hidden=!0,this._oneClickBlock.hidden=!1,r.a.log("PageShown",r.a.PAGE_ONE_CLICK_DOWNLOAD)}},{key:"_onClick",value:function(e){var t=this,n=e.target;"quality-level-selection"!==n.id&&o.Utils.queryAll(".j-quality-selector:not([hidden])",this._widget).forEach(function(e){o.Utils.isDescendant(e,n)||o.Utils.isDescendant(e.parentNode,n)||(e.setAttribute("hidden",!0),t._tunePopupHeight(e,!1))});switch(n.id){case"close-popup":return void window.close();case"welcome-button":return this._drawPopupContent(),r.a.log("ButtonClicked",r.a.BUTTON_TRY_IT_NOW),void setTimeout(function(){document.body.offsetHeight},0)}switch(n.tagName){case"A":case"SPAN":var i=n;if("SPAN"===n.tagName.toUpperCase()&&(i=n.parentNode),!i.classList.contains("j-quality-download")&&i.classList.contains("select-wrapper")){var a=o.Utils.query(".j-quality-selector",i);if(a)a.classList.contains("init")||(a.classList.add("popup-mode"),a.classList.add("init"),new d.a(a,{wheelPropagation:!0})),a.hasAttribute("hidden")?(a.removeAttribute("hidden"),this._tunePopupHeight(a,!0)):(a.setAttribute("hidden","hidden"),this._tunePopupHeight(a,!1));return!0}return!i.classList.contains("j-quality-download")||void this._download(i);case"INPUT":if(!n.classList.contains("j-one-click"))return!0;var l=!!n.checked;return s.a.set("one_click",l),void r.a.log("CheckBoxClicked",r.a.CHECK_BOX_ENABLE_ONE_CLICK+l);case"BUTTON":if(n.matches(".play-now-btn")){var c=parseInt(e.target.dataset.downloadId);chrome.runtime.sendMessage({method:"play",requestType:"downloads",params:c}),r.a.log("PlayNow",r.a.PLAY_NOW_WIDGET_CLICKED),m()}break;case"DIV":n.matches(".quality-label.j-quality")&&this._onSelectChange(event)}return!0}},{key:"_onSelectChange",value:function(e){var t=e.target;if(!t.matches(".j-one-click")){if("quality-level-selection"===t.id)return s.a.set("preferred_quality_level",t.value),void r.a.log("OneClickQualityChanged",a.a.getOneClickQualityIndex(t.value));var n=t.getAttribute("data-quality-value").trim(),i=n.split("/")[1];if(s.a.get("prefer_last_quality")&&1===o.Utils.queryAll(".j-media-scope",this._widget).length){var l=a.a.getQualityLevelByQualityType(i);s.a.set("preferred_quality_level",l),s.a.set("preferred_quality:"+l,n)}var c=o.Utils.findParent(t,"j-media-scope"),u=o.Utils.findParent(t,"j-quality-selector");return u.setAttribute("data-selected-value",n),this._markSelected(t,u),this._dl._applyCurrentValues(c,u),r.a.log("VideoQualityChanged",a.a.getVideoQualityIndex(i)),u.setAttribute("hidden",!0),this._tunePopupHeight(u,!1),!1}}},{key:"_markSelected",value:function(e,t){o.Utils.queryAll(".quality-label.selected",t).forEach(function(e){return e.classList.remove("selected")}),e.classList.add("selected")}},{key:"_tunePopupHeight",value:function(e){if(arguments.length>1&&void 0!==arguments[1]&&arguments[1]){var t=i.a.getOffset(e),n=window.innerHeight,o=window.scrollY,a=t.height+t.top;a>=n+o&&p.a.top(document.body,a-n+20,{duration:300})}}},{key:"_render",value:function(){var e=s.a.get("preferred_quality_level");this._dl.render(this._template,{is_single:this._oneClickDownload,quality_levels:a.a.QUALITY_LEVELS.map(function(t){return{i18n_ql_title:Object(o.i18n)("ql_"+t.toLowerCase()),name:t,is_checked:t===e}}),i18n_download:Object(o.i18n)("popup_download"),i18n_wait:Object(o.i18n)("popup_download_starting"),i18n_one_click:Object(o.i18n)("popup_one_click"),i18n_preferred_quality:Object(o.i18n)("popup_preferred_quality"),i18n_no_media_found:Object(o.i18n)("popup_no_media_found"),i18n_download_failed:Object(o.i18n)("popup_download_failed"),i18n_sound_only:Object(o.i18n)("popup_sound_only"),i18n_play_now:Object(o.i18n)("play_now_play_now"),has_pip:!1},e),this._downloadsNode=document.querySelector(".downloads-list")}},{key:"_showDownloadError",value:function(){var e=o.Utils.query("#error-message");e.classList.add("visible"),this._errorTimeout&&clearTimeout(this._errorTimeout),this._errorTimeout=setTimeout(function(){e.classList.remove("visible")},5e3),chrome.extension.getBackgroundPage().console.error("Download has failed")}},{key:"_download",value:function(e){var t=this,n=this._dl.download(e);if(n){o.Utils.queryAll(".j-media-scope",this._widget).length,n.then(function(n){n||(e.setAttribute("disabled",!0),t._showDownloadError())}),r.a.log("Download",r.a.DOWNLOAD_BUTTON);var i=this._dl.getMetricsParams(e,{autoselect:0});r.a.serverLog("Download",i)}}},{key:"setDownloads",value:function(e){var t=this;t._dl.setDownloads(e);var n=e.getMediaCountByTitle();if(t._oneClickDownload&&1===n){var i=s.a.get("preferred_quality_level"),l=s.a.get("prefer_last_quality")&&s.a.get("preferred_quality:"+i),c=a.a.chooseBestDownload(e.data,i,l);t._showOneClickDownloadScreen(c),e.download(c.id).then(function(){m()}).catch(function(e){t._render(),o.Utils.query("#downloads").hidden=!1,t._oneClickBlock.hidden=!0,t._showDownloadError(e)}),r.a.log("Download",r.a.DOWNLOAD_AUTO);var u=t._dl.getMetricsParams(c.id,{autoselect:1});r.a.serverLog("Download",u)}else t._render(),r.a.log("PageShown",0===n?r.a.PAGE_NO_MEDIA_FOUND:r.a.PAGE_DOWNLOADS_LIST)}}]),e}();window.onload=function(){var e=chrome.extension.getBackgroundPage();window.downloads=e.downloads,window.cache=e.cache,new v,chrome.runtime.getPlatformInfo(function(e){"mac"===e.os&&setTimeout(function(){document.body.style.width=document.body.clientWidth+1+"px"},250)})}}});