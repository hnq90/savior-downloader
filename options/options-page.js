!function(a,b){var c=(function(){function a(a,b){var c=a[0]-b[0];return 0!==c?c:(c=a[1]-b[1],0!==c?c:(c=a[2]-b[2],0!==c?c:c=a[3]-b[3]))}var b="",c={mp4:!0},d=0,e=navigator.userAgent.match(/Chrome\/([\d\.]+)/);return e&&e[1]&&(e=e[1].split("."),e=[+e[0],+e[1],+e[2],+e[3]],a(e,[39,0,2171,103])>=0&&(b+=" webm!",c.webm=!0),a(e,[39,0,2171,105])>=0&&(b+=" m3u8!",d=1)),b&&console.info(b),{YT:c,M3U8:d}}(),function(){function a(a){return a&&0!==a.indexOf("data:image")?f.exec(a):[]}var c=b.createElement("a"),d=/([^/]+)$/i,e=/\.([^/.]*)$/i,f={strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}.strict,g=a(b.location.href);return{parse:function(a,b){var f=c;f.setAttribute("href",a);var g=(f.pathname.match(d)||[])[1]||"",h=g.split(".").map(function(a){return a.toLowerCase()});g=decodeURIComponent(g.replace(e,"")),h.shift();var i=h[h.length-1]||"",j={url:a,protocol:f.protocol,host:f.host,port:f.port,pathname:f.pathname,filename:g,ext:i,exts:h,search:f.search};return j.port||delete j.port,b&&(j.query={},f.search.replace(/^\?/,"").split(/\&/).forEach(function(a){a=a.split("="),j.query[a[0]]=a[1]})),j},format:function(a){if(a=Object.create(a),a.query){a.search=[];for(var b in a.query)a.search.push("undefined"!=typeof a.query[b]?b+"="+encodeURIComponent(a.query[b]):b);a.search="?"+a.search.join("&"),delete a.query}for(var d in a)c[d]=a[d];var e=c.href;return e},parse0:a,resolve:function(b,c){b=a(b),c||(c=g);var d=b[1],e=b[2],f=b[9],h=b[12],i=b[13];if(!d&&(d=c[1],!e))if(e=c[2],f){if("/"!==f.charAt(0)){var j=c[10]||"/";f=j+f}}else f=c[9],h||(h=c[12]);var k=d+"://"+e+f;return h&&(k+="?"+h),i&&(k+="#"+i),k},getHost:function(b){return a(b)[6]||""},getMediaType:function(b){var c=a(b)[11]||"";if(!c)return"";var d=c.split("."),e=d.length-1;if(0>=e)return"";var f=d[e].toLowerCase();return MEDIA_EXTENSION_TYPE[f]}}}(),{SIZES:["B","KB","MB","GB","TB","PB"],_BASE:-1!==navigator.appVersion.indexOf("Win")?1024:1e3,xmlParser:new DOMParser,endsWith:function(a,b){var c=a.length-b.length;return c>=0&&a.indexOf(b,c)===c},hash:function(a,b){if(b=0|b,0===a.length)return b;var c,d;for(c=0,d=a.length;d>c;c++)b=(b<<5)-b+a.charCodeAt(c),b|=0;return b},query:function(a,c){return c=c||b,c.querySelector(a)},queryAll:function(a,d){return d=d||b,c.toArray(d.querySelectorAll(a))},findParent:function(a,b){for(;null!==a&&!a.classList.contains(b);)a=a.parentNode;return a},closest:function(a,b){return a.matches(b)?[a]:c.queryAll(b,a)},toArray:function(a){return Array.prototype.slice.call(a)},unique:function(a){var b=[];return Array.isArray(a)?(a.forEach(function(a){-1===b.indexOf(a)&&b.push(a)}),b):a},extend:function(a,b){var c=function(){};c.prototype=a.prototype,b.prototype=new c,b.prototype.constructor=b,b._super=a.prototype},extendObject:function(a){return Array.prototype.forEach.call(Array.prototype.slice.call(arguments,1),function(b){if(b)for(var c in b)a[c]=b[c]}),a},isMatches:function(a,b){var d,e,f;if(Array.isArray(a)){for(d=0;d<a.length;++d)if(c.isMatches(a[d],b))return!0;return!1}for(b=Array.isArray(b)?b:[b],d=0,e=b.length,f;e>d;++d)if(f=b[d],"string"==typeof f&&-1!==a.indexOf(f)||f instanceof RegExp&&a.match(f))return!0;return!1},_sendBackgroundRequest:function(a,b,c,d){var e=new f;return chrome.runtime.sendMessage({requestType:"make_http_request",method:a,url:b,params:c,headers:d},function(a){e[a.success?"resolve":"reject"](a.data)}),e},send:function(a,b,d,e){var g=new f,h=null;if(c.IS_CONTENT_SCRIPT)return c._sendBackgroundRequest(a,b,d,e);try{var i=new XMLHttpRequest;if(i.open(a,b,!0),i.setRequestHeader("Cache-Control","no-cache"),"object"==typeof d&&(h=Object.keys(d).map(function(a){return a+"="+d[a]}).join("&")),"object"==typeof e)for(var j in e)i.setRequestHeader(j,e[j]);"POST"===a&&(i.setRequestHeader("Content-type","application/x-www-form-urlencoded"),h&&i.setRequestHeader("Content-Length",h.length)),i.onload=function(){g.resolve(this.responseText)},i.onerror=function(){g.reject()},i.send(h)}catch(k){g.reject()}return g},get:function(a,b){return c.send("GET",a,{},b)},post:function(a,b,d){return c.send("POST",a,b,d)},_getSize:function(a){function b(a){d&&d[a?"resolve":"reject"](a),d=null,c.abort(),clearTimeout(e),e=null}var c=new XMLHttpRequest,d=new f,e=null,g=1e4;return console.log("%c[SQ] %s","color:'navi';",a),c.open("GET",a),c.setRequestHeader("Cache-Control","no-cache"),c.url=a,c.onreadystatechange=function(){if(!(this.readyState<2)){var a=null;try{a=+this.getResponseHeader("Content-Length"),Number.isNaN(a)&&(a=null)}catch(c){}(null!==a||200===this.status)&&(200!==this.status&&(a=null),b(a))}},c.send(null),e=setTimeout(b,g),d},getSize:function(b){var d=new f,e=a.cache;return e.get(b).success(function(a){a?(d.resolve(a),e.put(b,a)):d.bind(c._getSize(b)).success(e.put.bind(e,b))}).fail(function(){d.bind(c._getSize(b)).success(e.put.bind(e,b))}),d},beautifyFileSize:function(a){if(null===a||"undefined"==typeof a)return"???";for(var b=c._BASE,d=0;d<c.SIZES.length&&a>=b;++d,a/=b);return Math.round(10*a)/10+c.SIZES[d]},detectMediaTypeAndExt:function(a,b){b=b||"";var d=["application/x-mpegurl","application/vnd.apple.mpegurl","audio/x-mpegurl","audio/mpegurl"];if(-1!==d.indexOf(b))return a.type="video",a.ext="m3u8",a;var e=c.getMediaType(b,a.exts);return e&&MEDIA_TYPES[e]&&(a.type=e,a.ext=this._findIntersection(a.exts,MEDIA_TYPES[e].extensions)||c.extByContentType(b,e)||a.ext),a},getMediaType:function(a,b){var d;for(var e in MEDIA_TYPES){if(d=MEDIA_TYPES[e],a.match(d.rgxp))return e;if(Array.isArray(b)&&c._findIntersection(b,d.extensions)||-1!==d.extensions.indexOf(b))return e}return null},_findIntersection:function(a,b){for(var c=a.concat(b),d={},e=0;e<c.length;++e){var f=c[e];if(d[f])return f;d[f]=!0}return null},extByContentType:function(a,b){var c=MEDIA_TYPES[b].ctype2extension;for(var d in c)if(-1!==a.indexOf(d))return c[d];return null},call:function(a,b){if(a&&!(a.length<=0))for(var c=[].slice.call(arguments,2),d=0;d<a.length;d++)a[d].apply(b,c)},isTrue:function(a){return!!a},noop:function(){},defined:function(a){return"undefined"!=typeof a},notNull:function(a){return null!==a},replaceEntities:function(a){var b={"&amp;":"&"};return String(a).replace(/&amp;/g,function(a){return b[a]})}}),d=chrome.i18n.getMessage;try{chrome.extension.getBackgroundPage(),c.IS_CONTENT_SCRIPT=!1}catch(e){c.IS_CONTENT_SCRIPT=!0}var f=function(a){if(0===arguments.length)return this._init(),this;if(a instanceof f)return a;var b=new f;return b.resolve(a),b};f.RUNNING=0,f.RESOLVED=1,f.FAILED=2,f.prototype={constructor:f,_init:function(){this._results=[],this._subscribers=[],this.state=f.RUNNING},_notify:function(){var a=this;this._subscribers.forEach(function(b){b.apply(a,a._results)}),this._subscribers=[]},resolve:function(){return this.state=f.RESOLVED,this._results=arguments,this._notify(),this},reject:function(){return this.state=f.FAILED,this._results=arguments,this._notify(),this},subscribe:function(a){this.state!==f.RUNNING?a.apply(this,this._results):this._subscribers.push(a)},done:function(a){return this.subscribe(a),this},success:function(a){var b=this;return this.subscribe(function(){b.state===f.RESOLVED&&a.apply(b,b._results)}),this},fail:function(a){var b=this;return this.subscribe(function(){b.state===f.FAILED&&a.apply(b,b._results)}),this},bind:function(a){return a=new f(a),a.success(this.resolve.bind(this)).fail(this.reject.bind(this)),this}},f.when=function(){var a=[];return a=Array.isArray(arguments[0])?arguments[0]:c.toArray(arguments),new f.When(a)},f.When=function(a){this._doneCallbacks=[],this._successCallbacks=[],this._failCallbacks=[],this._state=f.RUNNING,this._thingsToDo=a.length,this._results=Array(this._thingsToDo),this._init(a)},f.When.prototype={constructor:f.When,_init:function(a){var b=this;a.forEach(function(a,d){a=new f(a),a.subscribe(function(){a.state===f.FAILED&&(b._state=f.FAILED),b._results[d]=c.toArray(arguments),b._thingsToDo--,b._checkIsDone()})}),this._checkIsDone()},_checkIsDone:function(){if(0!==this._thingsToDo)return!1;var a=[];this._results.forEach(function(b){a=a.concat(b)}),this._state===f.FAILED?this._runCallbacks(this._failCallbacks,a):this._runCallbacks(this._successCallbacks,a),this._runCallbacks(this._doneCallbacks,a),this._doneCallbacks=[],this._successCallbacks=[],this._failCallbacks=[]},_runCallbacks:function(a,b){a.forEach(function(a){a.apply(this,b)})},done:function(a){return this._doneCallbacks.push(a),this._checkIsDone(),this},success:function(a){return this._successCallbacks.push(a),this._checkIsDone(),this},fail:function(a){return this._failCallbacks.push(a),this._checkIsDone(),this}},f.chain=function(){function a(b){if(!b.length)return d.resolve.apply(d,e);var c,g=b.shift();"function"==typeof g?(c=f(g()),c.done(function(c){e.push(c),a(b)})):(e.push(g),a(b))}var b,d=new f,e=[];return b=Array.isArray(arguments[0])?arguments[0]:c.toArray(arguments),a(b),d};var g=function(){this._storage=chrome.storage.local,this._options={},this._default={on_page_buttons:!0,min_stream_size:30720,prefer_last_quality:!0};var a=this;chrome.storage.onChanged.addListener(function(b,c){if("local"===c)for(var d in b)a._options[d]=b[d].newValue})};g.prototype={load:function(){var a=new f,b=this;return this._storage.get(null,function(c){b._options=c,a.resolve(c)}),a},set:function(a,b){var c={};("string"==typeof a||"number"==typeof a&&"undefined"!=typeof b)&&(c[a]=b,this._options[a]=b,this._storage.set(c))},get:function(a){return a in this._options?this._options[a]:this._default[a]}};var h=function(){};h.QL_HIGH="High",h.QL_MEDIUM="Medium",h.QL_LOW="Low",h.QL_VIDEO_ULTRAHD="Ultra HD",h.QL_VIDEO_FULLHD="Full HD",h.QL_VIDEO_HD="HD",h.QL_VIDEO_STANDARD="Standard",h.QL_VIDEO_MEDIUM="Medium",h.QL_VIDEO_SMALL="Small",h.QL_VIDEO_MOBILE="Mobile";var i={};i[h.QL_VIDEO_ULTRAHD]={quality:h.QL_HIGH,qualityIndex:6,size:3072,videoTitle:"Ultra HD",itag:[38,138]},i[h.QL_VIDEO_FULLHD]={quality:h.QL_HIGH,qualityIndex:5,size:1080,videoTitle:"Full HD",audioTitle:"High",itag:[37,46,137],vimeoQuality:"",zingTag:"f1080",dailymotionQuality:"hd1080",clipvnQuality:"5"},i[h.QL_VIDEO_HD]={quality:h.QL_HIGH,qualityIndex:4,size:720,videoTitle:"HD",audioTitle:"High",itag:[22,45,120,136,247],zingTag:["f720","hq"],vimeoQuality:"hd",dailymotionQuality:["hd","hd720"],facebookQuality:"hd_src",clipvnQuality:"4"},i[h.QL_VIDEO_STANDARD]={quality:h.QL_MEDIUM,qualityIndex:3,size:480,videoTitle:"Standard",audioTitle:"Normal",itag:[44,35,135,244],zingTag:["f480"],dailymotionQuality:"hq",vimeoQuality:"sd",facebookQuality:"sd_src",clipvnQuality:"3"},i[h.QL_VIDEO_MEDIUM]={quality:h.QL_MEDIUM,qualityIndex:2,size:360,videoTitle:"Medium",audioTitle:"Normal",itag:[18,43,34,134,243],vimeoQuality:"",dailymotionQuality:"sd",zingTag:["source","f360"],clipvnQuality:"2"},i[h.QL_VIDEO_SMALL]={quality:h.QL_LOW,qualityIndex:1,size:240,videoTitle:"Small",audioTitle:"Low",itag:[36,5,133,242],dailymotionQuality:"ld",vimeoQuality:"mobile",zingTag:["f","f240"],clipvnQuality:"1"},i[h.QL_VIDEO_MOBILE]={quality:h.QL_LOW,qualityIndex:0,size:144,videoTitle:"Mobile",audioTitle:"Low",itag:[17,6,160],vimeoQuality:"",clipvnQuality:"0"};var j={};j[h.QL_HIGH]=i[h.QL_VIDEO_ULTRAHD].qualityIndex,j[h.QL_MEDIUM]=i[h.QL_VIDEO_STANDARD].qualityIndex,j[h.QL_LOW]=i[h.QL_VIDEO_SMALL].qualityIndex,h.prototype={constructor:h,DEFAULT_QUALITY_LEVEL:h.QL_HIGH,QUALITY_LEVELS:[h.QL_HIGH,h.QL_MEDIUM,h.QL_LOW],VIDEO_QUALITY_LEVELS:[h.QL_VIDEO_FULLHD,h.QL_VIDEO_HD,h.QL_VIDEO_STANDARD,h.QL_VIDEO_MEDIUM,h.QL_VIDEO_SMALL,h.QL_VIDEO_MOBILE],DEFAULT_QUALITY_TYPE:h.QL_VIDEO_STANDARD,QUALITY_TYPES:i,getFacebookQuality:function(a){return this._getVideoQuality("facebookQuality",a).videoTitle},getDailymotionQuality:function(a){return this._getVideoQuality("dailymotionQuality",a).videoTitle},getZingVideoQuality:function(a){return this._getVideoQuality("zingTag",a).videoTitle},getZingAudioQuality:function(a){return this._getVideoQuality("zingTag",a).audioTitle},getYoutubeQuality:function(a,b){var c=this._getVideoQuality("itag",+a,b);return c&&c.videoTitle},getVimeoQuality:function(a){return this._getVideoQuality("vimeoQuality",a).videoTitle},getClipvnQuality:function(a){return this._getVideoQuality("clipvnQuality",a).videoTitle},getQualityBySize:function(a){if(a=parseInt(a),isNaN(a))return null;var b=1/0,c=null,d=this.QUALITY_TYPES[this.DEFAULT_QUALITY_TYPE];for(var e in this.QUALITY_TYPES){var f=this.QUALITY_TYPES[e];f.size>d.size&&(d=f),a<=1.3*f.size&&f.size<b&&(c=f,b=f.size)}return c=c||d,c.videoTitle},_getVideoQuality:function(a,b,c){for(var d in this.QUALITY_TYPES){var e=this.QUALITY_TYPES[d][a];if(Array.isArray(e)||(e=[e]),-1!==e.indexOf(b))return this.QUALITY_TYPES[d]}return c?null:this.QUALITY_TYPES[this.DEFAULT_QUALITY_TYPE]},_getTypeByQualityType:function(a){for(var b in this.QUALITY_TYPES)if(a===b||a===this.QUALITY_TYPES[b].videoTitle||a===this.QUALITY_TYPES[b].audioTitle)return this.QUALITY_TYPES[b];return this.QUALITY_TYPES[this.DEFAULT_QUALITY_TYPE]},_calculateWeight:function(a,b){var c=MEDIA_TYPES[a.get("type")].extensions,d=c.indexOf(a.get("ext")),e=this._getTypeByQualityType(a.get("quality")).qualityIndex,f=d/c.length+Math.abs(b-e)/7;return f},getQualityLevelByType:function(a){return Object.keys(this.QUALITY_TYPES).indexOf(this._getTypeByQualityType(a).videoTitle)},getVideoQualityIndex:function(a){return this.VIDEO_QUALITY_LEVELS.concat().reverse().indexOf(a)},getOneClickQualityIndex:function(a){return this.QUALITY_LEVELS.concat().reverse().indexOf(a)},getQualityLevelByQualityType:function(a){return this._getTypeByQualityType(a).quality},chooseBestDownload:function(a,b,c){var d=a.length;if(c)for(var e=0;d>e;++e){var f=a[e];if(f.extQuality()===c)return f}b=b||this.DEFAULT_QUALITY_LEVEL;for(var g=j[b],h=1e3,i=-1,e=0;d>e;++e){var f=a[e],k=this._calculateWeight(f,g);h>k&&(h=k,i=e)}return a[i]}},a.quality=new h;var k,l=function(){function a(a){return-1===i.indexOf(a)}const c=0,d=10,e=20,f=30;var g=0;if(chrome.extension.getBackgroundPage)switch(b.location.pathname){case"/popup.html":g=c;break;case"/options.html":g=d;break;case"/background.html":g=f;break;default:return}else g=e;var h,i=["Refr","RefrSE","RefrFE"];return chrome.metricsPrivate?h=function(b,c){a(b)?chrome.metricsPrivate.recordSmallCount("Savior."+b,c):chrome.metricsPrivate.recordValue({metricName:"Savior."+b,type:"histogram-linear",min:0,max:1e3,buckets:1002},c)}:g===e?h=function(a,b){chrome.runtime.sendMessage({requestType:"metrics",method:"log",params:{name:a,value:b}})}:(console.warn("Metrics are not logged"),h=function(a,b){console.info("Metrics",a,b)}),{log:function(a,b){-1===i.indexOf(a)&&"PageShown"!==a&&(b+=g),"ButtonClicked"===a?a="TryItNowButtonClicked":"CheckBoxClicked"===a&&(a="OneClickCheckbox"),h(a,b)},doLog:g===f?h:null,PAGE_WELCOME_SCREEN:0,PAGE_DOWNLOADS_LIST:1,PAGE_ONE_CLICK_DOWNLOAD:2,PAGE_NO_MEDIA_FOUND:3,PAGE_OPTIONS:4,PAGE_CONTENT_SHOW_CONTROLS:5,PAGE_CONTENT_NO_MEDIA:9,DOWNLOAD_AUTO:0,DOWNLOAD_BUTTON:1,DOWNLOAD_ALL:2,DOWNLOAD_REQUEST_SIZE:3,DOWNLOAD_REQUEST_SIZE_FAILED:4,DOWNLOAD_CANCELED:7,BUTTON_MAIN:0,BUTTON_TRY_IT_NOW:1,BUTTON_SHOW_DOWNLOADS:2,BUTTON_HIDE_DOWNLOADS:3,BUTTON_DOWNLOAD_ALL:4,BUTTON_CHECK_ALL:5,BUTTON_CHECK_NONE:6,BUTTON_FAKE_QUALITY:7,CHECK_BOX_ENABLE_ONE_CLICK:0,CHECK_BOX_SHOW_ON_PAGE_BUTTONS:2,CHECK_BOX_PREFER_LAST_QUALITY:4}}();k=chrome.storage?chrome.extension.getBackgroundPage().options:{preferred_quality_level:"High",one_click:!0,get:function(a){return this[a]},load:function(){return{done:function(a){a()}}},set:function(){console.log("set",arguments[0],"to",arguments[1])}},k.load().done(function(){function b(){var a=k.get("preferred_quality_level"),b=k.get("min_stream_size"),f={onPageButtonsEnabled:k.get("on_page_buttons"),isOneClickEnabled:k.get("one_click"),preferLastQuality:k.get("prefer_last_quality"),minStreamSize:b,minStreamSizeValue:c.beautifyFileSize(b),qLevels:quality.QUALITY_LEVELS.map(function(b){return{i18n_ql_title:d("ql_"+b.toLowerCase()),qLevelName:b,isChecked:b===a}}),i18n_options_title:d("options_title"),i18n_show_on_page_buttons:d("options_show_on_page_buttons"),i18n_one_click:d("options_one_click"),i18n_preferred_quality:d("popup_preferred_quality"),i18n_prefer_last_quality:d("options_prefer_last_quality"),i18n_min_stream_szie:d("options_min_stream_size"),i18n_save_and_close:d("options_save_and_close")},g=c.query("#options-template").textContent;e.innerHTML=Mustache.render(g,f)}var e=c.query("#options");b(),e.addEventListener("click",function(b){var c=b.target;if(c.classList.contains("close-button"))return void a.close();switch(c.id){case"on-page-buttons":var d=!!c.checked;return k.set("on_page_buttons",d),void l.log("CheckBoxClicked",l.CHECK_BOX_SHOW_ON_PAGE_BUTTONS+d);case"one-click-download":var d=!!c.checked;return k.set("one_click",d),void l.log("CheckBoxClicked",l.CHECK_BOX_ENABLE_ONE_CLICK+d);case"prefer-last-quality":var d=!!c.checked;return k.set("prefer_last_quality",d),void l.log("CheckBoxClicked",l.CHECK_BOX_PREFER_LAST_QUALITY+d)}switch(c.getAttribute("type")){case"radio":k.set("preferred_quality_level",c.value),l.log("OneClickQualityChanged",quality.getOneClickQualityIndex(c.value))}},!1),e.addEventListener("change",function(){var a=c.query("#min-stream-size"),b=c.query("#min-stream-size-value"),d=+a.value;k.set("min_stream_size",d),b.textContent=c.beautifyFileSize(d)},!1),l.log("PageShown",l.PAGE_OPTIONS),a.addEventListener("focus",function(){b()},!1)})}(window,document);